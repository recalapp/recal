<<<<<<< HEAD
function AS_showActionSheetFromElement(d,a,e,f,b){var c=$("<div>");$.each(f,function(g){var h=$("<a>").addClass("white-link-btn").addClass("prompt-btn theme").attr("id",g).text(this.text);if(this.important){h=h.addClass("no")}else{h=h.addClass("yes")}h.on("click",function(j){j.preventDefault();$(d).blur();b(g)});c.append(h)});if(THEME=="w"){c.find(".theme").removeClass("dark")}else{c.find(".theme").addClass("dark")}$(d).popover({title:e,placement:"bottom",html:true,content:c[0],trigger:"focus",container:$(a)});$(d).focus()}var cacheManager=null;var CACHE_INIT=false;function CacheMan_init(){if(CACHE_INIT){return}CACHE_INIT=true;cacheManager=new _CacheMan();if(typeof CACHEMAN_PRELOAD!="undefined"){$.each(CACHEMAN_PRELOAD,function(a,b){cacheManager.cached[a]=b})}}function _CacheMan(){this.cached={};return this}function CacheMan_load(a){if(cacheManager.cached[a]==null){_CacheMan_cacheURL(a,false);return CacheMan_load(a)}return cacheManager.cached[a]}function _CacheMan_cacheURL(a,b){$.ajax(a,{async:b,dataType:"html",success:function(c){cacheManager.cached[a]=c}})}var CAL_LOADING=false;var FACTOR_LUM=0.2;var FACTOR_TRANS=0.7;CAL_INIT=false;Cal_eventSource={events:[]};Cal_options={defaultView:"agendaWeek",slotMinutes:45,firstHour:8,minTime:8,maxTime:23,eventDurationEditable:false,eventStartEditable:false,eventBackgroundColor:"#74a2ca",eventBorderColor:"#428bca",allDayDefault:false,eventSources:[Cal_eventSource],ignoreTimezone:false,allDaySlot:false,slotEventOverlap:true};function Cal_init(){}function Cal_highlightEvent(b,a){if(!b.highlighted){b.backgroundColor=setOpacity(b.backgroundColor,1);b.textColor="#ffffff"}b.highlighted=true;if(a){$("#calendarui").fullCalendar("updateEvent",b)}}function Cal_unhighlightEvent(b,a){if(b.highlighted){b.textColor=b.myColor;b.backgroundColor=setOpacity(b.backgroundColor,FACTOR_TRANS)}b.highlighted=false;if(a){$("#calendarui").fullCalendar("updateEvent",b)}}function colorLuminance(e,a){e=String(e).replace(/[^0-9a-f]/gi,"");if(e.length<6){e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]}a=a||0;var b="#",f,d;for(d=0;d<3;d++){f=parseInt(e.substr(d*2,2),16);f=Math.round(Math.min(Math.max(0,f+(f*a)),255)).toString(16);b+=("00"+f).substr(f.length)}return b}function luminanceToRgb(c){var e=parseInt(c.substring(1,3),16);var d=parseInt(c.substring(3,5),16);var a=parseInt(c.substring(5,7),16);return[e,d,a]}function rgbToRgba(a,b){return"rgba("+a[0]+", "+a[1]+", "+a[2]+", "+b+")"}function RGBtoRGBA(h,f,c){if((f==void 0)&&(typeof h=="string")){h=h.replace(/^\s*#|\s*$/g,"");if(h.length==3){h=h.replace(/(.)/g,"$1$1")}f=parseInt(h.substr(2,2),16);c=parseInt(h.substr(4,2),16);h=parseInt(h.substr(0,2),16)}var e,d=(255-(e=Math.min(h,f,c)))/255;return{r:h=0|(h-e)/d,g:f=0|(f-e)/d,b:c=0|(c-e)/d,a:d=(0|1000*d)/1000,rgba:"rgba("+h+", "+f+", "+c+", "+d+")"}}function setOpacity(c,b){for(i=c.length-1;i>0;i--){if(c[i]==" "){break}}var a=c.substring(0,i+1)+b+")";return a}function EP_init(b,c){var a=$(CacheMan_load("event-picker"));a.find("#ep-title").text(b);a.data("count",c.length);$.each(c,function(g,d){var f=$(CacheMan_load("event-picker-item"));if(g==0){f.addClass("active")}var e=f.find(".popup-ep")[0];var h=d.eventDict;PopUp_setTitle(e,h.event_title);PopUp_setDescription(e,h.event_description);PopUp_setLocation(e,h.event_location);PopUp_setSection(e,h.section_id);PopUp_setType(e,h.event_type);PopUp_setDate(e,h.event_start);PopUp_setStartTime(e,h.event_start);PopUp_setEndTime(e,h.event_end);$.each(d.buttons,function(j,l){var k=$("<a>").addClass("white-link-btn").addClass("theme").css({display:"inline"});k.html(l.pretty);k.data("value",l.value);k.on("click",function(n){n.preventDefault();var m=$(this).closest(".item.active").index();a.trigger("ep.select",{eventID:d.eventID,eventDict:d.eventDict,button:$(this).data("value"),index:m})});f.find("#ep-item-controls").append(k)});a.find("#ep-container").append(f)});if(THEME=="w"){a.find(".theme").removeClass("dark")}else{a.find(".theme").addClass("dark")}a.find("#cancel_button").on("click",function(d){d.preventDefault();a.trigger("ep.cancel")});a.on("slid.bs.carousel",function(f){_EP_updateButtons(this);var e=$(this).find(".item.active").index();var d=c[e];$(this).trigger("ep.slid",{eventID:d.eventID,eventDict:d.eventDict,index:e})});_EP_updateButtons(a[0]);return a[0]}function EP_adjustPopUpSize(a){$(a).find(".popup-ep").each(function(){_PopUp_setBodyHeight(this)})}function _EP_updateButtons(c){var b=$(c);var a=b.find(".item.active").index();b.find(".ep-control").removeClass("disabled-btn");if(a==0){b.find(".left.ep-control").addClass("disabled-btn")}if(a==b.data("count")-1){b.find(".right.ep-control").addClass("disabled-btn")}}function EP_removeItemAtIndex(a,b){var d=$(a).data("count");var e=$(a).find(".item").filter(function(){return $(this).index()==b});if(e.hasClass("active")){var c=(b+1)%d;$(a).one("slid.bs.carousel",function(f){e.remove();$(this).data("count",d-1);_EP_updateButtons(this)});$(a).carousel(c);return}e.remove();$(a).data("count",d-1)}var eventsManager=null;var EventsMan_updateListeners=[];var EventsMan_onReadyListeners=[];var EventsMan_eventIDsChangeListener=[];var EVENTS_INIT=false;var EVENTS_READY=false;function EventsMan_init(){}function _EventsMan_new(){this.events={};this.order=[];this.lastSyncedTime=0;this.addedCount=0;this.updatedIDs=new Set();this.uncommitted={};this.hiddenIDs=new Set();this.changed=false;this.isIdle=true;this.showHidden=false;return this}function EventsMan_constructOrderArray(){eventsManager.order=[];$.each(eventsManager.events,function(a,b){eventsManager.order.push({event_start:b.event_start,event_id:a})});eventsManager.order.sort(function(d,c){return parseInt(d.event_start)-parseInt(c.event_start)})}function EventsMan_showHidden(a){if(typeof a!="undefined"){eventsManager.showHidden=a;_EventsMan_callUpdateListeners()}return eventsManager.showHidden}function EventsMan_getEventByID(a){return eventsManager.events[a]}function EventsMan_hasEvent(a){return(a in eventsManager.events)||(a in eventsManager.uncommitted)}function EventsMan_getEventIDForRange(g,c){var f=0;while(f<eventsManager.order.length&&eventsManager.order[f].event_start<g){f++}var b=f;while(f<eventsManager.order.length&&eventsManager.order[f].event_start<c){f++}var a=Math.min(f,eventsManager.order.length);var e=eventsManager.order.slice(b,a);var d=[];for(var f=0;f<e.length;f++){if(EventsMan_showHidden()||!EventsMan_eventIsHidden(e[f].event_id)){d.push(e[f].event_id)}}return d}function EventsMan_getAllEventIDs(){var a=[];$.each(eventsManager.events,function(b,c){if(EventsMan_showHidden()||!EventsMan_eventIsHidden(b)){a.push(b)}});return a}function EventsMan_hasUncommitted(a){return a in eventsManager.uncommitted}function EventsMan_getUncommitted(a){return eventsManager.uncommitted[a]}function EventsMan_addEvent(){var d=String(-1*++eventsManager.addedCount);var b=123;for(var a in SECTION_MAP){b=a;break}var c={event_id:d,event_group_id:d,event_title:"Event Name",event_type:"AS",event_start:moment().unix(),event_end:moment().minute(moment().minute()+50).unix(),event_description:"Event description \n Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.",event_location:"Event location",course_id:-1,section_id:b,modified_user:USER_NETID,modified_time:moment().unix()};eventsManager.uncommitted[d]=c;return d}function EventsMan_deleteEvent(b,a){a=a||false;if(b in eventsManager.events){eventsManager.hiddenIDs.add(b);eventsManager.changed=true}if(b in eventsManager.uncommitted){eventsManager.uncommitted[b]=null;delete eventsManager.uncommitted[b]}if(b in eventsManager.updatedIDs){eventsManager.updatedIDs.remove(b)}if(!a){_EventsMan_callUpdateListeners()}}function EventsMan_deleteAllFutureEvents(d){var c=EventsMan_getEventByID(d);var b=moment.unix(c.event_start);b.year(b.year()+20);var a=EventsMan_getEventIDForRange(c.event_start,b.unix());$.each(a,function(e){var f=EventsMan_getEventByID(this);if(f.event_group_id==c.event_group_id&&f!=c){EventsMan_deleteEvent(this,true)}});EventsMan_deleteEvent(d)}function EventsMan_unhideEvent(b,a){a=a||false;if(b in eventsManager.events){eventsManager.hiddenIDs.remove(b);eventsManager.changed=true}if(!a){_EventsMan_callUpdateListeners()}}function EventsMan_unhideAllFutureEvents(d){var c=EventsMan_getEventByID(d);var b=moment.unix(c.event_start);b.year(b.year()+20);var a=EventsMan_getEventIDForRange(c.event_start,b.unix());$.each(a,function(e){var f=EventsMan_getEventByID(this);if(f.event_group_id==c.event_group_id&&f!=c){EventsMan_unhideEvent(this,true)}});EventsMan_unhideEvent(d)}function EventsMan_eventIsHidden(a){return a in eventsManager.hiddenIDs}function EventsMan_eventShouldBeShown(a){return !EventsMan_eventIsHidden(a)||EventsMan_showHidden()}function EventsMan_ready(){return EVENTS_READY}function EventsMan_commitChanges(c){var b=eventsManager.events[c];var a=eventsManager.uncommitted[c];eventsManager.events[c]=eventsManager.uncommitted[c];delete eventsManager.uncommitted[c];eventsManager.updatedIDs.add(c);EventsMan_constructOrderArray();if("recurrence_days" in b&&(!b.recurrence_days.equals(a.recurrence_days)||b.recurrence_interval!=a.recurrence_interval)){EventsMan_pushToServer(true)}_EventsMan_callUpdateListeners()}function EventsMan_cancelChanges(a){delete eventsManager.uncommitted[a];_EventsMan_callUpdateListeners()}function EventsMan_commitChangesToAllFutureEvents(g){var b=eventsManager.uncommitted[g];var c=eventsManager.events[g];var f=moment.unix(c.event_start);f.year(f.year()+20);var e=EventsMan_getEventIDForRange(c.event_start,f.unix());var a=moment.unix(b.event_start);var d=moment.unix(b.event_end);$.each(e,function(j){var l=EventsMan_getEventByID(this);if(l.event_group_id==c.event_group_id&&l!=c){l.event_title=b.event_title;l.event_description=b.event_description;l.event_location=b.event_location;l.section_id=b.section_id;l.event_type=b.event_type;l.modified_time=b.modified_time;l.modified_user=b.modified_user;var k=moment.unix(l.event_start).hour(a.hour());k.minute(a.minute());k.second(a.second());l.event_start=k.unix();var h=moment.unix(l.event_end).hour(d.hour());h.minute(d.minute());h.second(d.second());l.event_end=h.unix();eventsManager.updatedIDs.add(l.event_id)}});EventsMan_commitChanges(g)}function EventsMan_replaceUncommittedEventIDWithEvent(b,a){eventsManager.uncommitted[b]=null;delete eventsManager.uncommitted[b];eventsManager.uncommitted[a.event_id]=a;EventsMan_callEventIDsChangeListener(b,a.event_id);_EventsMan_callUpdateListeners()}function EventsMan_replaceEventIDWithEvent(b,a){eventsManager.events[b]=null;delete eventsManager.events[b];eventsManager.events[a.event_id]=a;if(EventsMan_hasUncommitted(b)){delete eventsManager.uncommitted[b]}EventsMan_callEventIDsChangeListener(b,a.event_id);_EventsMan_callUpdateListeners()}function EventsMan_pushToServer(a){}function EventsMan_pullFromServer(a){}function _EventsMan_callUpdateListeners(){$.each(EventsMan_updateListeners,function(a){this()})}function EventsMan_addUpdateListener(a){EventsMan_updateListeners.push(a)}function EventsMan_addOnReadyListener(a){if(EVENTS_READY){a();return}EventsMan_onReadyListeners.push(a)}function EventsMan_callOnReadyListeners(){$.each(EventsMan_onReadyListeners,function(a){this()});EventsMan_onReadyListeners=null}function EventsMan_addEventIDsChangeListener(a){EventsMan_eventIDsChangeListener.push(a)}function EventsMan_callEventIDsChangeListener(b,a){$.each(EventsMan_eventIDsChangeListener,function(c){this(b,a)})}function EventsMan_cloneEventDict(b){var a=JSON.parse(JSON.stringify(b));return a}function EventsMan_save(){if("localStorage" in window&&window.localStorage!==null){localStorage.setItem("eventsman.events",JSON.stringify(eventsManager.events));localStorage.setItem("eventsman.lastsyncedtime",eventsManager.lastSyncedTime);localStorage.setItem("eventsman.hidden",JSON.stringify(eventsManager.hiddenIDs.toArray()))}}function EventsMan_load(){if(!("localStorage" in window&&window.localStorage!==null)){return false}var a=localStorage.getItem("user");if(a!=USER_NETID){return false}var b=localStorage.getItem("eventsman.events");if(!b){return false}eventsManager.events=JSON.parse(b);var c=localStorage.getItem("eventsman.hidden");if(c){eventsManager.hiddenIDs=Set.prototype.fromArray(JSON.parse(c))}var d=localStorage.getItem("eventsman.lastsyncedtime");if(d){eventsManager.lastSyncedTime=d}EventsMan_constructOrderArray();return true}var MAIN_TIMEZONE="America/New_York";var DAYS_DICT=["M","Tu","W","Th","F","Sa","S"];var TYPE_MAP_INVERSE={assignment:"AS",exam:"EX",lab:"LA",lecture:"LE","office hours":"OH",precept:"PR","review session":"RS"};var TYPE_MAP={AS:"assignment",EX:"exam",LA:"lab",LE:"lecture",OH:"office hours",PR:"precept",RS:"review session"};String.prototype.escapeHTML=function(){var a={"&":"&amp;","<":"&lt;",">":"&gt;"};return this.replace(/[&<>]/g,function(b){return a[b]||b})};Array.prototype.contains=function(b){for(var c=0;c<this.length;c++){if(this[c]==b){return true}}return false};Array.prototype.find=function(b){for(var c=0;c<this.length;c++){if(this[c]==b){return c}}return -1};Array.prototype.equals=function(b){var c;for(c=0;c<this.length;c++){if(c>=b.length){return false}else{if(this[c]!=b[c]){return false}}}return c==b.length};var LO_TYPES={SUCCESS:"alert-success"};var LO_idMap=null;function LO_init(){LO_idMap={loading:new Set(),error:new Set()}}function LO_showLoading(b){if(typeof b=="undefined"){return}if(b in LO_idMap.loading){return}LO_idMap.loading.add(b);if($("#loading.active").length>0){return}var a=LO_getLoadingHTML();a.attr("id","loading");LO_insert(a)}function LO_hideLoading(b,a){if(typeof a=="undefined"){a=true}if(typeof b=="undefined"){return}LO_idMap.loading.remove(b);if(LO_idMap.loading.isEmpty()){LO_remove($("#loading.active"))}if(!a){return}if(b in LO_idMap.error){LO_idMap.error.remove(b);if(LO_idMap.error.isEmpty()){LO_remove($("#error.active"));LO_showTemporaryMessage("Connected",LO_TYPES.SUCCESS)}}}function LO_showError(b){if(typeof b=="undefined"){return}if(b in LO_idMap.error){return}LO_idMap.error.add(b);if($("#error.active").length>0){return}var a=LO_getLoadingHTML();a.attr("id","error");a.removeClass("alert-info").addClass("alert-danger");a.find("#loading-content").html("Error connecting.<br>Will keep trying");LO_insert(a)}function LO_showTemporaryMessage(b,a){var c=LO_getLoadingHTML();c.removeClass("alert-info").addClass(a);c.find("#loading-content").text(b);LO_insert(c);setTimeout(function(){LO_remove(c)},3*1000)}function LO_remove(a){a.on("transitionend",function(b){$(this).remove()});a.removeClass("active");a.removeClass("in")}function LO_insert(a){$("#indicators-container").append(a);a.addClass("active");a.addClass("in")}function LO_getLoadingHTML(){var a=$("<div>").addClass("indicator alert alert-dismissable alert-info");a.append($('<span id="loading-content">'));a.find("#loading-content").append('Loading...&nbsp;&nbsp;&nbsp;<i class="fa fa-spinner fa-spin"></i>');return a}var pinnedIDs=null;var mainID=null;var csrftoken=$.cookie("csrftoken");var COURSE_COLOR_MAP;var SECTION_COLOR_MAP;function UI_pin(a){if(UI_isMain(a)){UI_unsetMain()}pinnedIDs.add(a)}function UI_isPinned(a){return a in pinnedIDs}function UI_unpin(a){pinnedIDs.remove(a)}function UI_isMain(a){return mainID==a}function UI_setMain(a){if(UI_isPinned(a)){UI_unpin(a)}mainID=a}function UI_unsetMain(){mainID=null}function csrfSafeMethod(a){return(/^(GET|HEAD|OPTIONS|TRACE)$/.test(a))}function sameOrigin(b){var d=document.location.host;var e=document.location.protocol;var c="//"+d;var a=e+c;return(b==a||b.slice(0,a.length+1)==a+"/")||(b==c||b.slice(0,c.length+1)==c+"/")||!(/^(\/\/|http:|https:).*/.test(b))}function toTitleCase(a){return a.replace(/\w\S*/g,function(b){return b.charAt(0).toUpperCase()+b.substr(1).toLowerCase()})}function br2nl(a){return a.replace(/(\n|\r)/g,"").replace(/<br>/g,"\n")}function nl2br(a){return a.replace(/(\n|\r)/g,"<br>")}function loadWhiteTheme(){$(".theme").removeClass("dark");$("#theme_css").attr("href","/static/cosmo/bootstrap.css")}function loadDarkTheme(){$(".theme").addClass("dark");$("#theme_css").attr("href","/static/cyborg/bootstrap.css")}var POPUP_HTML=null;var POPUP_CLASS="popup";var POPUP_URL="popup-template";var PopUp_closeListeners=[];var PopUp_editListeners=[];var PopUp_freedSpace=[];var PopUp_space=0;var POPUP_INIT=false;var POPUP_EDITDICT={"popup-loc":"event_location","popup-title":"event_title","popup-date":"event_date","popup-time-start":"event_start","popup-time-end":"event_end","popup-type":"event_type","popup-section":"section_id","popup-desc":"event_description","popup-repeat-end":"recurrence_end","popup-repeat-interval":"recurrence_interval"};var PopUp_Main_optFirstDrag=function(a){};var POPUP_MAIN_FIRSTDRAG=function(a){if(PopUp_isMain(a)){a.id="";PopUp_Main_optFirstDrag(a);UI_pin(PopUp_getID(a));UI_unsetMain();var b=a.getBoundingClientRect();$(a).css({height:b.height+"px",width:b.width+"px"});$(a).appendTo("body");$(a).css({top:b.top,left:b.left});PopUp_makeResizable(a);SB_hide()}};function PopUp_insertPopUp(b){var d;if(POPUP_HTML){d=POPUP_HTML}else{d=CacheMan_load(POPUP_URL)}if(b){SB_push(d)}else{$("body").append(d)}var c=$("#popup-main123");var a=function(){POPUP_MAIN_FIRSTDRAG(c);if(c.space){PopUp_freedSpace.push(c.space)}};c.draggable({handle:".panel > .panel-heading",containment:"#content_bounds",scroll:false,appendTo:"body",beforeStart:function(f,g){a()},zIndex:2000});c=c[0];c.id="popup-main";if(!b){var e;if(PopUp_freedSpace.length==0){e=++PopUp_space}else{e=PopUp_freedSpace.sort(function(g,f){return f-g}).pop()}c.id="";PopUp_makeResizable(c);leftPos=parseInt($(c).css("left"));topPos=parseInt($(c).css("top"));$(c).css("left",(leftPos+20*e)+"px").css("top",(topPos+20*e)+"px");c.space=e}c.onmousedown=function(){PopUp_giveFocus(this)};maxHeight=window.innerHeight-$(".navbar").height()-100;$(c).css("max-height",maxHeight+"px");_PopUp_setBodyHeight(c);PopUp_initialize(c);setTimeout(function(){PopUp_initialize_deferred(c)},300);$(c).find(".withtooltip").tooltip({});if(THEME=="w"){$(c).find(".theme").removeClass("dark")}else{$(c).find(".theme").addClass("dark")}return c}function PopUp_initialize(a){}function PopUp_initialize_deferred(a){}function PopUp_close(a){if(UI_isMain(PopUp_getID(a))){UI_unsetMain();SB_pop(a)}else{UI_unpin(PopUp_getID(a));$(a).remove()}SB_hideIfEmpty()}function PopUp_getMainPopUp(){var a=$("#popup-main");if(a.length>0){a=$("#popup-main")[0]}else{a=PopUp_insertPopUp(true)}return a}function PopUp_getPopUpByID(a){if($("."+POPUP_CLASS).find("#"+a).length>0){return $("."+POPUP_CLASS).find("#"+a).parent()[0]}else{return null}}function PopUp_getID(a){if(!a){return null}if(!("id" in $(a).find(".panel")[0])){return null}return $(a).find(".panel")[0].id}function PopUp_setID(a,c){var b=$(a).find(".panel")[0].id;$(a).find(".panel")[0].id=c;if(a.id=="popup-main"){UI_setMain(c)}else{UI_unpin(b);UI_pin(c)}}function _PopUp_setBodyHeight(b){var c=$(b).find(".panel-heading").css("height");var a=$(b).css("height");$(b).find(".panel-body").css("height",(parseInt(a)-parseInt(c))+"px")}function PopUp_giveFocus(b){if(!b){return}PopUp_loseFocus($("."+POPUP_CLASS).not(b));$(b).css("z-index","200");var a=$(b).find(".panel").data("my-color");$(b).find(".panel").addClass("panel-primary").removeClass("panel-default").css("border-color",a);$(b).find(".popup-title").parent().parent().css("background-color",a).css("border-color",a);if(UI_isMain(PopUp_getID(b))){SB_show()}}function PopUp_loseFocus(a){a.each(function(c){var b=$(this).find(".panel").data("default-border");var d=$(this).find(".panel").data("default-header");$(this).css("z-index","100").find(".panel").addClass("panel-default").removeClass("panel-primary").css("border-color",b);$(this).find(".popup-title").parent().parent().css("background-color",d).css("border-color",b)})}function PopUp_giveFocusToID(a){popUp=$("."+POPUP_CLASS).find("#"+a).parent();PopUp_giveFocus(popUp)}function PopUp_hasFocus(a){return $(a).find(".panel").hasClass("panel-primary")}function PopUp_updateSize(a){$(a).find(".panel").css({width:$(a).css("width"),height:$(a).css("height")});_PopUp_setBodyHeight(a)}function PopUp_isMain(a){return a.id=="popup-main"}function PopUp_makeMain(a){a.id="popup-main";var c=PopUp_getID(a);if(UI_isPinned(c)){UI_unpin(c)}UI_setMain(c);try{$(a).find(".panel").resizable("destroy")}catch(b){}}function PopUp_hasMain(a){return $("#popup-main").length>0}function PopUp_makeResizable(a){$(a).find(".panel").resizable({stop:function(c,b){$(this).parent().css("height",$(this).css("height"));$(this).parent().css("width",$(this).css("width"));_PopUp_setBodyHeight(this)}})}function PopUp_addCloseListener(a){PopUp_closeListeners.push(a)}function PopUp_addEditListener(a){PopUp_editListeners.push(a)}function PopUp_callCloseListeners(a){$(PopUp_closeListeners).each(function(b){this(a)})}function PopUp_callEditListeners(c,b,a){$(PopUp_editListeners).each(function(d){this(c,b,a)})}function _PopUp_getPopUp(b){var a=b;while(!$(a).hasClass("popup")){a=$(a).parent()[0]}return a}function PopUp_map(a){$("."+POPUP_CLASS).not("#popup-main").each(function(b){a(this,false)});$("#popup-main").each(function(b){a(this,true)})}function PopUp_setColor(c,b){$(c).find(".panel").data("my-color",b);var a="#DDDDDD";var d="#F5F5F5";$(c).find(".panel").data("default-border",a);$(c).find(".panel").data("default-header",d);if(PopUp_hasFocus(c)){$(c).find(".popup-title").parent().parent().css("background-color",b).css("border-color",b);$(c).find(".panel").css("border-color",b)}else{$(c).find(".popup-title").parent().parent().css("background-color",d).css("border-color",a);$(c).find(".panel").css("border-color",a)}}function SC_initWithChoices(b,c){$container=$("<div>").addClass("segmented-control").append($("<h5>"));$container.find("h5").text(b);var a=$("<div>").addClass("btn-group");$.each(c,function(d){var e=$("<button>").addClass("btn").addClass("btn-sm").text(this.pretty).data("value",this.value).on("click",function(f){f.preventDefault();SC_select(this)});a.append(e);if(this.selected||d==0){SC_select(e)}});$container.append(a);return $container[0]}function SC_setToChoices(a,b){$(a).find("button").each(function(d){for(var e=0;e<b.length;e++){var c=b[e];if(c.value==$(this).data("value")){if(c.selected){SC_select(this,true)}break}}})}function SC_removeAllFromContainer(a){$(a).find(".segmented-control").remove()}function SC_select(b,a){a=a||false;SC_unhighlight($(b).parent().find(".btn-primary"));SC_highlight(b);if(a){return}var c={};$(b).parent().find(".btn").each(function(d){c[$(this).data("value")]=$(this).hasClass("btn-primary")});$(b).trigger("select",c)}function SC_highlight(a){$(a).addClass("btn-primary")}function SC_unhighlight(a){$(a).removeClass("btn-primary")}function SC_isHighlighted(a){return $(a).hasClass("btn-primary")}function SCM_initWithChoices(a,c){var b=SC_initWithChoices(a,c);$(b).find("button").each(function(d){$(this).off("click");$(this).on("click",function(e){e.preventDefault();if(SC_isHighlighted(this)){SCM_deselect(this)}else{SCM_select(this)}});SCM_setToChoices(b,c)});return b}function SCM_select(a){SC_highlight(a);var b={};$(a).parent().find(".btn").each(function(c){b[$(this).data("value")]=$(this).hasClass("btn-primary")});$(a).trigger("select",b)}function SCM_deselect(a){SC_unhighlight(a);var b={};$(a).parent().find(".btn").each(function(c){b[$(this).data("value")]=$(this).hasClass("btn-primary")});$(a).trigger("select",b)}function SCM_setToChoices(a,b){$(a).find("button").each(function(d){SCM_deselect(this);for(var e=0;e<b.length;e++){var c=b[e];if(c.value==$(this).data("value")){if(c.selected){SCM_select(this)}break}}})}function SCP_initOnElement(b,a,c,f){if($(b).data("scp")){var e=$(b).data("scp");SC_setToChoices(e,f);return e}var d=SC_initWithChoices(null,f);$(d).find(".btn-group").addClass("btn-group-vertical").removeClass("btn-group");$(b).popover({title:c,placement:"left",html:true,content:d,trigger:"focus",container:$(a)});$(b).data("scp",d);return d}var Set=function(){};Set.prototype.size=0;Set.prototype.add=function(a){this[a]=true;this.size++};Set.prototype.remove=function(a){if(a in this){delete this[a];this.size--}};Set.prototype.fromArray=function(c){var a=new Set();for(var b=0;b<c.length;b++){a.add(c[b])}return a};Set.prototype.toArray=function(){var a=[];for(var b in this){if(typeof this[b]!="function"&&b!="size"){a.push(b)}}a.sort();return a};Set.prototype.contains=function(b){for(var c in b){if(!(c in this)){return false}}return true};Set.prototype.equals=function(b){return this.contains(b)&&b.contains(this)};Set.prototype.isEmpty=function(b){return this.size<=0};var SB_willCloseListeners=[];function SB_init(){$("#sidebar").droppable({drop:function(c,d){if(PopUp_hasMain()){var a=PopUp_getMainPopUp();PopUp_callCloseListeners(PopUp_getID(a));$(a).remove()}var b=d.draggable[0];$(b).detach().appendTo("#sb-left-container").css({width:"100%",height:"350px",left:"auto",top:"auto"});$(b).addClass("sb-left-content");$(b).addClass("in");PopUp_updateSize(b);PopUp_makeMain(b)},hoverClass:"hover-active"});$("#sidebar-target").droppable({over:function(a,b){SB_show()},out:function(a,b){if(SB_isEmpty()){SB_hide()}}})}function SB_isEmpty(){return $("#sidebar").find(".in").length==0}function SB_show(){$("#sidebar").addClass("in");$("#sb-handle").find(".glyphicon").addClass("glyphicon-chevron-right").removeClass("glyphicon-chevron-left")}function SB_hide(){SB_callWillCloseListeners();SB_unfill();$("#sidebar").removeClass("in");$("#sb-handle").find(".glyphicon").removeClass("glyphicon-chevron-right").addClass("glyphicon-chevron-left")}function SB_hideIfEmpty(){if(SB_isEmpty()){SB_hide()}}function SB_isShown(){return $("#sidebar").hasClass("in")}function SB_push(a){a=$(a).addClass("sb-left-content")[0];$("#sb-left-container").append(a);if(!SB_isShown()){SB_show()}setTimeout("$('#sb-left-container').find('.sb-left-content').addClass('in')",10)}function SB_pop(a){$(a).removeClass("in").on("transitionend",function(){$(a).remove()})}function SB_setMainContent(a){$(".sb-full-content").remove();a=$(a).addClass("sb-full-content")[0];$("#sb-full-container").append(a);setTimeout("$('#sb-full-container').find('.sb-full-content').addClass('in')",10)}function SB_fill(){$("#sidebar").addClass("full");disableAllInteractions()}function SB_unfill(){$("#sidebar").removeClass("full");SB_pop($(".sb-full-content"));enableAllInteractions()}function SB_isFilled(){return $("#sidebar").hasClass("full")}function SB_toggle(){if(SB_isShown()){SB_hide()}else{SB_show()}}function SB_addWillCloseListener(a){SB_willCloseListeners.push(a)}function SB_callWillCloseListeners(){$.each(SB_willCloseListeners,function(a){this()})}AGENDA_INIT=false;var AGENDA_HTML=null;function Agenda_init(){if(AGENDA_INIT){return}AGENDA_INIT=true;AGENDA_HTML=$("#agenda-template").html();$("#agenda-template").remove();EventsMan_addUpdateListener(function(){if(!Agenda_active()){return}Agenda_reload()});$("#"+SE_id).on("close",function(a){if(!Agenda_active()){return}Agenda_reload()});$("#agenda.tab-pane").each(function(a){$(this).on("transitionend",function(b){if($(this).hasClass("in")){Agenda_reload()}})});PopUp_addCloseListener(function(a){Agenda_unhighlight($(".tab-content").find(".agenda-item.panel#"+a))});Agenda_reload()}function Agenda_active(){return $("#agenda").hasClass("active")}function Agenda_reload(){LO_showLoading("agenda loading");var c=$("#agenda");var d=false;c[0].innerHTML=null;var b=moment();var a=moment().date(b.date()-1).hour(0).minute(0).second(0);var f=moment().date(b.date()).hour(0).minute(0).second(0);var e=EventsMan_getEventIDForRange(a.unix(),f.unix());e=Agenda_filterEvents(e);if(e.length>0){d|=true;Agenda_insertHeader("Yesterday");Agenda_loadEvents(e)}a=f;f=moment().date(b.date()+1).hour(0).minute(0).second(0);e=EventsMan_getEventIDForRange(a.unix(),f.unix());e=Agenda_filterEvents(e);if(e.length>0){d|=true;Agenda_insertHeader("Today");Agenda_loadEvents(e)}a=f;f=moment().date(b.date()+7).hour(0).minute(0).second(0);e=EventsMan_getEventIDForRange(a.unix(),f.unix());e=Agenda_filterEvents(e);if(e.length>0){d|=true;Agenda_insertHeader("This Week");Agenda_loadEvents(e)}a=f;f=moment().month(b.month()+1);f=f.date(0);e=EventsMan_getEventIDForRange(a.unix(),f.unix());e=Agenda_filterEvents(e);if(e.length>0){d|=true;Agenda_insertHeader("This month");Agenda_loadEvents(e)}if(!d){Agenda_insertHeader("Congrats! You have nothing on your agenda!")}LO_hideLoading("agenda loading")}function Agenda_filterEvents(b){var a=[];$.each(b,function(c){var d=EventsMan_getEventByID(this);if(!d){return}if(AGENDA_FILTER.contains(d.event_type)){if(!(d.course_id in COURSE_FILTER_BLACKLIST)){a.push(this)}}});return a}function Agenda_loadEvents(b){var a=$("#agenda");$.each(b,function(e){var f=EventsMan_getEventByID(this);if(!f){return}a.append($(AGENDA_HTML));var d=a.find("#agenda123")[0];d.id=this;$(d).find(".panel-body").find("h4").text(f.event_title);$(d).find("#agenda-section").text(SECTION_MAP[f.section_id]);var g=moment.unix(f.event_start);var c=g.tz(MAIN_TIMEZONE).calendar();$(d).find("#agenda-time").text(c);_Agenda_setColors(d,f,EventsMan_eventIsHidden(this));if(UI_isPinned(d.id)){Agenda_highlight(d)}if(UI_isMain(d.id)){Agenda_highlight(d)}});if(window.innerWidth<=400){$(".agenda-container").children(".col-xs-4").removeClass("col-xs-4 col-xs-offset-1").addClass("col-xs-12")}if(THEME=="w"){$(".theme").removeClass("dark")}else{$(".theme").addClass("dark")}}function _Agenda_setColors(b,f,c){var g="course-color-"+f.course_id;var a=SECTION_COLOR_MAP[f.section_id]["color"];var d=THEME=="w"?"#000000":"#ffffff";$(b).parent().find(".agenda-tag").addClass(g).css("background-color",a);$(b).data("course-color",a);$(b).data("default-color",d);var e=$(b).css("border-color");$(b).data("default-border-color",e);$(b).find("#agenda-section").addClass(g).css("color",e);$(b).find("#agenda-title").addClass(g).css("color",e);if(c){$(b).css("border-style","dashed")}}function Agenda_insertHeader(c){var a=$("#agenda");var b=$('<div class="agenda-header row">');$('<div class="col-xs-5 col-xs-offset-1">').append('<h3 id="agenda-header-text"></h3>').appendTo(b);a.append(b);b.find("#agenda-header-text").text(c)}function selectAgenda(c){var a=$(c).find(".panel")[0];if(Agenda_isHighlighted(a)){var d=a.id;PopUp_giveFocusToID(d);return}if(SHIFT_PRESSED){Agenda_highlight(a);b=PopUp_insertPopUp(false);PopUp_setToEventID(b,a.id);PopUp_giveFocus(b);return}Agenda_unhighlight($(".agenda-item.panel-primary").filter(function(){return !UI_isPinned(this.id)}));Agenda_highlight(a);var b=PopUp_getMainPopUp();PopUp_setToEventID(b,a.id);PopUp_giveFocus(b)}function Agenda_highlight(b){if(Agenda_isHighlighted(b)){return}var a=$(b).data("course-color");$(b).find("#agenda-section").css("color",a);$(b).find("#agenda-title").css("color",a);$(b).addClass("panel-primary").removeClass("panel-default").css({"border-color":a})}function Agenda_unhighlight(a){var b=$(a).data("default-border-color");$(a).addClass("panel-default").removeClass("panel-primary").css({"border-color":b});$(a).find("#agenda-section").css("color",b);$(a).find("#agenda-title").css("color",b)}function Agenda_isHighlighted(a){return $(a).hasClass("panel-primary")}function Cal_init(){if(CAL_INIT){return}var a=window.innerHeight-$(".navbar").height()-50;EventsMan_addUpdateListener(function(){if(Cal_active()){Cal_reload()}});$("#"+SE_id).on("close",function(b){Cal_reload()});Cal_options.height=a;Cal_options.eventClick=function(e,c,b){if(e.highlighted==true){PopUp_giveFocusToID(e.id);return}if(SHIFT_PRESSED){Cal_highlightEvent(e,true);var d=PopUp_insertPopUp(false);PopUp_setToEventID(d,e.id);PopUp_giveFocus(d);return}$($("#calendarui").fullCalendar("clientEvents",function(f){return !UI_isPinned(f.id)})).each(function(f){Cal_unhighlightEvent(this,false)});Cal_highlightEvent(e,true);var d=PopUp_getMainPopUp();PopUp_setToEventID(d,e.id);PopUp_giveFocus(d)};Cal_options.windowResize=function(b){Cal_adjustHeight()};$("#calendarui").fullCalendar(Cal_options);CAL_INIT=true;$("#calendar.tab-pane").each(function(b){$(this).on("transitionend",function(c){if($(this).hasClass("in")){Cal_render();Cal_reload()}})});PopUp_addCloseListener(function(b){$($("#calendarui").fullCalendar("clientEvents",b)).each(function(c){Cal_unhighlightEvent(this,true)})});if(Cal_active()){Cal_reload()}}function Cal_adjustHeight(){var a=window.innerHeight-$(".navbar").height()-50;$("#calendarui").fullCalendar("option","height",a)}function Cal_active(){return $("#calendar").hasClass("active")}function Cal_reload(){if(CAL_LOADING){return}CAL_LOADING=true;var a=EventsMan_getAllEventIDs();Cal_eventSource.events=[];setTimeout(function(){LO_showLoading("cal loading");try{$.each(a,function(d){eventDict=EventsMan_getEventByID(this);if(!eventDict){return}if(!CAL_FILTER.contains(eventDict.event_type)){return}if(eventDict.course_id in COURSE_FILTER_BLACKLIST){return}var c=UI_isPinned(this)||UI_isMain(this);var f=EventsMan_eventIsHidden(this);color=SECTION_COLOR_MAP[eventDict.section_id]["color"];color=colorLuminance(color,FACTOR_LUM);var e;if(c){e=rgbToRgba(luminanceToRgb(color),1)}else{e=rgbToRgba(luminanceToRgb(color),FACTOR_TRANS)}Cal_eventSource.events.push({id:eventDict.event_id,title:eventDict.event_title,start:moment.unix(eventDict.event_start).tz(MAIN_TIMEZONE).toISOString(),end:moment.unix(eventDict.event_end).tz(MAIN_TIMEZONE).toISOString(),highlighted:c,myColor:SECTION_COLOR_MAP[eventDict.section_id]["color"],textColor:c?"#ffffff":SECTION_COLOR_MAP[eventDict.section_id]["color"],backgroundColor:e,borderColor:"#ffffff"})});$("#calendarui").fullCalendar("refetchEvents");CAL_LOADING=false}catch(b){CAL_LOADING=false}LO_hideLoading("cal loading")},10)}function Cal_render(){$("#calendarui").fullCalendar("render")}var timeoutIDs=[];var EVENTSMAN_COUNT=0;function EventsMan_init(){if(EVENTS_INIT){return}EVENTS_INIT=true;eventsManager=new _EventsMan_new();if(EventsMan_load()){EVENTS_READY=true;EventsMan_callOnReadyListeners();_EventsMan_callUpdateListeners();EventsMan_verifyLocalData()}else{EventsMan_pullFromServer(function(){EVENTS_READY=true;EventsMan_callOnReadyListeners()},true)}PopUp_addEditListener(function(b,h,k){if(h=="event_type"){k=TYPE_MAP_INVERSE[k.toLowerCase()];if(b in eventsManager.events&&eventsManager.events[b][h]==k){return}if(!(b in eventsManager.uncommitted)){eventsManager.uncommitted[b]=EventsMan_cloneEventDict(eventsManager.events[b])}eventsManager.uncommitted[b][h]=k}else{if(h=="section_id"){k=SECTION_MAP_INVERSE[k.toLowerCase()];if(b in eventsManager.events&&eventsManager.events[b][h]==k){return}if(!(b in eventsManager.uncommitted)){eventsManager.uncommitted[b]=EventsMan_cloneEventDict(eventsManager.events[b])}eventsManager.uncommitted[b][h]=k}else{if(h=="event_date"){if(!(b in eventsManager.uncommitted)){eventsManager.uncommitted[b]=EventsMan_cloneEventDict(eventsManager.events[b])}var f=eventsManager.uncommitted[b];var c=moment.unix(f.event_start);var e=moment.unix(f.event_end);var l=moment(k);if(b in eventsManager.events&&l.date()==c.date()&&l.month()==c.month()&&l.year()==c.year()){return}c.year(l.year());c.month(l.month());c.date(l.date());e.year(l.year());e.month(l.month());e.date(l.date());f.event_start=c.unix();f.event_end=e.unix()}else{if(h=="event_start"||h=="event_end"){if(!(b in eventsManager.uncommitted)){eventsManager.uncommitted[b]=EventsMan_cloneEventDict(eventsManager.events[b])}k="April 25, 2014 "+k;var f=eventsManager.uncommitted[b];var d=moment.unix(f[h]);var j=moment(k);if(b in eventsManager.events&&d.minute()==j.minute()&&d.hour()==j.hour()){return}d.hour(j.hour());d.minute(j.minute());f[h]=d.unix()}else{if(h=="event_recurrence"){if(k){if(b in eventsManager.events&&"recurrence_days" in eventsManager.events[b]&&eventsManager.events[b].recurrence_days.equals(k)){return}if(!(b in eventsManager.uncommitted)){eventsManager.uncommitted[b]=EventsMan_cloneEventDict(eventsManager.events[b])}var f=eventsManager.uncommitted[b];var a=moment.unix(f.event_start);var g=(a.tz(MAIN_TIMEZONE).day()-1)%7;if(!k.contains(g)){k.push(g)}k.sort();f.recurrence_days=k;if(!("recurrence_interval" in f)){f.recurrence_interval=1}if(!("recurrence_end" in f)){f.recurrence_end=parseInt(CUR_SEM.end_date)}}else{if(b in eventsManager.events&&!("recurrence_days" in eventsManager.events[b])){return}if(!(b in eventsManager.uncommitted)){eventsManager.uncommitted[b]=EventsMan_cloneEventDict(eventsManager.events[b])}var f=eventsManager.uncommitted[b];delete f.recurrence_days;delete f.recurrence_end;delete f.recurrence_interval}}else{if(false&&h=="event_recurrence_interval"){if(b in eventsManager.events&&eventsManager.events[b]["reccurrence_interval"]==k){return}if(!(b in eventsManager.uncommitted)){eventsManager.uncommitted[b]=EventsMan_cloneEventDict(eventsManager.events[b])}var f=eventsManager.uncommitted[b];f.reccurence_interval=k}else{if(b in eventsManager.events&&eventsManager.events[b][h]==k){return}if(!(b in eventsManager.uncommitted)){eventsManager.uncommitted[b]=EventsMan_cloneEventDict(eventsManager.events[b])}eventsManager.uncommitted[b][h]=k}}}}}}eventsManager.uncommitted[b].modified_time=moment().unix();if(!(b in eventsManager.events)){SE_checkSimilarEvents(eventsManager.uncommitted[b])}_EventsMan_callUpdateListeners()});$(window).on("beforeunload",function(a){if(Object.getOwnPropertyNames(eventsManager.uncommitted).length>0){a.preventDefault();return"Your changes have not been saved. Are you sure you want to leave?"}EventsMan_pushToServer(false);EventsMan_save()});window.setInterval(function(){EVENTSMAN_COUNT++;if(!eventsManager.active&&(EVENTSMAN_COUNT%30)!=0){return}if((EVENTSMAN_COUNT%30)==0){EventsMan_verifyLocalData()}EventsMan_pushToServer(true);EventsMan_pullFromServer();EVENTSMAN_COUNT%=30},10*1000);$(window).on("mousemove click",function(){$.each(timeoutIDs,function(a){window.clearTimeout(this)});timeoutIDs=[];eventsManager.active=true;timeoutIDs.push(window.setTimeout(function(){eventsManager.active=false},30*1000))})}function EventsMan_pushToServer(b){if(!eventsManager.isIdle){return}eventsManager.isIdle=false;var a=[];$.each(eventsManager.updatedIDs.toArray(),function(c){a.push(eventsManager.events[this])});if(a.length>0||eventsManager.changed){$.ajax("/put",{dataType:"json",type:"POST",data:{events:JSON.stringify(a),hidden:JSON.stringify(eventsManager.hiddenIDs.toArray())},success:function(d){var e=d.changed_ids;$.each(e,function(h,g){var f=g[0];var k=g[1];if(h in eventsManager.events){var j=eventsManager.events[h];delete eventsManager.events[h];j.event_id=f;j.event_group_id=k;eventsManager.events[f]=j}if(h in eventsManager.uncommitted){var j=eventsManager.uncommitted[h];delete eventsManager.uncommitted[h];j.event_id=f;j.event_group_id=k;eventsManager.uncommitted[f]=j}EventsMan_callEventIDsChangeListener(h,f)});EventsMan_constructOrderArray();var c=d.deleted_ids;$.each(c,function(f){if(this in eventsManager.events){delete eventsManager.events[this]}if(this in eventsManager.uncommitted){delete eventsManager.uncommitted[this]}});eventsManager.isIdle=true;eventsManager.updatedIDs=new Set();eventsManager.changed=false;EventsMan_pullFromServer(null,true)},async:b,error:function(c){eventsManager.isIdle=true}})}else{eventsManager.isIdle=true}}function EventsMan_pullFromServer(a,b){if(!eventsManager.isIdle){return}if(eventsManager.updatedIDs.size>0||eventsManager.changed){return}b=typeof b!="undefined"?b:false;eventsManager.isIdle=false;var c="/get/"+eventsManager.lastSyncedTime;$.ajax(c,{dataType:"json",loadingIndicator:b,success:function(d){var e=EventsMan_processDownloadedEvents(d);eventsManager.isIdle=true;if(a!=null){a()}if(e){_EventsMan_callUpdateListeners()}},error:function(d){eventsManager.isIdle=true;LO_showError(c)}})}function EventsMan_processDownloadedEvents(e){var f=false;var c=e.events;for(var d=0;d<c.length;d++){var a=c[d];if(a.event_id in eventsManager.uncommitted){}if(a.event_id in eventsManager.updatedIDs){}else{eventsManager.events[a.event_id]=a}f=true}var b=Set.prototype.fromArray(e.hidden_events);if(!b.equals(eventsManager.hiddenIDs)&&!eventsManager.changed){eventsManager.hiddenIDs=b;f=true}EventsMan_constructOrderArray();eventsManager.addedCount=0;eventsManager.lastSyncedTime=moment().unix();return f}function EventsMan_verifyLocalData(){eventsManager.lastSyncedTime=0;EventsMan_pullFromServer()}function EventsMan_clickAddEvent(){var a=PopUp_getMainPopUp();if(PopUp_getID(a)){PopUp_callCloseListeners(PopUp_getID(a))}var b=EventsMan_addEvent();PopUp_setToEventID(a,b);PopUp_markAsUnsaved(a);PopUp_giveFocus(a)}function EventsMan_clickSync(){EventsMan_pushToServer();SR_save()}var KEY_UP=38;var KEY_DOWN=40;var KEY_LEFT=37;var KEY_RIGHT=39;var KEY_SQ_BRACE_R=221;var KEY_SQ_BRACE_L=219;var KEY_SHIFT=16;var SHIFT_PRESSED=false;$(document).keydown(function(b){var a=b.keyCode||b.which;switch(a){case KEY_UP:break;case KEY_DOWN:break;case KEY_LEFT:break;case KEY_RIGHT:break;case KEY_SQ_BRACE_R:$("#calendartab").tab("show");break;case KEY_SQ_BRACE_L:$("#agendatab").tab("show");break;case KEY_SHIFT:SHIFT_PRESSED=true;break}});$(document).keyup(function(){SHIFT_PRESSED=false});$(init);var NAV_ID=["agendatab","calendartab"];var TAB_ID=["agenda","calendar"];var SECTION_MAP;var SECTION_MAP_INVERSE;var COURSE_MAP;var COURSE_SECTIONS_MAP;var COURSE_FILTER_BLACKLIST;function init(){pinnedIDs=new Set();moment.tz.add({zones:{"America/New_York":["-4:56:2 - LMT 1883_10_18_12_3_58 -4:56:2","-5 US E%sT 1920 -5","-5 NYC E%sT 1942 -5","-5 US E%sT 1946 -5","-5 NYC E%sT 1967 -5","-5 US E%sT"]},rules:{US:["1918 1919 2 0 8 2 0 1 D","1918 1919 9 0 8 2 0 0 S","1942 1942 1 9 7 2 0 1 W","1945 1945 7 14 7 23 1 1 P","1945 1945 8 30 7 2 0 0 S","1967 2006 9 0 8 2 0 0 S","1967 1973 3 0 8 2 0 1 D","1974 1974 0 6 7 2 0 1 D","1975 1975 1 23 7 2 0 1 D","1976 1986 3 0 8 2 0 1 D","1987 2006 3 1 0 2 0 1 D","2007 9999 2 8 0 2 0 1 D","2007 9999 10 1 0 2 0 0 S"],NYC:["1920 1920 2 0 8 2 0 1 D","1920 1920 9 0 8 2 0 0 S","1921 1966 3 0 8 2 0 1 D","1921 1954 8 0 8 2 0 0 S","1955 1966 9 0 8 2 0 0 S"]},links:{}});LO_init();$.ajaxSetup({beforeSend:function(e,d){if(!csrfSafeMethod(d.type)&&sameOrigin(d.url)){e.setRequestHeader("X-CSRFToken",csrftoken)}if(d.loadingIndicator==false){return}var c=d.loadingID;if(typeof c=="undefined"){c=d.url}LO_showLoading(c)}});$(document).ajaxSuccess(function(e,f,d){var c=d.loadingID;if(typeof c=="undefined"){c=d.url}LO_hideLoading(c)});$(document).ajaxError(function(e,f,d){var c=d.loadingID;if(typeof c=="undefined"){c=d.url}LO_hideLoading(c,false);if(d.loadingIndicator==false){return}LO_showError(c)});CacheMan_init();SECTION_MAP=JSON.parse(CacheMan_load("/all-sections"));SECTION_MAP_INVERSE={};$.each(SECTION_MAP,function(c,d){SECTION_MAP_INVERSE[d.toLowerCase()]=c});SECTION_COLOR_MAP=JSON.parse(CacheMan_load("/get/section-colors"));var b=JSON.parse(CacheMan_load("/all-courses"));COURSE_MAP=b.courses;COURSE_SECTIONS_MAP=b.course_sections_map;COURSE_FILTER_BLACKLIST=new Set();if("localStorage" in window&&window.localStorage!==null){var a=localStorage.getItem("sectionsmap");if(!a){clearLocalStorage()}else{if(a!=CacheMan_load("/get/sections")){clearLocalStorage()}}localStorage.setItem("sectionsmap",CacheMan_load("/get/sections"))}SB_init();SR_init();EventsMan_init();PopUp_init();NO_init();Agenda_init();Cal_init();SE_init();SR_addWillSaveListener(function(){Nav_save();UI_save()});SR_addDidLoadListener(function(){Nav_load();UI_load()});EventsMan_addEventIDsChangeListener(function(d,c){if(UI_isMain(d)){UI_setMain(c)}else{if(UI_isPinned(d)){UI_unpin(d);UI_pin(c)}}});if(THEME=="w"){loadWhiteTheme()}else{loadDarkTheme()}$(".withtooltip").tooltip({});$(window).on("resize",function(c){adaptSize()});adaptSize();if("localStorage" in window&&window.localStorage!==null){localStorage.setItem("user",USER_NETID)}UR_pullUnapprovedRevisions();setInterval(function(){UR_pullUnapprovedRevisions()},5*60*1000);setInterval(function(){updatePoints()},60*1000)}function adaptSize(){if(window.innerWidth<=768){$("#agendatab").tab("show");$("#sb-left-container").removeClass("col-xs-4 col-xs-12 col-xs-8");$("#sb-left-container").addClass("col-xs-8")}else{$("#sb-left-container").removeClass("col-xs-4 col-xs-12 col-xs-8");$("#sb-left-container").addClass("col-xs-4")}if(window.innerWidth<=400){$("#sb-left-container").removeClass("col-xs-4 col-xs-12 col-xs-8");$("#sb-left-container").addClass("col-xs-12");$(".agenda-container").children(".col-xs-4").removeClass("col-xs-4 col-xs-offset-1").addClass("col-xs-12")}else{$(".agenda-container").children(".col-xs-12").addClass("col-xs-4 col-xs-offset-1").removeClass("col-xs-12")}}function Nav_save(){var a=$("#maintab").find(".active").find("a")[0].id;SR_put("nav_page",NAV_ID.indexOf(a))}function Nav_load(){var a=SR_get("nav_page");if(a==null){return}$("#maintab #"+NAV_ID[a]).tab("show")}function UI_save(){SR_put("pinned_IDs",JSON.stringify(pinnedIDs));SR_put("main_ID",mainID)}function UI_load(){if(SR_get("pinned_IDs")!=null){var a=JSON.parse(SR_get("pinned_IDs"));$.each(a,function(b,c){if(PopUp_getPopUpByID(b)!=null){UI_pin(b)}})}if(SR_get("main_ID")!=null){if(SR_get("main_ID")!="null"){if(PopUp_getPopUpByID(SR_get("main_ID"))!=null){UI_setMain(SR_get("main_ID"))}}}}function disableAllInteractions(){var a=$('<div id="disabler"></div>');$(a).prependTo(".tab-content").css({height:"100%",width:"100%",opacity:0,position:"absolute",left:0,top:0,"z-index":900,cursor:"not-allowed"})}function enableAllInteractions(){$("#disabler").remove()}function toggleInfo(){$(".main-content").toggleClass("main-hidden");$("#about-content").toggleClass("about-hidden")}function onLogOut(){clearLocalStorage()}function clearLocalStorage(){if("localStorage" in window&&window.localStorage!==null){localStorage.removeItem("sectionsmap");localStorage.removeItem("eventsman.events");localStorage.removeItem("eventsman.hidden");localStorage.removeItem("eventsman.lastsyncedtime");localStorage.removeItem("user");localStorage.removeItem("state-restoration")}}function updatePoints(){$.ajax("/api/point_count",{loadingIndicator:false,dataType:"json",success:function(a){POINT_COUNT=a;$("#point_count").text(POINT_COUNT+" points")}})}var NO_TYPES={WARNING:"alert-warning",INFO:"alert-info"};function NO_init(){PopUp_addCloseListener(function(a){NO_removeNotificationID(a)})}function NO_showNotification(e,d,a,c){var b;if(NO_hasNotificationID(e)){b=$("#"+e+".alert")}else{b=$("<div>").addClass("alert").addClass("alert-dismissible");b.append('<button id="close_button" type="button" class="close" aria-hidden="true">&times;</button>');$('<span id="noti-content">').appendTo(b);b.attr("id",e);SB_push(b)}b.addClass(a);$text=$("<a>").addClass("alert-link").text(d).on("click",function(f){f.preventDefault();b.trigger("noti.click");SB_pop(b)});b.find("#close_button").on("click",function(f){f.preventDefault();NO_removeNotificationID(b.attr("id"))});b.find("#noti-content").append($text);if(c){$.each(c,function(f,g){b.data(f,g)})}return b}function NO_hasNotificationID(a){return $("#"+a+".alert").length>0}function NO_removeNotificationID(a){if(!NO_hasNotificationID(a)){return}SB_pop($("#"+a+".alert.in")[0]);SB_hideIfEmpty()}POPUP_CLASS="popup-event";function PopUp_init(){if(POPUP_INIT){return}POPUP_INIT=true;POPUP_HTML=$("#popup-template").html();$("#popup-template").remove();var a=$.ui.draggable.prototype._mouseStart;$.ui.draggable.prototype._mouseStart=function(c,d,b){this._trigger("beforeStart",c,this._uiHash());a.apply(this,[c,d,b])};topPos=parseInt($(".navbar").css("height"))+parseInt($(".navbar").css("margin-top"));height=window.innerHeight-topPos+300;$("#content_bounds").css("top",topPos+"px").css("height",height).css("left","-20%").css("width","140%");$(window).on("resize",function(b){topPos=parseInt($(".navbar").css("height"))+parseInt($(".navbar").css("margin-top"));height=window.innerHeight-topPos+300;$("#content_bounds").css("top",topPos+"px").css("height",height).css("left","-20%").css("width","140%")});EventsMan_addOnReadyListener(function(){PopUp_load()});SR_addWillSaveListener(function(){PopUp_save()});EventsMan_addEventIDsChangeListener(function(d,b){var c=PopUp_getPopUpByID(b);if(c){PopUp_close(c)}var c=PopUp_getPopUpByID(d);if(c){PopUp_setToEventID(c,b)}});EventsMan_addUpdateListener(function(){PopUp_map(function(c,b){if(EventsMan_hasEvent(PopUp_getID(c))&&EventsMan_eventShouldBeShown(PopUp_getID(c))){PopUp_setToEventID(c,PopUp_getID(c))}else{PopUp_close(c)}})})}function PopUp_initialize_deferred(a){if($(a).find(".withdatepicker")[0].type=="text"){$(a).find(".withdatepicker").datetimepicker({format:"MM d, yyyy",autoclose:true,minView:2,maxView:3})}else{$(a).find(".withdatepicker").removeClass("withdatepicker")}if($(a).find(".withtimepicker")[0].type=="text"){$(a).find(".withtimepicker").datetimepicker({format:"H:ii P",formatViewType:"time",autoclose:true,minView:0,maxView:1,startView:0,linkField:"withdatepicker",linkFormat:"yyyy-mm-dd",showMeridian:true,minuteStep:10,startDate:new Date(moment("Dec 31, 1899 12:00 AM").unix()*1000),endDate:new Date(moment("Jan 1, 1900 12:00 AM").unix()*1000)})}else{$(a).find(".withtimepicker").removeClass("withtimepicker")}}function PopUp_initialize(c){var d=[];$.each(DAYS_DICT,function(e){d.push({value:e,pretty:this,selected:false})});var a=SCM_initWithChoices("",d);$(c).find("#popup-repeat-pattern").append(a);var d=[{value:1,pretty:"Every week",selected:false},{value:2,pretty:"Every 2 weeks",selected:false},{value:4,pretty:"Every month",selected:false}];var b=SC_initWithChoices("",d);$(c).find("#popup-repeat-interval").append(b)}function PopUp_setToEventID(c,a){PopUp_setID(c,a);var l;$(c).find(".unsaved").removeClass("unsaved");if(EventsMan_hasUncommitted(a)){l=EventsMan_getUncommitted(a);PopUp_markAsUnsaved(c);var n=EventsMan_getEventByID(a);if(n){if(n.event_title!=l.event_title){$(c).find("#popup-title").addClass("unsaved")}if(n.event_location!=l.event_location){$(c).find("#popup-loc").addClass("unsaved")}if(n.event_description!=l.event_description){$(c).find("#popup-desc").addClass("unsaved")}if(n.event_type!=l.event_type){$(c).find("#popup-type").addClass("unsaved")}if(n.section_id!=l.section_id){$(c).find("#popup-section").addClass("unsaved")}var b=moment.unix(l.event_start);var e=moment.unix(n.event_start);if(b.year()!=e.year()||b.month()!=e.month()||b.date()!=e.date()){$(c).find("#popup-date").addClass("unsaved")}if(b.hour()!=e.hour()||b.minute()!=e.minute()){$(c).find("#popup-time-start").addClass("unsaved")}var f=moment.unix(l.event_end);var o=moment.unix(n.event_end);if(f.hour()!=o.hour()||f.minute()!=o.minute()){$(c).find("#popup-time-end").addClass("unsaved")}}}else{l=EventsMan_getEventByID(a);PopUp_markAsSaved(c)}if(!l){console.log("errorneous event id");PopUp_close(c);return}PopUp_setTitle(c,l.event_title);PopUp_setDescription(c,l.event_description);PopUp_setLocation(c,l.event_location);PopUp_setSection(c,l.section_id);PopUp_setType(c,l.event_type);PopUp_setDate(c,l.event_start);PopUp_setStartTime(c,l.event_start);PopUp_setEndTime(c,l.event_end);var d=SECTION_COLOR_MAP[l.section_id];if(!d){d="#555555"}else{d=d.color}PopUp_setColor(c,d);$(c).find("#popup-repeat")[0].checked=("recurrence_days" in l);$(c).find("#popup-repeat").off("change");$(c).find("#popup-repeat-pattern").off("select");$(c).find("#popup-repeat-interval").off("select");if("recurrence_days" in l){var j=l.recurrence_days;var p=[];$.each(DAYS_DICT,function(q){p.push({value:q,pretty:this,selected:j.contains(q)})});$(c).find(".popup-repeat-item").removeClass("hide");var m=$(c).find("#popup-repeat-pattern").children()[0];SCM_setToChoices(m,p);var h=$(c).find("#popup-repeat-interval").children()[0];var p=[{value:1,pretty:"Every week",selected:l.recurrence_interval==1},{value:2,pretty:"Every 2 weeks",selected:l.recurrence_interval==2},{value:4,pretty:"Every month",selected:l.recurrence_interval==4}];SC_setToChoices(h,p)}else{var p=[];$.each(DAYS_DICT,function(q){p.push({value:q,pretty:this,selected:false})});$(c).find(".popup-repeat-item").addClass("hide");var m=$(c).find("#popup-repeat-pattern").children()[0];SCM_setToChoices(m,p);var h=$(c).find("#popup-repeat-interval").children()[0];var p=[{value:1,pretty:"Every week",selected:true},{value:2,pretty:"Every 2 weeks",selected:false},{value:4,pretty:"Every month",selected:false}];SC_setToChoices(h,p)}$(c).find("#popup-repeat").on("change",function(q){if(this.checked){if(!("recurrence_days" in l)){PopUp_markAsUnsaved(c)}$(c).find(".popup-repeat-item").removeClass("hide");PopUp_callEditListeners(PopUp_getID(c),"event_recurrence",[])}else{if("recurrence_days" in l){PopUp_markAsUnsaved(c)}$(c).find(".popup-repeat-item").addClass("hide");PopUp_callEditListeners(PopUp_getID(c),"event_recurrence",null)}});$(c).find("#popup-repeat-pattern").on("select",function(q,s){var r=[];$.each(s,function(u,t){if(t){r.push(parseInt(u))}});r.sort();if(EventsMan_hasUncommitted(a)){l=EventsMan_getUncommitted(a)}else{l=EventsMan_getEventByID(a)}if(!("recurrence_days" in l)){PopUp_markAsUnsaved(c)}else{if(!r.equals(l.recurrence_days)){PopUp_markAsUnsaved(c)}}PopUp_callEditListeners(PopUp_getID(c),"event_recurrence",r)});$(c).find("#popup-repeat-interval").on("select",function(q,r){$.each(r,function(t,s){if(s){if(EventsMan_hasUncommitted(a)){l=EventsMan_getUncommitted(a)}else{l=EventsMan_getEventByID(a)}if(l.recurrence_interval!=t){PopUp_markAsUnsaved(c)}PopUp_callEditListeners(PopUp_getID(c),POPUP_EDITDICT["popup-repeat-interval"],t)}})});if(EventsMan_eventIsHidden(a)){$(c).find("#unhide_button").removeClass("hide");$(c).find("#hide_button").addClass("hide")}else{$(c).find("#unhide_button").addClass("hide");$(c).find("#hide_button").removeClass("hide")}var p=[];$.each(TYPE_MAP,function(q,r){p.push({value:q,pretty:r,selected:l.event_type==q})});var k=SCP_initOnElement($(c).find(".withtypepicker")[0],c,null,p);$(k).on("select",function(r,s){var q;$.each(s,function(t,u){if(u){q=t;return false}});$(c).find(".withtypepicker").val(toTitleCase(TYPE_MAP[q]));$(c).find(".withtypepicker").trigger("value_set")});var p=[];$.each(SECTION_MAP,function(q,r){p.push({value:q,pretty:r,selected:l.section_id==q})});var g=SCP_initOnElement($(c).find(".withsectionpicker")[0],c,null,p);$(g).on("select",function(r,s){var q;$.each(s,function(t,u){if(u){q=t;return false}});$(c).find(".withsectionpicker").val(SECTION_MAP[q]);$(c).find(".withsectionpicker").trigger("value_set")});$(c).find(".withcustompicker").on("hidden.bs.popover",function(q){$(this).trigger("value_set")})}function PopUp_setTitle(a,b){a.querySelector(".popup-title").innerHTML=b}function PopUp_setDescription(a,b){$(a).find("#popup-desc").html(nl2br(b))}function PopUp_setLocation(a,b){$(a).find("#popup-loc").text(b)}function PopUp_setSection(a,b){$(a).find("#popup-section").text(SECTION_MAP[b])}function PopUp_setType(a,c){var b=toTitleCase(TYPE_MAP[c]);$(a).find("#popup-type").text(b)}function PopUp_setDate(b,c){var a=moment.unix(c).tz(MAIN_TIMEZONE);$(b).find("#popup-date").text(a.format("MMMM D, YYYY"))}function PopUp_setStartTime(a,c){var b=moment.unix(c).tz(MAIN_TIMEZONE);$(a).find("#popup-time-start").text(b.format("h:mm A"))}function PopUp_setEndTime(a,c){var b=moment.unix(c).tz(MAIN_TIMEZONE);$(a).find("#popup-time-end").text(b.format("h:mm A"))}function PopUp_save(){var b=[];PopUp_map(function(e,c){var d={};var f=[];d.id=PopUp_getID(e);f.push($(e).css("left"));f.push($(e).css("top"));f.push($(e).css("width"));f.push($(e).css("height"));d.frame=f;d.isMain=c;d.hasFocus=PopUp_hasFocus(e);b.push(d)});var a=JSON.stringify(b);SR_put("popup",a)}function PopUp_load(){if(SR_get("popup")==null){return}var a=JSON.parse(SR_get("popup"));$(a).each(function(b){popUp=PopUp_insertPopUp(this.isMain);if(!this.isMain){$(popUp).css("left",this.frame[0]);$(popUp).css("top",this.frame[1]);$(popUp).css("width",this.frame[2]);$(popUp).css("height",this.frame[3]);_PopUp_setBodyHeight(popUp)}PopUp_setToEventID(popUp,this.id);if(this.hasFocus){PopUp_giveFocus(popUp)}})}function PopUp_markAsUnsaved(a){$(a).find("#save_button").removeClass("hide");$(a).find("#undo_button").removeClass("hide")}function PopUp_markAsSaved(a){$(a).find("#save_button").addClass("hide");$(a).find("#undo_button").addClass("hide")}function PopUp_markIDAsNotEditing(a){PopUp_markAsNotEditing(PopUp_getPopUpByID(a))}function PopUp_markAsNotEditing(a){$(a).data("is_editing",false)}function PopUp_markAsEditing(a){$(a).data("is_editing",true)}function PopUp_isEditing(a){return $(a).data("is_editing")}function PopUp_makeIDDraggable(b){var a=PopUp_getPopUpByID(b);$(a).draggable("enable")}function _PopUp_showFormForElement(c){var b=_PopUp_getPopUp(c);$(c).addClass("hide");var a=_PopUp_Form_getFormIDForElement(c);var d=$(b).find("#"+a).removeClass("hide")[0]}function _PopUp_hideFormForElement(c){var b=_PopUp_getPopUp(c);$(c).addClass("hide");var a=_PopUp_Form_getElementIDForForm(c);$(b).find("#"+a).removeClass("hide")}function _PopUp_Form_getValue(a){if($(a).find("input").length>0){return $(a).find("input").val()}else{if($(a).find("textarea").length>0){return $(a).find("textarea").val()}}}function _PopUp_Form_setValue(b,d){if($(b).find("input").length>0){if($(b).find("input")[0].type=="date"){var a=moment(d).format("YYYY-MM-DD");$(b).find("input").val(a)}else{if($(b).find("input")[0].type=="time"){var c=moment("April 25, 2014 "+d).format("HH:mm:ss");$(b).find("input").val(c)}else{$(b).find("input").val(d)}}}else{if($(b).find("textarea").length>0){var e=br2nl(d);$(b).find("textarea").val(e)}}}function _PopUp_Form_giveFocus(a){if($(a).find("input").length>0){$(a).find("input")[0].focus()}else{if($(a).find("textarea").length>0){$(a).find("textarea")[0].focus()}}}function _PopUp_Form_getElementIDForForm(a){return a.id.split("-").slice(0,-1).join("-")}function _PopUp_Form_getFormIDForElement(a){return a.id+"-form"}function _PopUp_Form_addOnBlurListener(a,b){if($(a).find(".withdatepicker").length>0){$(a).find(".withdatepicker").datetimepicker().on("hide",b)}else{if($(a).find(".withtimepicker").length>0){$(a).find(".withtimepicker").datetimepicker().on("hide",b)}else{if($(a).find(".withcustompicker").length>0){$(a).find(".withcustompicker").on("value_set",b)}else{if($(a).find("input").length>0){$(a).find("input").on("blur",b)}else{if($(a).find("textarea").length>0){$(a).find("textarea").on("blur",b)}}}}}}function PopUp_clickedElement(d){var c=_PopUp_getPopUp(d);if(PopUp_isEditing(c)){return}_PopUp_Form_enforceStartDate(c);PopUp_markAsEditing(c);var b=_PopUp_Form_getFormIDForElement(d);var e=$(c).find("#"+b)[0];if($(e).find("textarea").length>0){height=parseInt($(d).css("height"))+20;$(e).find("textarea").css("height",height+"px")}_PopUp_showFormForElement(d);_PopUp_Form_setValue(e,d.innerHTML);_PopUp_Form_giveFocus(e);if(!$(e).hasClass("input-group")&&e.notFirstSelected!=true){e.notFirstSelected=true;_PopUp_Form_addOnBlurListener(e,function(){PopUp_clickedSaveElement(e)})}var a=_PopUp_Form_getElementIDForForm(e);if(a=="popup-title"){$(c).find(".popup-ctrl").addClass("hidden")}$(e).find("input").off("keyup").on("keyup",function(f){var g=f.keyCode||f.which;if(g==13){PopUp_clickedSaveElement(e)}});$(e).find(".withtimepicker").off("keyup").off("keydown").on("keydown",function(f){f.preventDefault()});$(e).find(".withdatepicker").off("keyup").off("keydown").on("keydown",function(f){f.preventDefault()});$(e).find(".withcustompicker").off("keyup").off("keydown").on("keydown",function(f){f.preventDefault()})}function _PopUp_Form_enforceStartDate(b){var c=$(b).find("#popup-time-start").text();var a=moment("Dec 31, 1899 "+c);$(b).find("#popup-time-end-form").find(".withtimepicker").datetimepicker("setStartDate",new Date(a.unix()*1000));$(b).find("#popup-time-end-form").find("input").not(".withtimepicker").attr("min",a.format("HH:mm:ss"))}function PopUp_clickedSaveElement(c){if(!/\S/.test(_PopUp_Form_getValue(c))){_PopUp_Form_giveFocus(c);return}var b=_PopUp_getPopUp(c);PopUp_markAsNotEditing(b);_PopUp_hideFormForElement(c);var a=_PopUp_Form_getElementIDForForm(c);if(a=="popup-title"){$(b).find(".popup-ctrl").removeClass("hidden");if(UI_isMain(PopUp_getID(b))){$(b).find(".poup-ctrl-right").addClass("hidden")}}var e=$(b).find("#"+a)[0];var d=_PopUp_Form_getValue(c).escapeHTML();if($(c).find("input").length>0&&$(c).find("input")[0].type=="date"){d=moment(d).tz(MAIN_TIMEZONE).format("MMMM D, YYYY")}else{if($(c).find("input").length>0&&$(c).find("input")[0].type=="time"){d=moment("April 25, 2014 "+d).tz(MAIN_TIMEZONE).format("h:mm A")}}if($(e).html()==nl2br(d)){return}$(e).html(nl2br(d));if(a=="popup-time-start"){_PopUp_Form_enforceStartDate(b)}PopUp_markAsUnsaved(b);PopUp_callEditListeners(PopUp_getID(b),POPUP_EDITDICT[a],_PopUp_Form_getValue(c))}function PopUp_clickedClose(a){var b=a;while(!$(b).hasClass("popup")){b=$(b).parent()[0]}if(PopUp_isEditing(b)){return}if(EventsMan_hasUncommitted(PopUp_getID(b))){AS_showActionSheetFromElement($(b).find("#close_button")[0],b,"Save changes?",[{important:false,text:"Save"},{important:true,text:"Don't save"}],function(c){if(c==0){PopUp_clickedSavePopUp(b,true)}else{PopUp_clickedUndo(b);PopUp_clickedClose(b)}});return}if(PopUp_getID(b)){PopUp_callCloseListeners(PopUp_getID(b))}PopUp_close(b)}function PopUp_clickedDelete(a){var b=_PopUp_getPopUp(a);if(PopUp_isEditing(b)){return}var c=PopUp_getID(b);var d=EventsMan_getEventByID(c);if(d&&"recurrence_days" in d){AS_showActionSheetFromElement(a,b,"Done with this event? Click to hide from your agenda and calendar.",[{important:false,text:"Only this event"},{important:true,text:"All future events"}],function(e){if(e==0){EventsMan_deleteEvent(c);if(!EventsMan_eventShouldBeShown(c)){PopUp_close(b)}}else{EventsMan_deleteAllFutureEvents(c);if(!EventsMan_eventShouldBeShown(c)){PopUp_close(b)}}});return}EventsMan_deleteEvent(c);if(!EventsMan_eventShouldBeShown(c)){PopUp_close(b)}}function PopUp_clickedUnhide(a){var b=_PopUp_getPopUp(a);if(PopUp_isEditing(b)){return}var c=PopUp_getID(b);var d=EventsMan_getEventByID(c);if("recurrence_days" in d){AS_showActionSheetFromElement(a,b,null,[{important:false,text:"Only this event"},{important:true,text:"All future events"}],function(e){if(e==0){EventsMan_unhideEvent(c)}else{EventsMan_unhideAllFutureEvents(c)}});return}EventsMan_unhideEvent(c)}function PopUp_clickedSavePopUp(b,d){var a=_PopUp_getPopUp(b);if(PopUp_isEditing(a)){return}d=d||false;var f=PopUp_getID(a);if(SE_hasSimilarEvents(f)){AS_showActionSheetFromElement($(a).find("#save_button")[0],a,"There seems to be a similar event already on the calendar",[{important:false,text:"Show similar events"},{important:true,text:"Save anyways"}],function(g){if(g==0){NO_showSimilarEvents(PopUp_getID(a))}else{NO_removeSimilarEventsNotification(PopUp_getID(a));PopUp_clickedSavePopUp(a)}});return}var e=EventsMan_getEventByID(f);var c=EventsMan_getUncommitted(f);if(e&&"recurrence_days" in e&&"recurrence_days" in c){if(e.recurrence_days.equals(c.recurrence_days)&&e.recurrence_interval==c.recurrence_interval){AS_showActionSheetFromElement($(a).find("#save_button")[0],a,"This event is part of a recurring event.",[{important:false,text:"Only this event"},{important:true,text:"All future events"}],function(g){PopUp_markAsSaved(a);$(a).find(".unsaved").removeClass("unsaved");if(g==0){EventsMan_commitChanges(f)}else{EventsMan_commitChangesToAllFutureEvents(f)}if(d){PopUp_clickedClose(a)}});return}}PopUp_markAsSaved(a);$(a).find(".unsaved").removeClass("unsaved");EventsMan_commitChanges(f);if(d){PopUp_clickedClose(a)}}function PopUp_clickedUndo(b){var a=_PopUp_getPopUp(b);if(PopUp_isEditing(a)){return}var c=PopUp_getID(a);$(a).find("#save_button").addClass("hide");$(a).find("#undo_button").addClass("hide");$(a).find(".unsaved").removeClass("unsaved");EventsMan_cancelChanges(c)}var SE_id="settingsModal";function SE_init(){$("#"+SE_id).on("show.bs.modal",function(){var f=SE_addTypeSegmentedControlWithFilter("Visible in agenda:",AGENDA_FILTER);$(this).find("#agenda_options").append(f);var b=SE_addTypeSegmentedControlWithFilter("Visible in calendar:",CAL_FILTER);$(this).find("#calendar_options").append(b);var e=SC_initWithChoices("Theme",[{value:"w",pretty:"White",selected:THEME=="w"},{value:"b",pretty:"Black",selected:THEME=="b"}]);$(e).on("select",function(h,j){var g;$.each(j,function(k,l){if(l){g=k;return false}});THEME=g;if(g=="w"){loadWhiteTheme()}else{loadDarkTheme()}});$(this).find("#theme_options").append(e);var a=SC_initWithChoices("Show hidden events",[{value:1,pretty:"Yes",selected:EventsMan_showHidden()},{value:0,pretty:"No",selected:!EventsMan_showHidden()}]);$(a).on("select",function(g,h){$.each(h,function(j,k){if(k){EventsMan_showHidden(Boolean(parseInt(j)))}})});$(this).find("#hidden_options").append(a);var d=[];$.each(COURSE_MAP,function(g,h){d.push({value:g,pretty:h,selected:!(g in COURSE_FILTER_BLACKLIST)})});var c=SCM_initWithChoices("Visible courses:",d);$(c).on("select",function(g,h){$.each(h,function(j,k){if(k){COURSE_FILTER_BLACKLIST.remove(j)}else{COURSE_FILTER_BLACKLIST.add(j)}})});$(this).find("#course_options").append(c)});$("#"+SE_id).on("hide.bs.modal",function(){$(this).trigger("close");$.ajax("/put/ui-pref",{dataType:"json",type:"POST",data:{agenda_pref:JSON.stringify(AGENDA_FILTER),calendar_pref:JSON.stringify(CAL_FILTER),ui_pref:JSON.stringify({theme:THEME})},loadingIndicator:false})});$("#"+SE_id).on("hidden.bs.modal",function(){SC_removeAllFromContainer(this)})}function SE_addTypeSegmentedControlWithFilter(c,b){var d=[];$.each(TYPE_MAP,function(e,f){d.push({value:e,pretty:f,selected:b.contains(e)})});var a=SCM_initWithChoices(c,d);$(a).on("select",function(e,f){b.splice(0,b.length);$.each(f,function(h,g){if(g){b.push(h)}})});return a}function SE_checkSimilarEvents(a){if(SE_hasSimilarEvents(a.event_id)||SB_isFull()){return}$.ajax("/get/similar-events",{data:{event_dict:JSON.stringify(a)},dataType:"json",type:"POST",loadingIndicator:false,success:function(b){if(b.length>0){SE_showSimilarEventsNotification(a.event_id,b)}}})}function SE_showSimilarEventsNotification(a,c){var b=NO_showNotification(a,"A similar event already exists",NO_TYPES.WARNING,null);b.on("noti.click",function(d){SE_showSimilarEvents(a,c)})}function SE_hasSimilarEvents(a){return NO_hasNotificationID(a)}function SE_showSimilarEvents(d,e){var f=[];$.each(e,function(g,h){f.push({eventID:d,eventDict:h,buttons:[{value:"c",pretty:"Choose"}]})});var b=EP_init("Is this the same as your event?",f);SB_setMainContent(b);SB_fill();var c=PopUp_getPopUpByID(d);PopUp_markAsEditing(c);if(PopUp_hasMain()&&!PopUp_isMain(c)){var a=PopUp_getMainPopUp();PopUp_callCloseListeners(PopUp_getID(a));$(a).remove()}SB_push(c);PopUp_updateSize(c);PopUp_makeMain(c);$(c).draggable("disable");$(b).on("ep.cancel ep.select",function(g){PopUp_markAsNotEditing(c);$(c).draggable("enable");SB_pop(this);SB_unfill()});$(b).on("ep.select",function(g,h){EventsMan_replaceEventIDWithEvent(h.eventID,h.eventDict)})}var SR_willSaveListeners=[];var SR_didLoadListeners=[];var SR_ON=true;var SR_manager={};var SR_loaded=false;function SR_init(){SR_load();$(window).on("beforeunload",function(){SR_save()})}function SR_get(a){if(a in SR_manager){return SR_manager[a]}else{return null}}function SR_put(a,b){SR_manager[a]=b}function SR_load(){if(!SR_ON){return}if("localStorage" in window&&window.localStorage!==null){var b=localStorage.getItem("state-restoration");var a=localStorage.getItem("user");if(a==USER_NETID&&b){SR_manager=JSON.parse(b)}}SR_loaded=true;SR_callDidLoadListeners()}function SR_save(){if(!SR_ON){return}SR_callWillSaveListeners();if("localStorage" in window&&window.localStorage!==null){localStorage.setItem("state-restoration",JSON.stringify(SR_manager))}}function SR_addWillSaveListener(a){SR_willSaveListeners.push(a)}function SR_callWillSaveListeners(){$.each(SR_willSaveListeners,function(a){this()})}function SR_addDidLoadListener(a){if(SR_loaded){a()}else{SR_didLoadListeners.push(a)}}function SR_callDidLoadListeners(){$.each(SR_didLoadListeners,function(a){this()});SR_didLoadListeners=null}function UR_pullUnapprovedRevisions(){if(UR_hasUnapprovedRevisions()||SB_isFilled()){return}$.ajax("/get/unapproved",{async:true,dataType:"json",loadingIndicator:false,success:function(a){if(a&&a.length>0){var b=NO_showNotification("unapproved-rev","There are unapproved changes",NO_TYPES.INFO,null);b.on("noti.click",function(c){UR_showUnapprovedRevisions(a)})}}})}function UR_hasUnapprovedRevisions(){return NO_hasNotificationID("unapproved-rev")}function UR_showUnapprovedRevisions(b){var c=[];$.each(b,function(e,d){c.push({eventID:d.event_id,eventDict:d,buttons:[{value:"up",pretty:'<span class="glyphicon glyphicon-thumbs-up"></span>'},{value:"down",pretty:'<span class="glyphicon glyphicon-thumbs-down"></span>'}]})});var a=EP_init("Does this change look correct?",c);SB_setMainContent(a);SB_fill();EP_adjustPopUpSize(a);UR_updateLeft(0,b);$(a).on("ep.cancel",function(d){UR_close(this)});$(a).on("ep.select",function(d,e){$.ajax("/put/votes",{data:{votes:JSON.stringify([{is_positive:e.button=="up",revision_id:parseInt(e.eventDict.revision_id)}])},type:"POST",success:function(f){updatePoints()}});if(b.length==1){UR_close(this)}else{EP_removeItemAtIndex(a,e.index);b.splice(e.index,1)}});$(a).on("ep.slid",function(d,e){UR_updateLeft(e.index,b)})}function UR_updateLeft(a,b){if(EventsMan_hasEvent(b[a].event_id)){var c=PopUp_getMainPopUp();PopUp_setToEventID(c,b[a].event_id);$(c).draggable("disable")}else{if(PopUp_hasMain()){var c=PopUp_getMainPopUp();PopUp_close(c)}}}function UR_close(a){var b=PopUp_getMainPopUp();PopUp_close(b);SB_pop(a);SB_unfill();SB_hide();LO_showTemporaryMessage("Thanks for voting!",LO_TYPES.SUCCESS);EventsMan_verifyLocalStorage()};
=======
function AS_showActionSheetFromElement(d,a,e,f,b){var c=$("<div>");$.each(f,function(g){var h=$("<a>").addClass("white-link-btn").addClass("prompt-btn theme").attr("id",g).text(this.text);if(this.important){h=h.addClass("no")}else{h=h.addClass("yes")}h.on("click",function(j){j.preventDefault();$(d).blur();b(g)});c.append(h)});if(THEME=="w"){c.find(".theme").removeClass("dark")}else{c.find(".theme").addClass("dark")}$(d).popover({title:e,placement:"bottom",html:true,content:c[0],trigger:"focus",container:$(a)});$(d).focus()}var cacheManager=null;var CACHE_INIT=false;function CacheMan_init(){if(CACHE_INIT){return}CACHE_INIT=true;cacheManager=new _CacheMan();if(typeof CACHEMAN_PRELOAD!="undefined"){$.each(CACHEMAN_PRELOAD,function(a,b){cacheManager.cached[a]=b})}}function _CacheMan(){this.cached={};return this}function CacheMan_load(a){if(cacheManager.cached[a]==null){_CacheMan_cacheURL(a,false);return CacheMan_load(a)}return cacheManager.cached[a]}function _CacheMan_cacheURL(a,b){$.ajax(a,{async:b,dataType:"html",success:function(c){cacheManager.cached[a]=c}})}var CAL_LOADING=false;var FACTOR_LUM=0.2;var FACTOR_TRANS=0.7;CAL_INIT=false;Cal_eventSource={events:[]};Cal_options={defaultView:"agendaWeek",slotMinutes:45,firstHour:8,minTime:8,maxTime:23,eventDurationEditable:false,eventStartEditable:false,eventBackgroundColor:"#74a2ca",eventBorderColor:"#428bca",allDayDefault:false,eventSources:[Cal_eventSource],ignoreTimezone:false,allDaySlot:false,slotEventOverlap:true};function Cal_init(){}function Cal_highlightEvent(b,a){if(!b.highlighted){b.backgroundColor=setOpacity(b.backgroundColor,1);b.textColor="#ffffff"}b.highlighted=true;if(a){$("#calendarui").fullCalendar("updateEvent",b)}}function Cal_unhighlightEvent(b,a){if(b.highlighted){b.textColor=b.myColor;b.backgroundColor=setOpacity(b.backgroundColor,FACTOR_TRANS)}b.highlighted=false;if(a){$("#calendarui").fullCalendar("updateEvent",b)}}function colorLuminance(e,a){e=String(e).replace(/[^0-9a-f]/gi,"");if(e.length<6){e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]}a=a||0;var b="#",f,d;for(d=0;d<3;d++){f=parseInt(e.substr(d*2,2),16);f=Math.round(Math.min(Math.max(0,f+(f*a)),255)).toString(16);b+=("00"+f).substr(f.length)}return b}function luminanceToRgb(c){var e=parseInt(c.substring(1,3),16);var d=parseInt(c.substring(3,5),16);var a=parseInt(c.substring(5,7),16);return[e,d,a]}function rgbToRgba(a,b){return"rgba("+a[0]+", "+a[1]+", "+a[2]+", "+b+")"}function RGBtoRGBA(h,f,c){if((f==void 0)&&(typeof h=="string")){h=h.replace(/^\s*#|\s*$/g,"");if(h.length==3){h=h.replace(/(.)/g,"$1$1")}f=parseInt(h.substr(2,2),16);c=parseInt(h.substr(4,2),16);h=parseInt(h.substr(0,2),16)}var e,d=(255-(e=Math.min(h,f,c)))/255;return{r:h=0|(h-e)/d,g:f=0|(f-e)/d,b:c=0|(c-e)/d,a:d=(0|1000*d)/1000,rgba:"rgba("+h+", "+f+", "+c+", "+d+")"}}function setOpacity(c,b){for(i=c.length-1;i>0;i--){if(c[i]==" "){break}}var a=c.substring(0,i+1)+b+")";return a}function EP_init(b,c){var a=$(CacheMan_load("event-picker"));a.find("#ep-title").text(b);a.data("count",c.length);$.each(c,function(g,d){var f=$(CacheMan_load("event-picker-item"));if(g==0){f.addClass("active")}var e=f.find(".popup-ep")[0];var h=d.eventDict;PopUp_setTitle(e,h.event_title);PopUp_setDescription(e,h.event_description);PopUp_setLocation(e,h.event_location);PopUp_setSection(e,h.section_id);PopUp_setType(e,h.event_type);PopUp_setDate(e,h.event_start);PopUp_setStartTime(e,h.event_start);PopUp_setEndTime(e,h.event_end);$.each(d.buttons,function(j,l){var k=$("<a>").addClass("white-link-btn").addClass("theme").css({display:"inline"});k.html(l.pretty);k.data("value",l.value);k.on("click",function(n){n.preventDefault();var m=$(this).closest(".item.active").index();a.trigger("ep.select",{eventID:d.eventID,eventDict:d.eventDict,button:$(this).data("value"),index:m})});f.find("#ep-item-controls").append(k)});a.find("#ep-container").append(f)});if(THEME=="w"){a.find(".theme").removeClass("dark")}else{a.find(".theme").addClass("dark")}a.find("#cancel_button").on("click",function(d){d.preventDefault();a.trigger("ep.cancel")});a.on("slid.bs.carousel",function(f){_EP_updateButtons(this);var e=$(this).find(".item.active").index();var d=c[e];$(this).trigger("ep.slid",{eventID:d.eventID,eventDict:d.eventDict,index:e})});_EP_updateButtons(a[0]);return a[0]}function EP_adjustPopUpSize(a){$(a).find(".popup-ep").each(function(){_PopUp_setBodyHeight(this)})}function _EP_updateButtons(c){var b=$(c);var a=b.find(".item.active").index();b.find(".ep-control").removeClass("disabled-btn");if(a==0){b.find(".left.ep-control").addClass("disabled-btn")}if(a==b.data("count")-1){b.find(".right.ep-control").addClass("disabled-btn")}}function EP_removeItemAtIndex(a,b){var d=$(a).data("count");var e=$(a).find(".item").filter(function(){return $(this).index()==b});if(e.hasClass("active")){var c=(b+1)%d;$(a).one("slid.bs.carousel",function(f){e.remove();$(this).data("count",d-1);_EP_updateButtons(this)});$(a).carousel(c);return}e.remove();$(a).data("count",d-1)}var eventsManager=null;var EventsMan_updateListeners=[];var EventsMan_onReadyListeners=[];var EventsMan_eventIDsChangeListener=[];var EVENTS_INIT=false;var EVENTS_READY=false;function EventsMan_init(){}function _EventsMan_new(){this.events={};this.order=[];this.lastSyncedTime=0;this.addedCount=0;this.updatedIDs=new Set();this.uncommitted={};this.hiddenIDs=new Set();this.changed=false;this.isIdle=true;this.showHidden=false;return this}function EventsMan_constructOrderArray(){eventsManager.order=[];$.each(eventsManager.events,function(a,b){eventsManager.order.push({event_start:b.event_start,event_id:a})});eventsManager.order.sort(function(d,c){return parseInt(d.event_start)-parseInt(c.event_start)})}function EventsMan_showHidden(a){if(typeof a!="undefined"){eventsManager.showHidden=a;_EventsMan_callUpdateListeners()}return eventsManager.showHidden}function EventsMan_getEventByID(a){return eventsManager.events[a]}function EventsMan_hasEvent(a){return(a in eventsManager.events)||(a in eventsManager.uncommitted)}function EventsMan_getEventIDForRange(g,c){var f=0;while(f<eventsManager.order.length&&eventsManager.order[f].event_start<g){f++}var b=f;while(f<eventsManager.order.length&&eventsManager.order[f].event_start<c){f++}var a=Math.min(f,eventsManager.order.length);var e=eventsManager.order.slice(b,a);var d=[];for(var f=0;f<e.length;f++){if(EventsMan_showHidden()||!EventsMan_eventIsHidden(e[f].event_id)){d.push(e[f].event_id)}}return d}function EventsMan_getAllEventIDs(){var a=[];$.each(eventsManager.events,function(b,c){if(EventsMan_showHidden()||!EventsMan_eventIsHidden(b)){a.push(b)}});return a}function EventsMan_hasUncommitted(a){return a in eventsManager.uncommitted}function EventsMan_getUncommitted(a){return eventsManager.uncommitted[a]}function EventsMan_addEvent(){var d=String(-1*++eventsManager.addedCount);var b=123;for(var a in SECTION_MAP){b=a;break}var c={event_id:d,event_group_id:d,event_title:"Event Name",event_type:"AS",event_start:moment().unix(),event_end:moment().minute(moment().minute()+50).unix(),event_description:"Event description \n Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.",event_location:"Event location",course_id:-1,section_id:b,modified_user:USER_NETID,modified_time:moment().unix()};eventsManager.uncommitted[d]=c;return d}function EventsMan_deleteEvent(b,a){a=a||false;if(b in eventsManager.events){eventsManager.hiddenIDs.add(b);eventsManager.changed=true}if(b in eventsManager.uncommitted){eventsManager.uncommitted[b]=null;delete eventsManager.uncommitted[b]}if(b in eventsManager.updatedIDs){eventsManager.updatedIDs.remove(b)}if(!a){_EventsMan_callUpdateListeners()}}function EventsMan_deleteAllFutureEvents(d){var c=EventsMan_getEventByID(d);var b=moment.unix(c.event_start);b.year(b.year()+20);var a=EventsMan_getEventIDForRange(c.event_start,b.unix());$.each(a,function(e){var f=EventsMan_getEventByID(this);if(f.event_group_id==c.event_group_id&&f!=c){EventsMan_deleteEvent(this,true)}});EventsMan_deleteEvent(d)}function EventsMan_unhideEvent(b,a){a=a||false;if(b in eventsManager.events){eventsManager.hiddenIDs.remove(b);eventsManager.changed=true}if(!a){_EventsMan_callUpdateListeners()}}function EventsMan_unhideAllFutureEvents(d){var c=EventsMan_getEventByID(d);var b=moment.unix(c.event_start);b.year(b.year()+20);var a=EventsMan_getEventIDForRange(c.event_start,b.unix());$.each(a,function(e){var f=EventsMan_getEventByID(this);if(f.event_group_id==c.event_group_id&&f!=c){EventsMan_unhideEvent(this,true)}});EventsMan_unhideEvent(d)}function EventsMan_eventIsHidden(a){return a in eventsManager.hiddenIDs}function EventsMan_eventShouldBeShown(a){return !EventsMan_eventIsHidden(a)||EventsMan_showHidden()}function EventsMan_ready(){return EVENTS_READY}function EventsMan_commitChanges(c){var b=eventsManager.events[c];var a=eventsManager.uncommitted[c];eventsManager.events[c]=eventsManager.uncommitted[c];delete eventsManager.uncommitted[c];eventsManager.updatedIDs.add(c);EventsMan_constructOrderArray();if("recurrence_days" in b&&(!b.recurrence_days.equals(a.recurrence_days)||b.recurrence_interval!=a.recurrence_interval)){EventsMan_pushToServer(true)}_EventsMan_callUpdateListeners()}function EventsMan_cancelChanges(a){delete eventsManager.uncommitted[a];_EventsMan_callUpdateListeners()}function EventsMan_commitChangesToAllFutureEvents(g){var b=eventsManager.uncommitted[g];var c=eventsManager.events[g];var f=moment.unix(c.event_start);f.year(f.year()+20);var e=EventsMan_getEventIDForRange(c.event_start,f.unix());var a=moment.unix(b.event_start);var d=moment.unix(b.event_end);$.each(e,function(j){var l=EventsMan_getEventByID(this);if(l.event_group_id==c.event_group_id&&l!=c){l.event_title=b.event_title;l.event_description=b.event_description;l.event_location=b.event_location;l.section_id=b.section_id;l.event_type=b.event_type;l.modified_time=b.modified_time;l.modified_user=b.modified_user;var k=moment.unix(l.event_start).hour(a.hour());k.minute(a.minute());k.second(a.second());l.event_start=k.unix();var h=moment.unix(l.event_end).hour(d.hour());h.minute(d.minute());h.second(d.second());l.event_end=h.unix();eventsManager.updatedIDs.add(l.event_id)}});EventsMan_commitChanges(g)}function EventsMan_replaceUncommittedEventIDWithEvent(b,a){eventsManager.uncommitted[b]=null;delete eventsManager.uncommitted[b];eventsManager.uncommitted[a.event_id]=a;EventsMan_callEventIDsChangeListener(b,a.event_id);_EventsMan_callUpdateListeners()}function EventsMan_replaceEventIDWithEvent(b,a){eventsManager.events[b]=null;delete eventsManager.events[b];eventsManager.events[a.event_id]=a;if(EventsMan_hasUncommitted(b)){delete eventsManager.uncommitted[b]}EventsMan_callEventIDsChangeListener(b,a.event_id);_EventsMan_callUpdateListeners()}function EventsMan_pushToServer(a){}function EventsMan_pullFromServer(a){}function _EventsMan_callUpdateListeners(){$.each(EventsMan_updateListeners,function(a){this()})}function EventsMan_addUpdateListener(a){EventsMan_updateListeners.push(a)}function EventsMan_addOnReadyListener(a){if(EVENTS_READY){a();return}EventsMan_onReadyListeners.push(a)}function EventsMan_callOnReadyListeners(){$.each(EventsMan_onReadyListeners,function(a){this()});EventsMan_onReadyListeners=null}function EventsMan_addEventIDsChangeListener(a){EventsMan_eventIDsChangeListener.push(a)}function EventsMan_callEventIDsChangeListener(b,a){$.each(EventsMan_eventIDsChangeListener,function(c){this(b,a)})}function EventsMan_cloneEventDict(b){var a=JSON.parse(JSON.stringify(b));return a}function EventsMan_save(){if("localStorage" in window&&window.localStorage!==null){localStorage.setItem("eventsman.events",JSON.stringify(eventsManager.events));localStorage.setItem("eventsman.lastsyncedtime",eventsManager.lastSyncedTime);localStorage.setItem("eventsman.hidden",JSON.stringify(eventsManager.hiddenIDs.toArray()))}}function EventsMan_load(){if(!("localStorage" in window&&window.localStorage!==null)){return false}var a=localStorage.getItem("user");if(a!=USER_NETID){return false}var b=localStorage.getItem("eventsman.events");if(!b){return false}eventsManager.events=JSON.parse(b);var c=localStorage.getItem("eventsman.hidden");if(c){eventsManager.hiddenIDs=Set.prototype.fromArray(JSON.parse(c))}var d=localStorage.getItem("eventsman.lastsyncedtime");if(d){eventsManager.lastSyncedTime=d}EventsMan_constructOrderArray();return true}var MAIN_TIMEZONE="America/New_York";var DAYS_DICT=["M","Tu","W","Th","F","Sa","S"];var TYPE_MAP_INVERSE={assignment:"AS",exam:"EX",lab:"LA",lecture:"LE","office hours":"OH",precept:"PR","review session":"RS"};var TYPE_MAP={AS:"assignment",EX:"exam",LA:"lab",LE:"lecture",OH:"office hours",PR:"precept",RS:"review session"};String.prototype.escapeHTML=function(){var a={"&":"&amp;","<":"&lt;",">":"&gt;"};return this.replace(/[&<>]/g,function(b){return a[b]||b})};Array.prototype.contains=function(b){for(var c=0;c<this.length;c++){if(this[c]==b){return true}}return false};Array.prototype.find=function(b){for(var c=0;c<this.length;c++){if(this[c]==b){return c}}return -1};Array.prototype.equals=function(b){var c;for(c=0;c<this.length;c++){if(c>=b.length){return false}else{if(this[c]!=b[c]){return false}}}return c==b.length};var LO_TYPES={SUCCESS:"alert-success"};var LO_idMap=null;function LO_init(){LO_idMap={loading:new Set(),error:new Set()}}function LO_showLoading(b){if(typeof b=="undefined"){return}if(b in LO_idMap.loading){return}LO_idMap.loading.add(b);if($("#loading.active").length>0){return}var a=LO_getLoadingHTML();a.attr("id","loading");LO_insert(a)}function LO_hideLoading(b,a){if(typeof a=="undefined"){a=true}if(typeof b=="undefined"){return}LO_idMap.loading.remove(b);if(LO_idMap.loading.isEmpty()){LO_remove($("#loading.active"))}if(!a){return}if(b in LO_idMap.error){LO_idMap.error.remove(b);if(LO_idMap.error.isEmpty()){LO_remove($("#error.active"));LO_showTemporaryMessage("Connected",LO_TYPES.SUCCESS)}}}function LO_showError(b){if(typeof b=="undefined"){return}if(b in LO_idMap.error){return}LO_idMap.error.add(b);if($("#error.active").length>0){return}var a=LO_getLoadingHTML();a.attr("id","error");a.removeClass("alert-info").addClass("alert-danger");a.find("#loading-content").html("Error connecting.<br>Will keep trying");LO_insert(a)}function LO_showTemporaryMessage(b,a){var c=LO_getLoadingHTML();c.removeClass("alert-info").addClass(a);c.find("#loading-content").text(b);LO_insert(c);setTimeout(function(){LO_remove(c)},1.5*1000)}function LO_remove(a){a.on("transitionend",function(b){$(this).remove()});a.removeClass("active");a.removeClass("in")}function LO_insert(a){$("#indicators-container").append(a);a.addClass("active");a.addClass("in")}function LO_getLoadingHTML(){var a=$("<div>").addClass("indicator alert alert-dismissable alert-info");a.append($('<span id="loading-content">'));a.find("#loading-content").append('Loading...&nbsp;&nbsp;&nbsp;<i class="fa fa-spinner fa-spin"></i>');return a}var pinnedIDs=null;var mainID=null;var csrftoken=$.cookie("csrftoken");var COURSE_COLOR_MAP;var SECTION_COLOR_MAP;function UI_pin(a){if(UI_isMain(a)){UI_unsetMain()}pinnedIDs.add(a)}function UI_isPinned(a){return a in pinnedIDs}function UI_unpin(a){pinnedIDs.remove(a)}function UI_isMain(a){return mainID==a}function UI_setMain(a){if(UI_isPinned(a)){UI_unpin(a)}mainID=a}function UI_unsetMain(){mainID=null}function csrfSafeMethod(a){return(/^(GET|HEAD|OPTIONS|TRACE)$/.test(a))}function sameOrigin(b){var d=document.location.host;var e=document.location.protocol;var c="//"+d;var a=e+c;return(b==a||b.slice(0,a.length+1)==a+"/")||(b==c||b.slice(0,c.length+1)==c+"/")||!(/^(\/\/|http:|https:).*/.test(b))}function toTitleCase(a){return a.replace(/\w\S*/g,function(b){return b.charAt(0).toUpperCase()+b.substr(1).toLowerCase()})}function br2nl(a){return a.replace(/(\n|\r)/g,"").replace(/<br>/g,"\n")}function nl2br(a){return a.replace(/(\n|\r)/g,"<br>")}function loadWhiteTheme(){$(".theme").removeClass("dark");$("#theme_css").attr("href","/static/cosmo/bootstrap.css")}function loadDarkTheme(){$(".theme").addClass("dark");$("#theme_css").attr("href","/static/cyborg/bootstrap.css")}var POPUP_HTML=null;var POPUP_CLASS="popup";var POPUP_URL="popup-template";var PopUp_closeListeners=[];var PopUp_editListeners=[];var PopUp_freedSpace=[];var PopUp_space=0;var POPUP_INIT=false;var POPUP_EDITDICT={"popup-loc":"event_location","popup-title":"event_title","popup-date":"event_date","popup-time-start":"event_start","popup-time-end":"event_end","popup-type":"event_type","popup-section":"section_id","popup-desc":"event_description","popup-repeat-end":"recurrence_end","popup-repeat-interval":"recurrence_interval"};var PopUp_Main_optFirstDrag=function(a){};var POPUP_MAIN_FIRSTDRAG=function(a){if(PopUp_isMain(a)){a.id="";PopUp_Main_optFirstDrag(a);UI_pin(PopUp_getID(a));UI_unsetMain();var b=a.getBoundingClientRect();$(a).css({height:b.height+"px",width:b.width+"px"});$(a).appendTo("body");$(a).css({top:b.top,left:b.left});PopUp_makeResizable(a);SB_hide()}};function PopUp_insertPopUp(b){var d;if(POPUP_HTML){d=POPUP_HTML}else{d=CacheMan_load(POPUP_URL)}if(b){SB_push(d)}else{$("body").append(d)}var c=$("#popup-main123");var a=function(){POPUP_MAIN_FIRSTDRAG(c);if(c.space){PopUp_freedSpace.push(c.space)}};c.draggable({handle:".panel > .panel-heading",containment:"#content_bounds",scroll:false,appendTo:"body",beforeStart:function(f,g){a()},zIndex:2000});c=c[0];c.id="popup-main";if(!b){var e;if(PopUp_freedSpace.length==0){e=++PopUp_space}else{e=PopUp_freedSpace.sort(function(g,f){return f-g}).pop()}c.id="";PopUp_makeResizable(c);leftPos=parseInt($(c).css("left"));topPos=parseInt($(c).css("top"));$(c).css("left",(leftPos+20*e)+"px").css("top",(topPos+20*e)+"px");c.space=e}c.onmousedown=function(){PopUp_giveFocus(this)};maxHeight=window.innerHeight-$(".navbar").height()-100;$(c).css("max-height",maxHeight+"px");_PopUp_setBodyHeight(c);PopUp_initialize(c);setTimeout(function(){PopUp_initialize_deferred(c)},300);$(c).find(".withtooltip").tooltip({});if(THEME=="w"){$(c).find(".theme").removeClass("dark")}else{$(c).find(".theme").addClass("dark")}return c}function PopUp_initialize(a){}function PopUp_initialize_deferred(a){}function PopUp_close(a){if(UI_isMain(PopUp_getID(a))){UI_unsetMain();SB_pop(a)}else{UI_unpin(PopUp_getID(a));$(a).remove()}SB_hideIfEmpty()}function PopUp_getMainPopUp(){var a=$("#popup-main");if(a.length>0){a=$("#popup-main")[0]}else{a=PopUp_insertPopUp(true)}return a}function PopUp_getPopUpByID(a){if($("."+POPUP_CLASS).find("#"+a).length>0){return $("."+POPUP_CLASS).find("#"+a).parent()[0]}else{return null}}function PopUp_getID(a){if(!a){return null}if(!("id" in $(a).find(".panel")[0])){return null}return $(a).find(".panel")[0].id}function PopUp_setID(a,c){var b=$(a).find(".panel")[0].id;$(a).find(".panel")[0].id=c;if(a.id=="popup-main"){UI_setMain(c)}else{UI_unpin(b);UI_pin(c)}}function _PopUp_setBodyHeight(b){var c=$(b).find(".panel-heading").css("height");var a=$(b).css("height");$(b).find(".panel-body").css("height",(parseInt(a)-parseInt(c))+"px")}function PopUp_giveFocus(b){if(!b){return}PopUp_loseFocus($("."+POPUP_CLASS).not(b));$(b).css("z-index","200");var a=$(b).find(".panel").data("my-color");$(b).find(".panel").addClass("panel-primary").removeClass("panel-default").css("border-color",a);$(b).find(".popup-title").parent().parent().css("background-color",a).css("border-color",a);if(UI_isMain(PopUp_getID(b))){SB_show()}}function PopUp_loseFocus(a){a.each(function(c){var b=$(this).find(".panel").data("default-border");var d=$(this).find(".panel").data("default-header");$(this).css("z-index","100").find(".panel").addClass("panel-default").removeClass("panel-primary").css("border-color",b);$(this).find(".popup-title").parent().parent().css("background-color",d).css("border-color",b)})}function PopUp_giveFocusToID(a){popUp=$("."+POPUP_CLASS).find("#"+a).parent();PopUp_giveFocus(popUp)}function PopUp_hasFocus(a){return $(a).find(".panel").hasClass("panel-primary")}function PopUp_updateSize(a){$(a).find(".panel").css({width:$(a).css("width"),height:$(a).css("height")});_PopUp_setBodyHeight(a)}function PopUp_isMain(a){return a.id=="popup-main"}function PopUp_makeMain(a){a.id="popup-main";var c=PopUp_getID(a);if(UI_isPinned(c)){UI_unpin(c)}UI_setMain(c);try{$(a).find(".panel").resizable("destroy")}catch(b){}}function PopUp_hasMain(a){return $("#popup-main").length>0}function PopUp_makeResizable(a){$(a).find(".panel").resizable({stop:function(c,b){$(this).parent().css("height",$(this).css("height"));$(this).parent().css("width",$(this).css("width"));_PopUp_setBodyHeight(this)}})}function PopUp_addCloseListener(a){PopUp_closeListeners.push(a)}function PopUp_addEditListener(a){PopUp_editListeners.push(a)}function PopUp_callCloseListeners(a){$(PopUp_closeListeners).each(function(b){this(a)})}function PopUp_callEditListeners(c,b,a){$(PopUp_editListeners).each(function(d){this(c,b,a)})}function _PopUp_getPopUp(b){var a=b;while(!$(a).hasClass("popup")){a=$(a).parent()[0]}return a}function PopUp_map(a){$("."+POPUP_CLASS).not("#popup-main").each(function(b){a(this,false)});$("#popup-main").each(function(b){a(this,true)})}function PopUp_setColor(c,b){$(c).find(".panel").data("my-color",b);var a="#DDDDDD";var d="#F5F5F5";$(c).find(".panel").data("default-border",a);$(c).find(".panel").data("default-header",d);if(PopUp_hasFocus(c)){$(c).find(".popup-title").parent().parent().css("background-color",b).css("border-color",b);$(c).find(".panel").css("border-color",b)}else{$(c).find(".popup-title").parent().parent().css("background-color",d).css("border-color",a);$(c).find(".panel").css("border-color",a)}}function SC_initWithChoices(b,c){$container=$("<div>").addClass("segmented-control").append($("<h5>"));$container.find("h5").text(b);var a=$("<div>").addClass("btn-group");$.each(c,function(d){var e=$("<button>").addClass("btn").addClass("btn-sm").text(this.pretty).data("value",this.value).on("click",function(f){f.preventDefault();SC_select(this)});a.append(e);if(this.selected||d==0){SC_select(e)}});$container.append(a);return $container[0]}function SC_setToChoices(a,b){$(a).find("button").each(function(d){for(var e=0;e<b.length;e++){var c=b[e];if(c.value==$(this).data("value")){if(c.selected){SC_select(this,true)}break}}})}function SC_removeAllFromContainer(a){$(a).find(".segmented-control").remove()}function SC_select(b,a){a=a||false;SC_unhighlight($(b).parent().find(".btn-primary"));SC_highlight(b);if(a){return}var c={};$(b).parent().find(".btn").each(function(d){c[$(this).data("value")]=$(this).hasClass("btn-primary")});$(b).trigger("select",c)}function SC_highlight(a){$(a).addClass("btn-primary")}function SC_unhighlight(a){$(a).removeClass("btn-primary")}function SC_isHighlighted(a){return $(a).hasClass("btn-primary")}function SCM_initWithChoices(a,c){var b=SC_initWithChoices(a,c);$(b).find("button").each(function(d){$(this).off("click");$(this).on("click",function(e){e.preventDefault();if(SC_isHighlighted(this)){SCM_deselect(this)}else{SCM_select(this)}});SCM_setToChoices(b,c)});return b}function SCM_select(a){SC_highlight(a);var b={};$(a).parent().find(".btn").each(function(c){b[$(this).data("value")]=$(this).hasClass("btn-primary")});$(a).trigger("select",b)}function SCM_deselect(a){SC_unhighlight(a);var b={};$(a).parent().find(".btn").each(function(c){b[$(this).data("value")]=$(this).hasClass("btn-primary")});$(a).trigger("select",b)}function SCM_setToChoices(a,b){$(a).find("button").each(function(d){SCM_deselect(this);for(var e=0;e<b.length;e++){var c=b[e];if(c.value==$(this).data("value")){if(c.selected){SCM_select(this)}break}}})}function SCP_initOnElement(b,a,c,f){if($(b).data("scp")){var e=$(b).data("scp");SC_setToChoices(e,f);return e}var d=SC_initWithChoices(null,f);$(d).find(".btn-group").addClass("btn-group-vertical").removeClass("btn-group");$(b).popover({title:c,placement:"left",html:true,content:d,trigger:"focus",container:$(a)});$(b).data("scp",d);return d}var Set=function(){};Set.prototype.size=0;Set.prototype.add=function(a){this[a]=true;this.size++};Set.prototype.remove=function(a){if(a in this){delete this[a];this.size--}};Set.prototype.fromArray=function(c){var a=new Set();for(var b=0;b<c.length;b++){a.add(c[b])}return a};Set.prototype.toArray=function(){var a=[];for(var b in this){if(typeof this[b]!="function"&&b!="size"){a.push(b)}}a.sort();return a};Set.prototype.contains=function(b){for(var c in b){if(!(c in this)){return false}}return true};Set.prototype.equals=function(b){return this.contains(b)&&b.contains(this)};Set.prototype.isEmpty=function(b){return this.size<=0};var SB_willCloseListeners=[];function SB_init(){$("#sidebar").droppable({drop:function(c,d){if(PopUp_hasMain()){var a=PopUp_getMainPopUp();PopUp_callCloseListeners(PopUp_getID(a));$(a).remove()}var b=d.draggable[0];$(b).detach().appendTo("#sb-left-container").css({width:"100%",height:"350px",left:"auto",top:"auto"});$(b).addClass("sb-left-content");$(b).addClass("in");PopUp_updateSize(b);PopUp_makeMain(b)},hoverClass:"hover-active"});$("#sidebar-target").droppable({over:function(a,b){SB_show()},out:function(a,b){if(SB_isEmpty()){SB_hide()}}})}function SB_isEmpty(){return $("#sidebar").find(".in").length==0}function SB_show(){$("#sidebar").addClass("in");$("#sb-handle").find(".glyphicon").addClass("glyphicon-chevron-right").removeClass("glyphicon-chevron-left")}function SB_hide(){SB_callWillCloseListeners();SB_unfill();$("#sidebar").removeClass("in");$("#sb-handle").find(".glyphicon").removeClass("glyphicon-chevron-right").addClass("glyphicon-chevron-left")}function SB_hideIfEmpty(){if(SB_isEmpty()){SB_hide()}}function SB_isShown(){return $("#sidebar").hasClass("in")}function SB_push(a){a=$(a).addClass("sb-left-content")[0];$("#sb-left-container").append(a);if(!SB_isShown()){SB_show()}setTimeout("$('#sb-left-container').find('.sb-left-content').addClass('in')",10)}function SB_pop(a){$(a).removeClass("in").on("transitionend",function(){$(a).remove()})}function SB_setMainContent(a){$(".sb-full-content").remove();a=$(a).addClass("sb-full-content")[0];$("#sb-full-container").append(a);setTimeout("$('#sb-full-container').find('.sb-full-content').addClass('in')",10)}function SB_fill(){$("#sidebar").addClass("full");disableAllInteractions()}function SB_unfill(){$("#sidebar").removeClass("full");SB_pop($(".sb-full-content"));enableAllInteractions()}function SB_isFilled(){return $("#sidebar").hasClass("full")}function SB_toggle(){if(SB_isShown()){SB_hide()}else{SB_show()}}function SB_addWillCloseListener(a){SB_willCloseListeners.push(a)}function SB_callWillCloseListeners(){$.each(SB_willCloseListeners,function(a){this()})}AGENDA_INIT=false;var AGENDA_HTML=null;function Agenda_init(){if(AGENDA_INIT){return}AGENDA_INIT=true;AGENDA_HTML=$("#agenda-template").html();$("#agenda-template").remove();EventsMan_addUpdateListener(function(){if(!Agenda_active()){return}Agenda_reload()});$("#"+SE_id).on("close",function(a){if(!Agenda_active()){return}Agenda_reload()});$("#agenda.tab-pane").each(function(a){$(this).on("transitionend",function(b){if($(this).hasClass("in")){Agenda_reload()}})});PopUp_addCloseListener(function(a){Agenda_unhighlight($(".tab-content").find(".agenda-item.panel#"+a))});Agenda_reload()}function Agenda_active(){return $("#agenda").hasClass("active")}function Agenda_reload(){LO_showLoading("agenda loading");var c=$("#agenda");var d=false;c[0].innerHTML=null;var b=moment();var a=moment().date(b.date()-1).hour(0).minute(0).second(0);var f=moment().date(b.date()).hour(0).minute(0).second(0);var e=EventsMan_getEventIDForRange(a.unix(),f.unix());e=Agenda_filterEvents(e);if(e.length>0){d|=true;Agenda_insertHeader("Yesterday");Agenda_loadEvents(e)}a=f;f=moment().date(b.date()+1).hour(0).minute(0).second(0);e=EventsMan_getEventIDForRange(a.unix(),f.unix());e=Agenda_filterEvents(e);if(e.length>0){d|=true;Agenda_insertHeader("Today");Agenda_loadEvents(e)}a=f;f=moment().date(b.date()+7).hour(0).minute(0).second(0);e=EventsMan_getEventIDForRange(a.unix(),f.unix());e=Agenda_filterEvents(e);if(e.length>0){d|=true;Agenda_insertHeader("This Week");Agenda_loadEvents(e)}a=f;f=moment().month(b.month()+1);f=f.date(0);e=EventsMan_getEventIDForRange(a.unix(),f.unix());e=Agenda_filterEvents(e);if(e.length>0){d|=true;Agenda_insertHeader("This month");Agenda_loadEvents(e)}if(!d){Agenda_insertHeader("Congrats! You have nothing on your agenda!")}LO_hideLoading("agenda loading")}function Agenda_filterEvents(b){var a=[];$.each(b,function(c){var d=EventsMan_getEventByID(this);if(!d){return}if(AGENDA_FILTER.contains(d.event_type)){if(!(d.course_id in COURSE_FILTER_BLACKLIST)){a.push(this)}}});return a}function Agenda_loadEvents(b){var a=$("#agenda");$.each(b,function(e){var f=EventsMan_getEventByID(this);if(!f){return}a.append($(AGENDA_HTML));var d=a.find("#agenda123")[0];d.id=this;$(d).find(".panel-body").find("h4").text(f.event_title);$(d).find("#agenda-section").text(SECTION_MAP[f.section_id]);var g=moment.unix(f.event_start);var c=g.tz(MAIN_TIMEZONE).calendar();$(d).find("#agenda-time").text(c);_Agenda_setColors(d,f,EventsMan_eventIsHidden(this));if(UI_isPinned(d.id)){Agenda_highlight(d)}if(UI_isMain(d.id)){Agenda_highlight(d)}});if(window.innerWidth<=400){$(".agenda-container").children(".col-xs-4").removeClass("col-xs-4 col-xs-offset-1").addClass("col-xs-12")}if(THEME=="w"){$(".theme").removeClass("dark")}else{$(".theme").addClass("dark")}}function _Agenda_setColors(b,e,c){var f="course-color-"+e.course_id;var a=SECTION_COLOR_MAP[e.section_id]["color"];$(b).find("#agenda-section").addClass(f).css("color",a);$(b).find("#agenda-title").addClass(f).css("color",a);$(b).parent().find(".agenda-tag").addClass(f).css("background-color",a);$(b).data("new-color",a);var d=$(b).css("border-color");$(b).data("default-color",d);if(c){$(b).css("border-style","dashed")}}function Agenda_insertHeader(c){var a=$("#agenda");var b=$('<div class="agenda-header row">');$('<div class="col-xs-5 col-xs-offset-1">').append('<h3 id="agenda-header-text"></h3>').appendTo(b);a.append(b);b.find("#agenda-header-text").text(c)}function selectAgenda(c){var a=$(c).find(".panel")[0];if(Agenda_isHighlighted(a)){var d=a.id;PopUp_giveFocusToID(d);return}if(SHIFT_PRESSED){Agenda_highlight(a);b=PopUp_insertPopUp(false);PopUp_setToEventID(b,a.id);PopUp_giveFocus(b);return}Agenda_unhighlight($(".agenda-item.panel-primary").filter(function(){return !UI_isPinned(this.id)}));Agenda_highlight(a);var b=PopUp_getMainPopUp();PopUp_setToEventID(b,a.id);PopUp_giveFocus(b)}function Agenda_highlight(b){if(Agenda_isHighlighted(b)){return}var a=$(b).data("new-color");$(b).addClass("panel-primary").removeClass("panel-default").css({"border-color":a})}function Agenda_unhighlight(a){var b=$(a).data("default-color");$(a).addClass("panel-default").removeClass("panel-primary").css({"border-color":b})}function Agenda_isHighlighted(a){return $(a).hasClass("panel-primary")}function Cal_init(){if(CAL_INIT){return}var a=window.innerHeight-$(".navbar").height()-50;EventsMan_addUpdateListener(function(){if(Cal_active()){Cal_reload()}});$("#"+SE_id).on("close",function(b){Cal_reload()});Cal_options.height=a;Cal_options.eventClick=function(e,c,b){if(e.highlighted==true){PopUp_giveFocusToID(e.id);return}if(SHIFT_PRESSED){Cal_highlightEvent(e,true);var d=PopUp_insertPopUp(false);PopUp_setToEventID(d,e.id);PopUp_giveFocus(d);return}$($("#calendarui").fullCalendar("clientEvents",function(f){return !UI_isPinned(f.id)})).each(function(f){Cal_unhighlightEvent(this,false)});Cal_highlightEvent(e,true);var d=PopUp_getMainPopUp();PopUp_setToEventID(d,e.id);PopUp_giveFocus(d)};Cal_options.windowResize=function(b){Cal_adjustHeight()};$("#calendarui").fullCalendar(Cal_options);CAL_INIT=true;$("#calendar.tab-pane").each(function(b){$(this).on("transitionend",function(c){if($(this).hasClass("in")){Cal_render();Cal_reload()}})});PopUp_addCloseListener(function(b){$($("#calendarui").fullCalendar("clientEvents",b)).each(function(c){Cal_unhighlightEvent(this,true)})});if(Cal_active()){Cal_reload()}}function Cal_adjustHeight(){var a=window.innerHeight-$(".navbar").height()-50;$("#calendarui").fullCalendar("option","height",a)}function Cal_active(){return $("#calendar").hasClass("active")}function Cal_reload(){if(CAL_LOADING){return}CAL_LOADING=true;var a=EventsMan_getAllEventIDs();Cal_eventSource.events=[];setTimeout(function(){LO_showLoading("cal loading");try{$.each(a,function(d){eventDict=EventsMan_getEventByID(this);if(!eventDict){return}if(!CAL_FILTER.contains(eventDict.event_type)){return}if(eventDict.course_id in COURSE_FILTER_BLACKLIST){return}var c=UI_isPinned(this)||UI_isMain(this);var f=EventsMan_eventIsHidden(this);color=SECTION_COLOR_MAP[eventDict.section_id]["color"];color=colorLuminance(color,FACTOR_LUM);var e;if(c){e=rgbToRgba(luminanceToRgb(color),1)}else{e=rgbToRgba(luminanceToRgb(color),FACTOR_TRANS)}Cal_eventSource.events.push({id:eventDict.event_id,title:eventDict.event_title,start:moment.unix(eventDict.event_start).tz(MAIN_TIMEZONE).toISOString(),end:moment.unix(eventDict.event_end).tz(MAIN_TIMEZONE).toISOString(),highlighted:c,myColor:SECTION_COLOR_MAP[eventDict.section_id]["color"],textColor:c?"#ffffff":SECTION_COLOR_MAP[eventDict.section_id]["color"],backgroundColor:e,borderColor:"#ffffff"})});$("#calendarui").fullCalendar("refetchEvents");CAL_LOADING=false}catch(b){CAL_LOADING=false}LO_hideLoading("cal loading")},10)}function Cal_render(){$("#calendarui").fullCalendar("render")}var timeoutIDs=[];var EVENTSMAN_COUNT=0;function EventsMan_init(){if(EVENTS_INIT){return}EVENTS_INIT=true;eventsManager=new _EventsMan_new();if(EventsMan_load()){EVENTS_READY=true;EventsMan_callOnReadyListeners();_EventsMan_callUpdateListeners();EventsMan_verifyLocalData()}else{EventsMan_pullFromServer(function(){EVENTS_READY=true;EventsMan_callOnReadyListeners()},true)}PopUp_addEditListener(function(b,h,k){if(h=="event_type"){k=TYPE_MAP_INVERSE[k.toLowerCase()];if(b in eventsManager.events&&eventsManager.events[b][h]==k){return}if(!(b in eventsManager.uncommitted)){eventsManager.uncommitted[b]=EventsMan_cloneEventDict(eventsManager.events[b])}eventsManager.uncommitted[b][h]=k}else{if(h=="section_id"){k=SECTION_MAP_INVERSE[k.toLowerCase()];if(b in eventsManager.events&&eventsManager.events[b][h]==k){return}if(!(b in eventsManager.uncommitted)){eventsManager.uncommitted[b]=EventsMan_cloneEventDict(eventsManager.events[b])}eventsManager.uncommitted[b][h]=k}else{if(h=="event_date"){if(!(b in eventsManager.uncommitted)){eventsManager.uncommitted[b]=EventsMan_cloneEventDict(eventsManager.events[b])}var f=eventsManager.uncommitted[b];var c=moment.unix(f.event_start);var e=moment.unix(f.event_end);var l=moment(k);if(b in eventsManager.events&&l.date()==c.date()&&l.month()==c.month()&&l.year()==c.year()){return}c.year(l.year());c.month(l.month());c.date(l.date());e.year(l.year());e.month(l.month());e.date(l.date());f.event_start=c.unix();f.event_end=e.unix()}else{if(h=="event_start"||h=="event_end"){if(!(b in eventsManager.uncommitted)){eventsManager.uncommitted[b]=EventsMan_cloneEventDict(eventsManager.events[b])}k="April 25, 2014 "+k;var f=eventsManager.uncommitted[b];var d=moment.unix(f[h]);var j=moment(k);if(b in eventsManager.events&&d.minute()==j.minute()&&d.hour()==j.hour()){return}d.hour(j.hour());d.minute(j.minute());f[h]=d.unix()}else{if(h=="event_recurrence"){if(k){if(b in eventsManager.events&&"recurrence_days" in eventsManager.events[b]&&eventsManager.events[b].recurrence_days.equals(k)){return}if(!(b in eventsManager.uncommitted)){eventsManager.uncommitted[b]=EventsMan_cloneEventDict(eventsManager.events[b])}var f=eventsManager.uncommitted[b];var a=moment.unix(f.event_start);var g=(a.tz(MAIN_TIMEZONE).day()-1)%7;if(!k.contains(g)){k.push(g)}k.sort();f.recurrence_days=k;if(!("recurrence_interval" in f)){f.recurrence_interval=1}if(!("recurrence_end" in f)){f.recurrence_end=parseInt(CUR_SEM.end_date)}}else{if(b in eventsManager.events&&!("recurrence_days" in eventsManager.events[b])){return}if(!(b in eventsManager.uncommitted)){eventsManager.uncommitted[b]=EventsMan_cloneEventDict(eventsManager.events[b])}var f=eventsManager.uncommitted[b];delete f.recurrence_days;delete f.recurrence_end;delete f.recurrence_interval}}else{if(false&&h=="event_recurrence_interval"){if(b in eventsManager.events&&eventsManager.events[b]["reccurrence_interval"]==k){return}if(!(b in eventsManager.uncommitted)){eventsManager.uncommitted[b]=EventsMan_cloneEventDict(eventsManager.events[b])}var f=eventsManager.uncommitted[b];f.reccurence_interval=k}else{if(b in eventsManager.events&&eventsManager.events[b][h]==k){return}if(!(b in eventsManager.uncommitted)){eventsManager.uncommitted[b]=EventsMan_cloneEventDict(eventsManager.events[b])}eventsManager.uncommitted[b][h]=k}}}}}}eventsManager.uncommitted[b].modified_time=moment().unix();if(!(b in eventsManager.events)){SE_checkSimilarEvents(eventsManager.uncommitted[b])}_EventsMan_callUpdateListeners()});$(window).on("beforeunload",function(a){if(Object.getOwnPropertyNames(eventsManager.uncommitted).length>0){a.preventDefault();return"Your changes have not been saved. Are you sure you want to leave?"}EventsMan_pushToServer(false);EventsMan_save()});window.setInterval(function(){EVENTSMAN_COUNT++;if(!eventsManager.active&&(EVENTSMAN_COUNT%30)!=0){return}if((EVENTSMAN_COUNT%30)==0){EventsMan_verifyLocalData()}EventsMan_pushToServer(true);EventsMan_pullFromServer();EVENTSMAN_COUNT%=30},10*1000);$(window).on("mousemove click",function(){$.each(timeoutIDs,function(a){window.clearTimeout(this)});timeoutIDs=[];eventsManager.active=true;timeoutIDs.push(window.setTimeout(function(){eventsManager.active=false},30*1000))})}function EventsMan_pushToServer(b){if(!eventsManager.isIdle){return}eventsManager.isIdle=false;var a=[];$.each(eventsManager.updatedIDs.toArray(),function(c){a.push(eventsManager.events[this])});if(a.length>0||eventsManager.changed){$.ajax("/put",{dataType:"json",type:"POST",data:{events:JSON.stringify(a),hidden:JSON.stringify(eventsManager.hiddenIDs.toArray())},success:function(d){var e=d.changed_ids;$.each(e,function(h,g){var f=g[0];var k=g[1];if(h in eventsManager.events){var j=eventsManager.events[h];delete eventsManager.events[h];j.event_id=f;j.event_group_id=k;eventsManager.events[f]=j}if(h in eventsManager.uncommitted){var j=eventsManager.uncommitted[h];delete eventsManager.uncommitted[h];j.event_id=f;j.event_group_id=k;eventsManager.uncommitted[f]=j}EventsMan_callEventIDsChangeListener(h,f)});EventsMan_constructOrderArray();var c=d.deleted_ids;$.each(c,function(f){if(this in eventsManager.events){delete eventsManager.events[this]}if(this in eventsManager.uncommitted){delete eventsManager.uncommitted[this]}});eventsManager.isIdle=true;eventsManager.updatedIDs=new Set();eventsManager.changed=false;EventsMan_pullFromServer(null,true)},async:b,error:function(c){eventsManager.isIdle=true}})}else{eventsManager.isIdle=true}}function EventsMan_pullFromServer(a,b){if(!eventsManager.isIdle){return}if(eventsManager.updatedIDs.size>0||eventsManager.changed){return}b=typeof b!="undefined"?b:false;eventsManager.isIdle=false;var c="/get/"+eventsManager.lastSyncedTime;$.ajax(c,{dataType:"json",loadingIndicator:b,success:function(d){var e=EventsMan_processDownloadedEvents(d);eventsManager.isIdle=true;if(a!=null){a()}if(e){_EventsMan_callUpdateListeners()}},error:function(d){eventsManager.isIdle=true;LO_showError(c)}})}function EventsMan_processDownloadedEvents(e){var f=false;var c=e.events;for(var d=0;d<c.length;d++){var a=c[d];if(a.event_id in eventsManager.uncommitted){}if(a.event_id in eventsManager.updatedIDs){}else{eventsManager.events[a.event_id]=a}f=true}var b=Set.prototype.fromArray(e.hidden_events);if(!b.equals(eventsManager.hiddenIDs)&&!eventsManager.changed){eventsManager.hiddenIDs=b;f=true}EventsMan_constructOrderArray();eventsManager.addedCount=0;eventsManager.lastSyncedTime=moment().unix();return f}function EventsMan_verifyLocalData(){eventsManager.lastSyncedTime=0;EventsMan_pullFromServer()}function EventsMan_clickAddEvent(){var a=PopUp_getMainPopUp();if(PopUp_getID(a)){PopUp_callCloseListeners(PopUp_getID(a))}var b=EventsMan_addEvent();PopUp_setToEventID(a,b);PopUp_markAsUnsaved(a);PopUp_giveFocus(a)}function EventsMan_clickSync(){EventsMan_pushToServer();SR_save()}var KEY_UP=38;var KEY_DOWN=40;var KEY_LEFT=37;var KEY_RIGHT=39;var KEY_SQ_BRACE_R=221;var KEY_SQ_BRACE_L=219;var KEY_SHIFT=16;var SHIFT_PRESSED=false;$(document).keydown(function(b){var a=b.keyCode||b.which;switch(a){case KEY_UP:break;case KEY_DOWN:break;case KEY_LEFT:break;case KEY_RIGHT:break;case KEY_SQ_BRACE_R:$("#calendartab").tab("show");break;case KEY_SQ_BRACE_L:$("#agendatab").tab("show");break;case KEY_SHIFT:SHIFT_PRESSED=true;break}});$(document).keyup(function(){SHIFT_PRESSED=false});$(init);var NAV_ID=["agendatab","calendartab"];var TAB_ID=["agenda","calendar"];var SECTION_MAP;var SECTION_MAP_INVERSE;var COURSE_MAP;var COURSE_SECTIONS_MAP;var COURSE_FILTER_BLACKLIST;function init(){pinnedIDs=new Set();moment.tz.add({zones:{"America/New_York":["-4:56:2 - LMT 1883_10_18_12_3_58 -4:56:2","-5 US E%sT 1920 -5","-5 NYC E%sT 1942 -5","-5 US E%sT 1946 -5","-5 NYC E%sT 1967 -5","-5 US E%sT"]},rules:{US:["1918 1919 2 0 8 2 0 1 D","1918 1919 9 0 8 2 0 0 S","1942 1942 1 9 7 2 0 1 W","1945 1945 7 14 7 23 1 1 P","1945 1945 8 30 7 2 0 0 S","1967 2006 9 0 8 2 0 0 S","1967 1973 3 0 8 2 0 1 D","1974 1974 0 6 7 2 0 1 D","1975 1975 1 23 7 2 0 1 D","1976 1986 3 0 8 2 0 1 D","1987 2006 3 1 0 2 0 1 D","2007 9999 2 8 0 2 0 1 D","2007 9999 10 1 0 2 0 0 S"],NYC:["1920 1920 2 0 8 2 0 1 D","1920 1920 9 0 8 2 0 0 S","1921 1966 3 0 8 2 0 1 D","1921 1954 8 0 8 2 0 0 S","1955 1966 9 0 8 2 0 0 S"]},links:{}});LO_init();$.ajaxSetup({beforeSend:function(e,d){if(!csrfSafeMethod(d.type)&&sameOrigin(d.url)){e.setRequestHeader("X-CSRFToken",csrftoken)}if(d.loadingIndicator==false){return}var c=d.loadingID;if(typeof c=="undefined"){c=d.url}LO_showLoading(c)}});$(document).ajaxSuccess(function(e,f,d){var c=d.loadingID;if(typeof c=="undefined"){c=d.url}LO_hideLoading(c)});$(document).ajaxError(function(e,f,d){var c=d.loadingID;if(typeof c=="undefined"){c=d.url}LO_hideLoading(c,false);if(d.loadingIndicator==false){return}LO_showError(c)});CacheMan_init();SECTION_MAP=JSON.parse(CacheMan_load("/all-sections"));SECTION_MAP_INVERSE={};$.each(SECTION_MAP,function(c,d){SECTION_MAP_INVERSE[d.toLowerCase()]=c});SECTION_COLOR_MAP=JSON.parse(CacheMan_load("/get/section-colors"));var b=JSON.parse(CacheMan_load("/all-courses"));COURSE_MAP=b.courses;COURSE_SECTIONS_MAP=b.course_sections_map;COURSE_FILTER_BLACKLIST=new Set();if("localStorage" in window&&window.localStorage!==null){var a=localStorage.getItem("sectionsmap");if(!a){clearLocalStorage()}else{if(a!=CacheMan_load("/get/sections")){clearLocalStorage()}}localStorage.setItem("sectionsmap",CacheMan_load("/get/sections"))}SB_init();SR_init();EventsMan_init();PopUp_init();NO_init();Agenda_init();Cal_init();SE_init();SR_addWillSaveListener(function(){Nav_save();UI_save()});SR_addDidLoadListener(function(){Nav_load();UI_load()});EventsMan_addEventIDsChangeListener(function(d,c){if(UI_isMain(d)){UI_setMain(c)}else{if(UI_isPinned(d)){UI_unpin(d);UI_pin(c)}}});if(THEME=="w"){loadWhiteTheme()}else{loadDarkTheme()}$(".withtooltip").tooltip({});$(window).on("resize",function(c){adaptSize()});adaptSize();if("localStorage" in window&&window.localStorage!==null){localStorage.setItem("user",USER_NETID)}UR_pullUnapprovedRevisions();setInterval(function(){UR_pullUnapprovedRevisions()},5*60*1000);setInterval(function(){updatePoints()},60*1000)}function adaptSize(){if(window.innerWidth<=768){$("#agendatab").tab("show");$("#sb-left-container").removeClass("col-xs-4 col-xs-12 col-xs-8");$("#sb-left-container").addClass("col-xs-8")}else{$("#sb-left-container").removeClass("col-xs-4 col-xs-12 col-xs-8");$("#sb-left-container").addClass("col-xs-4")}if(window.innerWidth<=400){$("#sb-left-container").removeClass("col-xs-4 col-xs-12 col-xs-8");$("#sb-left-container").addClass("col-xs-12");$(".agenda-container").children(".col-xs-4").removeClass("col-xs-4 col-xs-offset-1").addClass("col-xs-12")}else{$(".agenda-container").children(".col-xs-12").addClass("col-xs-4 col-xs-offset-1").removeClass("col-xs-12")}}function Nav_save(){var a=$("#maintab").find(".active").find("a")[0].id;SR_put("nav_page",NAV_ID.indexOf(a))}function Nav_load(){var a=SR_get("nav_page");if(a==null){return}$("#maintab #"+NAV_ID[a]).tab("show")}function UI_save(){SR_put("pinned_IDs",JSON.stringify(pinnedIDs));SR_put("main_ID",mainID)}function UI_load(){if(SR_get("pinned_IDs")!=null){var a=JSON.parse(SR_get("pinned_IDs"));$.each(a,function(b,c){if(PopUp_getPopUpByID(b)!=null){UI_pin(b)}})}if(SR_get("main_ID")!=null){if(SR_get("main_ID")!="null"){if(PopUp_getPopUpByID(SR_get("main_ID"))!=null){UI_setMain(SR_get("main_ID"))}}}}function disableAllInteractions(){var a=$('<div id="disabler"></div>');$(a).prependTo(".tab-content").css({height:"100%",width:"100%",opacity:0,position:"absolute",left:0,top:0,"z-index":900,cursor:"not-allowed"})}function enableAllInteractions(){$("#disabler").remove()}function toggleInfo(){$(".main-content").toggleClass("main-hidden");$("#about-content").toggleClass("about-hidden")}function onLogOut(){clearLocalStorage()}function clearLocalStorage(){if("localStorage" in window&&window.localStorage!==null){localStorage.removeItem("sectionsmap");localStorage.removeItem("eventsman.events");localStorage.removeItem("eventsman.hidden");localStorage.removeItem("eventsman.lastsyncedtime");localStorage.removeItem("user");localStorage.removeItem("state-restoration")}}function updatePoints(){$.ajax("/api/point_count",{loadingIndicator:false,dataType:"json",success:function(a){POINT_COUNT=a;$("#point_count").text(POINT_COUNT+" points")}})}var NO_TYPES={WARNING:"alert-warning",INFO:"alert-info"};function NO_init(){PopUp_addCloseListener(function(a){NO_removeNotificationID(a)})}function NO_showNotification(e,d,a,c){var b;if(NO_hasNotificationID(e)){b=$("#"+e+".alert")}else{b=$("<div>").addClass("alert").addClass("alert-dismissible");b.append('<button id="close_button" type="button" class="close" aria-hidden="true">&times;</button>');$('<span id="noti-content">').appendTo(b);b.attr("id",e);SB_push(b)}b.addClass(a);$text=$("<a>").addClass("alert-link").text(d).on("click",function(f){f.preventDefault();b.trigger("noti.click");SB_pop(b)});b.find("#close_button").on("click",function(f){f.preventDefault();NO_removeNotificationID(b.attr("id"))});b.find("#noti-content").append($text);if(c){$.each(c,function(f,g){b.data(f,g)})}return b}function NO_hasNotificationID(a){return $("#"+a+".alert").length>0}function NO_removeNotificationID(a){if(!NO_hasNotificationID(a)){return}SB_pop($("#"+a+".alert.in")[0]);SB_hideIfEmpty()}POPUP_CLASS="popup-event";function PopUp_init(){if(POPUP_INIT){return}POPUP_INIT=true;POPUP_HTML=$("#popup-template").html();$("#popup-template").remove();var a=$.ui.draggable.prototype._mouseStart;$.ui.draggable.prototype._mouseStart=function(c,d,b){this._trigger("beforeStart",c,this._uiHash());a.apply(this,[c,d,b])};topPos=parseInt($(".navbar").css("height"))+parseInt($(".navbar").css("margin-top"));height=window.innerHeight-topPos+300;$("#content_bounds").css("top",topPos+"px").css("height",height).css("left","-20%").css("width","140%");$(window).on("resize",function(b){topPos=parseInt($(".navbar").css("height"))+parseInt($(".navbar").css("margin-top"));height=window.innerHeight-topPos+300;$("#content_bounds").css("top",topPos+"px").css("height",height).css("left","-20%").css("width","140%")});EventsMan_addOnReadyListener(function(){PopUp_load()});SR_addWillSaveListener(function(){PopUp_save()});EventsMan_addEventIDsChangeListener(function(d,b){var c=PopUp_getPopUpByID(b);if(c){PopUp_close(c)}var c=PopUp_getPopUpByID(d);if(c){PopUp_setToEventID(c,b)}});EventsMan_addUpdateListener(function(){PopUp_map(function(c,b){if(EventsMan_hasEvent(PopUp_getID(c))&&EventsMan_eventShouldBeShown(PopUp_getID(c))){PopUp_setToEventID(c,PopUp_getID(c))}else{PopUp_close(c)}})})}function PopUp_initialize_deferred(a){if($(a).find(".withdatepicker")[0].type=="text"){$(a).find(".withdatepicker").datetimepicker({format:"MM d, yyyy",autoclose:true,minView:2,maxView:3})}else{$(a).find(".withdatepicker").removeClass("withdatepicker")}if($(a).find(".withtimepicker")[0].type=="text"){$(a).find(".withtimepicker").datetimepicker({format:"H:ii P",formatViewType:"time",autoclose:true,minView:0,maxView:1,startView:0,linkField:"withdatepicker",linkFormat:"yyyy-mm-dd",showMeridian:true,minuteStep:10,startDate:new Date(moment("Dec 31, 1899 12:00 AM").unix()*1000),endDate:new Date(moment("Jan 1, 1900 12:00 AM").unix()*1000)})}else{$(a).find(".withtimepicker").removeClass("withtimepicker")}}function PopUp_initialize(c){var d=[];$.each(DAYS_DICT,function(e){d.push({value:e,pretty:this,selected:false})});var a=SCM_initWithChoices("",d);$(c).find("#popup-repeat-pattern").append(a);var d=[{value:1,pretty:"Every week",selected:false},{value:2,pretty:"Every 2 weeks",selected:false},{value:4,pretty:"Every month",selected:false}];var b=SC_initWithChoices("",d);$(c).find("#popup-repeat-interval").append(b)}function PopUp_setToEventID(c,a){PopUp_setID(c,a);var l;$(c).find(".unsaved").removeClass("unsaved");if(EventsMan_hasUncommitted(a)){l=EventsMan_getUncommitted(a);PopUp_markAsUnsaved(c);var n=EventsMan_getEventByID(a);if(n){if(n.event_title!=l.event_title){$(c).find("#popup-title").addClass("unsaved")}if(n.event_location!=l.event_location){$(c).find("#popup-loc").addClass("unsaved")}if(n.event_description!=l.event_description){$(c).find("#popup-desc").addClass("unsaved")}if(n.event_type!=l.event_type){$(c).find("#popup-type").addClass("unsaved")}if(n.section_id!=l.section_id){$(c).find("#popup-section").addClass("unsaved")}var b=moment.unix(l.event_start);var e=moment.unix(n.event_start);if(b.year()!=e.year()||b.month()!=e.month()||b.date()!=e.date()){$(c).find("#popup-date").addClass("unsaved")}if(b.hour()!=e.hour()||b.minute()!=e.minute()){$(c).find("#popup-time-start").addClass("unsaved")}var f=moment.unix(l.event_end);var o=moment.unix(n.event_end);if(f.hour()!=o.hour()||f.minute()!=o.minute()){$(c).find("#popup-time-end").addClass("unsaved")}}}else{l=EventsMan_getEventByID(a);PopUp_markAsSaved(c)}if(!l){console.log("errorneous event id");PopUp_close(c);return}PopUp_setTitle(c,l.event_title);PopUp_setDescription(c,l.event_description);PopUp_setLocation(c,l.event_location);PopUp_setSection(c,l.section_id);PopUp_setType(c,l.event_type);PopUp_setDate(c,l.event_start);PopUp_setStartTime(c,l.event_start);PopUp_setEndTime(c,l.event_end);var d=SECTION_COLOR_MAP[l.section_id];if(!d){d="#555555"}else{d=d.color}PopUp_setColor(c,d);$(c).find("#popup-repeat")[0].checked=("recurrence_days" in l);$(c).find("#popup-repeat").off("change");$(c).find("#popup-repeat-pattern").off("select");$(c).find("#popup-repeat-interval").off("select");if("recurrence_days" in l){var j=l.recurrence_days;var p=[];$.each(DAYS_DICT,function(q){p.push({value:q,pretty:this,selected:j.contains(q)})});$(c).find(".popup-repeat-item").removeClass("hide");var m=$(c).find("#popup-repeat-pattern").children()[0];SCM_setToChoices(m,p);var h=$(c).find("#popup-repeat-interval").children()[0];var p=[{value:1,pretty:"Every week",selected:l.recurrence_interval==1},{value:2,pretty:"Every 2 weeks",selected:l.recurrence_interval==2},{value:4,pretty:"Every month",selected:l.recurrence_interval==4}];SC_setToChoices(h,p)}else{var p=[];$.each(DAYS_DICT,function(q){p.push({value:q,pretty:this,selected:false})});$(c).find(".popup-repeat-item").addClass("hide");var m=$(c).find("#popup-repeat-pattern").children()[0];SCM_setToChoices(m,p);var h=$(c).find("#popup-repeat-interval").children()[0];var p=[{value:1,pretty:"Every week",selected:true},{value:2,pretty:"Every 2 weeks",selected:false},{value:4,pretty:"Every month",selected:false}];SC_setToChoices(h,p)}$(c).find("#popup-repeat").on("change",function(q){if(this.checked){if(!("recurrence_days" in l)){PopUp_markAsUnsaved(c)}$(c).find(".popup-repeat-item").removeClass("hide");PopUp_callEditListeners(PopUp_getID(c),"event_recurrence",[])}else{if("recurrence_days" in l){PopUp_markAsUnsaved(c)}$(c).find(".popup-repeat-item").addClass("hide");PopUp_callEditListeners(PopUp_getID(c),"event_recurrence",null)}});$(c).find("#popup-repeat-pattern").on("select",function(q,s){var r=[];$.each(s,function(u,t){if(t){r.push(parseInt(u))}});r.sort();if(EventsMan_hasUncommitted(a)){l=EventsMan_getUncommitted(a)}else{l=EventsMan_getEventByID(a)}if(!("recurrence_days" in l)){PopUp_markAsUnsaved(c)}else{if(!r.equals(l.recurrence_days)){PopUp_markAsUnsaved(c)}}PopUp_callEditListeners(PopUp_getID(c),"event_recurrence",r)});$(c).find("#popup-repeat-interval").on("select",function(q,r){$.each(r,function(t,s){if(s){if(EventsMan_hasUncommitted(a)){l=EventsMan_getUncommitted(a)}else{l=EventsMan_getEventByID(a)}if(l.recurrence_interval!=t){PopUp_markAsUnsaved(c)}PopUp_callEditListeners(PopUp_getID(c),POPUP_EDITDICT["popup-repeat-interval"],t)}})});if(EventsMan_eventIsHidden(a)){$(c).find("#unhide_button").removeClass("hide");$(c).find("#hide_button").addClass("hide")}else{$(c).find("#unhide_button").addClass("hide");$(c).find("#hide_button").removeClass("hide")}var p=[];$.each(TYPE_MAP,function(q,r){p.push({value:q,pretty:r,selected:l.event_type==q})});var k=SCP_initOnElement($(c).find(".withtypepicker")[0],c,null,p);$(k).on("select",function(r,s){var q;$.each(s,function(t,u){if(u){q=t;return false}});$(c).find(".withtypepicker").val(toTitleCase(TYPE_MAP[q]));$(c).find(".withtypepicker").trigger("value_set")});var p=[];$.each(SECTION_MAP,function(q,r){p.push({value:q,pretty:r,selected:l.section_id==q})});var g=SCP_initOnElement($(c).find(".withsectionpicker")[0],c,null,p);$(g).on("select",function(r,s){var q;$.each(s,function(t,u){if(u){q=t;return false}});$(c).find(".withsectionpicker").val(SECTION_MAP[q]);$(c).find(".withsectionpicker").trigger("value_set")});$(c).find(".withcustompicker").on("hidden.bs.popover",function(q){$(this).trigger("value_set")})}function PopUp_setTitle(a,b){a.querySelector(".popup-title").innerHTML=b}function PopUp_setDescription(a,b){$(a).find("#popup-desc").html(nl2br(b))}function PopUp_setLocation(a,b){$(a).find("#popup-loc").text(b)}function PopUp_setSection(a,b){$(a).find("#popup-section").text(SECTION_MAP[b])}function PopUp_setType(a,c){var b=toTitleCase(TYPE_MAP[c]);$(a).find("#popup-type").text(b)}function PopUp_setDate(b,c){var a=moment.unix(c).tz(MAIN_TIMEZONE);$(b).find("#popup-date").text(a.format("MMMM D, YYYY"))}function PopUp_setStartTime(a,c){var b=moment.unix(c).tz(MAIN_TIMEZONE);$(a).find("#popup-time-start").text(b.format("h:mm A"))}function PopUp_setEndTime(a,c){var b=moment.unix(c).tz(MAIN_TIMEZONE);$(a).find("#popup-time-end").text(b.format("h:mm A"))}function PopUp_save(){var b=[];PopUp_map(function(e,c){var d={};var f=[];d.id=PopUp_getID(e);f.push($(e).css("left"));f.push($(e).css("top"));f.push($(e).css("width"));f.push($(e).css("height"));d.frame=f;d.isMain=c;d.hasFocus=PopUp_hasFocus(e);b.push(d)});var a=JSON.stringify(b);SR_put("popup",a)}function PopUp_load(){if(SR_get("popup")==null){return}var a=JSON.parse(SR_get("popup"));$(a).each(function(b){popUp=PopUp_insertPopUp(this.isMain);if(!this.isMain){$(popUp).css("left",this.frame[0]);$(popUp).css("top",this.frame[1]);$(popUp).css("width",this.frame[2]);$(popUp).css("height",this.frame[3]);_PopUp_setBodyHeight(popUp)}PopUp_setToEventID(popUp,this.id);if(this.hasFocus){PopUp_giveFocus(popUp)}})}function PopUp_markAsUnsaved(a){$(a).find("#save_button").removeClass("hide");$(a).find("#undo_button").removeClass("hide")}function PopUp_markAsSaved(a){$(a).find("#save_button").addClass("hide");$(a).find("#undo_button").addClass("hide")}function PopUp_markIDAsNotEditing(a){PopUp_markAsNotEditing(PopUp_getPopUpByID(a))}function PopUp_markAsNotEditing(a){$(a).data("is_editing",false)}function PopUp_markAsEditing(a){$(a).data("is_editing",true)}function PopUp_isEditing(a){return $(a).data("is_editing")}function PopUp_makeIDDraggable(b){var a=PopUp_getPopUpByID(b);$(a).draggable("enable")}function _PopUp_showFormForElement(c){var b=_PopUp_getPopUp(c);$(c).addClass("hide");var a=_PopUp_Form_getFormIDForElement(c);var d=$(b).find("#"+a).removeClass("hide")[0]}function _PopUp_hideFormForElement(c){var b=_PopUp_getPopUp(c);$(c).addClass("hide");var a=_PopUp_Form_getElementIDForForm(c);$(b).find("#"+a).removeClass("hide")}function _PopUp_Form_getValue(a){if($(a).find("input").length>0){return $(a).find("input").val()}else{if($(a).find("textarea").length>0){return $(a).find("textarea").val()}}}function _PopUp_Form_setValue(b,d){if($(b).find("input").length>0){if($(b).find("input")[0].type=="date"){var a=moment(d).format("YYYY-MM-DD");$(b).find("input").val(a)}else{if($(b).find("input")[0].type=="time"){var c=moment("April 25, 2014 "+d).format("HH:mm:ss");$(b).find("input").val(c)}else{$(b).find("input").val(d)}}}else{if($(b).find("textarea").length>0){var e=br2nl(d);$(b).find("textarea").val(e)}}}function _PopUp_Form_giveFocus(a){if($(a).find("input").length>0){$(a).find("input")[0].focus()}else{if($(a).find("textarea").length>0){$(a).find("textarea")[0].focus()}}}function _PopUp_Form_getElementIDForForm(a){return a.id.split("-").slice(0,-1).join("-")}function _PopUp_Form_getFormIDForElement(a){return a.id+"-form"}function _PopUp_Form_addOnBlurListener(a,b){if($(a).find(".withdatepicker").length>0){$(a).find(".withdatepicker").datetimepicker().on("hide",b)}else{if($(a).find(".withtimepicker").length>0){$(a).find(".withtimepicker").datetimepicker().on("hide",b)}else{if($(a).find(".withcustompicker").length>0){$(a).find(".withcustompicker").on("value_set",b)}else{if($(a).find("input").length>0){$(a).find("input").on("blur",b)}else{if($(a).find("textarea").length>0){$(a).find("textarea").on("blur",b)}}}}}}function PopUp_clickedElement(d){var c=_PopUp_getPopUp(d);if(PopUp_isEditing(c)){return}_PopUp_Form_enforceStartDate(c);PopUp_markAsEditing(c);var b=_PopUp_Form_getFormIDForElement(d);var e=$(c).find("#"+b)[0];if($(e).find("textarea").length>0){height=parseInt($(d).css("height"))+20;$(e).find("textarea").css("height",height+"px")}_PopUp_showFormForElement(d);_PopUp_Form_setValue(e,d.innerHTML);_PopUp_Form_giveFocus(e);if(!$(e).hasClass("input-group")&&e.notFirstSelected!=true){e.notFirstSelected=true;_PopUp_Form_addOnBlurListener(e,function(){PopUp_clickedSaveElement(e)})}var a=_PopUp_Form_getElementIDForForm(e);if(a=="popup-title"){$(c).find(".popup-ctrl").addClass("hidden")}$(e).find("input").off("keyup").on("keyup",function(f){var g=f.keyCode||f.which;if(g==13){PopUp_clickedSaveElement(e)}});$(e).find(".withtimepicker").off("keyup").off("keydown").on("keydown",function(f){f.preventDefault()});$(e).find(".withdatepicker").off("keyup").off("keydown").on("keydown",function(f){f.preventDefault()});$(e).find(".withcustompicker").off("keyup").off("keydown").on("keydown",function(f){f.preventDefault()})}function _PopUp_Form_enforceStartDate(b){var c=$(b).find("#popup-time-start").text();var a=moment("Dec 31, 1899 "+c);$(b).find("#popup-time-end-form").find(".withtimepicker").datetimepicker("setStartDate",new Date(a.unix()*1000));$(b).find("#popup-time-end-form").find("input").not(".withtimepicker").attr("min",a.format("HH:mm:ss"))}function PopUp_clickedSaveElement(c){if(!/\S/.test(_PopUp_Form_getValue(c))){_PopUp_Form_giveFocus(c);return}var b=_PopUp_getPopUp(c);PopUp_markAsNotEditing(b);_PopUp_hideFormForElement(c);var a=_PopUp_Form_getElementIDForForm(c);if(a=="popup-title"){$(b).find(".popup-ctrl").removeClass("hidden");if(UI_isMain(PopUp_getID(b))){$(b).find(".poup-ctrl-right").addClass("hidden")}}var e=$(b).find("#"+a)[0];var d=_PopUp_Form_getValue(c).escapeHTML();if($(c).find("input").length>0&&$(c).find("input")[0].type=="date"){d=moment(d).tz(MAIN_TIMEZONE).format("MMMM D, YYYY")}else{if($(c).find("input").length>0&&$(c).find("input")[0].type=="time"){d=moment("April 25, 2014 "+d).tz(MAIN_TIMEZONE).format("h:mm A")}}if($(e).html()==nl2br(d)){return}$(e).html(nl2br(d));if(a=="popup-time-start"){_PopUp_Form_enforceStartDate(b)}PopUp_markAsUnsaved(b);PopUp_callEditListeners(PopUp_getID(b),POPUP_EDITDICT[a],_PopUp_Form_getValue(c))}function PopUp_clickedClose(a){var b=a;while(!$(b).hasClass("popup")){b=$(b).parent()[0]}if(PopUp_isEditing(b)){return}if(EventsMan_hasUncommitted(PopUp_getID(b))){AS_showActionSheetFromElement($(b).find("#close_button")[0],b,"Save changes?",[{important:false,text:"Save"},{important:true,text:"Don't save"}],function(c){if(c==0){PopUp_clickedSavePopUp(b,true)}else{PopUp_clickedUndo(b);PopUp_clickedClose(b)}});return}if(PopUp_getID(b)){PopUp_callCloseListeners(PopUp_getID(b))}PopUp_close(b)}function PopUp_clickedDelete(a){var b=_PopUp_getPopUp(a);if(PopUp_isEditing(b)){return}var c=PopUp_getID(b);var d=EventsMan_getEventByID(c);if(d&&"recurrence_days" in d){AS_showActionSheetFromElement(a,b,"Done with this event? Click to hide from your agenda and calendar.",[{important:false,text:"Only this event"},{important:true,text:"All future events"}],function(e){if(e==0){EventsMan_deleteEvent(c);if(!EventsMan_eventShouldBeShown(c)){PopUp_close(b)}}else{EventsMan_deleteAllFutureEvents(c);if(!EventsMan_eventShouldBeShown(c)){PopUp_close(b)}}});return}EventsMan_deleteEvent(c);if(!EventsMan_eventShouldBeShown(c)){PopUp_close(b)}}function PopUp_clickedUnhide(a){var b=_PopUp_getPopUp(a);if(PopUp_isEditing(b)){return}var c=PopUp_getID(b);var d=EventsMan_getEventByID(c);if("recurrence_days" in d){AS_showActionSheetFromElement(a,b,null,[{important:false,text:"Only this event"},{important:true,text:"All future events"}],function(e){if(e==0){EventsMan_unhideEvent(c)}else{EventsMan_unhideAllFutureEvents(c)}});return}EventsMan_unhideEvent(c)}function PopUp_clickedSavePopUp(b,d){var a=_PopUp_getPopUp(b);if(PopUp_isEditing(a)){return}d=d||false;var f=PopUp_getID(a);if(SE_hasSimilarEvents(f)){AS_showActionSheetFromElement($(a).find("#save_button")[0],a,"There seems to be a similar event already on the calendar",[{important:false,text:"Show similar events"},{important:true,text:"Save anyways"}],function(g){if(g==0){NO_showSimilarEvents(PopUp_getID(a))}else{NO_removeSimilarEventsNotification(PopUp_getID(a));PopUp_clickedSavePopUp(a)}});return}var e=EventsMan_getEventByID(f);var c=EventsMan_getUncommitted(f);if(e&&"recurrence_days" in e&&"recurrence_days" in c){if(e.recurrence_days.equals(c.recurrence_days)&&e.recurrence_interval==c.recurrence_interval){AS_showActionSheetFromElement($(a).find("#save_button")[0],a,"This event is part of a recurring event.",[{important:false,text:"Only this event"},{important:true,text:"All future events"}],function(g){PopUp_markAsSaved(a);$(a).find(".unsaved").removeClass("unsaved");if(g==0){EventsMan_commitChanges(f)}else{EventsMan_commitChangesToAllFutureEvents(f)}if(d){PopUp_clickedClose(a)}});return}}PopUp_markAsSaved(a);$(a).find(".unsaved").removeClass("unsaved");EventsMan_commitChanges(f);if(d){PopUp_clickedClose(a)}}function PopUp_clickedUndo(b){var a=_PopUp_getPopUp(b);if(PopUp_isEditing(a)){return}var c=PopUp_getID(a);$(a).find("#save_button").addClass("hide");$(a).find("#undo_button").addClass("hide");$(a).find(".unsaved").removeClass("unsaved");EventsMan_cancelChanges(c)}var SE_id="settingsModal";function SE_init(){$("#"+SE_id).on("show.bs.modal",function(){var f=SE_addTypeSegmentedControlWithFilter("Visible in agenda:",AGENDA_FILTER);$(this).find("#agenda_options").append(f);var b=SE_addTypeSegmentedControlWithFilter("Visible in calendar:",CAL_FILTER);$(this).find("#calendar_options").append(b);var e=SC_initWithChoices("Theme",[{value:"w",pretty:"White",selected:THEME=="w"},{value:"b",pretty:"Black",selected:THEME=="b"}]);$(e).on("select",function(h,j){var g;$.each(j,function(k,l){if(l){g=k;return false}});THEME=g;if(g=="w"){loadWhiteTheme()}else{loadDarkTheme()}});$(this).find("#theme_options").append(e);var a=SC_initWithChoices("Show hidden events",[{value:1,pretty:"Yes",selected:EventsMan_showHidden()},{value:0,pretty:"No",selected:!EventsMan_showHidden()}]);$(a).on("select",function(g,h){$.each(h,function(j,k){if(k){EventsMan_showHidden(Boolean(parseInt(j)))}})});$(this).find("#hidden_options").append(a);var d=[];$.each(COURSE_MAP,function(g,h){d.push({value:g,pretty:h,selected:!(g in COURSE_FILTER_BLACKLIST)})});var c=SCM_initWithChoices("Visible courses:",d);$(c).on("select",function(g,h){$.each(h,function(j,k){if(k){COURSE_FILTER_BLACKLIST.remove(j)}else{COURSE_FILTER_BLACKLIST.add(j)}})});$(this).find("#course_options").append(c)});$("#"+SE_id).on("hide.bs.modal",function(){$(this).trigger("close");$.ajax("/put/ui-pref",{dataType:"json",type:"POST",data:{agenda_pref:JSON.stringify(AGENDA_FILTER),calendar_pref:JSON.stringify(CAL_FILTER),ui_pref:JSON.stringify({theme:THEME})},loadingIndicator:false})});$("#"+SE_id).on("hidden.bs.modal",function(){SC_removeAllFromContainer(this)})}function SE_addTypeSegmentedControlWithFilter(c,b){var d=[];$.each(TYPE_MAP,function(e,f){d.push({value:e,pretty:f,selected:b.contains(e)})});var a=SCM_initWithChoices(c,d);$(a).on("select",function(e,f){b.splice(0,b.length);$.each(f,function(h,g){if(g){b.push(h)}})});return a}function SE_checkSimilarEvents(a){if(SE_hasSimilarEvents(a.event_id)||SB_isFull()){return}$.ajax("/get/similar-events",{data:{event_dict:JSON.stringify(a)},dataType:"json",type:"POST",loadingIndicator:false,success:function(b){if(b.length>0){SE_showSimilarEventsNotification(a.event_id,b)}}})}function SE_showSimilarEventsNotification(a,c){var b=NO_showNotification(a,"A similar event already exists",NO_TYPES.WARNING,null);b.on("noti.click",function(d){SE_showSimilarEvents(a,c)})}function SE_hasSimilarEvents(a){return NO_hasNotificationID(a)}function SE_showSimilarEvents(d,e){var f=[];$.each(e,function(g,h){f.push({eventID:d,eventDict:h,buttons:[{value:"c",pretty:"Choose"}]})});var b=EP_init("Is this the same as your event?",f);SB_setMainContent(b);SB_fill();var c=PopUp_getPopUpByID(d);PopUp_markAsEditing(c);if(PopUp_hasMain()&&!PopUp_isMain(c)){var a=PopUp_getMainPopUp();PopUp_callCloseListeners(PopUp_getID(a));$(a).remove()}SB_push(c);PopUp_updateSize(c);PopUp_makeMain(c);$(c).draggable("disable");$(b).on("ep.cancel ep.select",function(g){PopUp_markAsNotEditing(c);$(c).draggable("enable");SB_pop(this);SB_unfill()});$(b).on("ep.select",function(g,h){EventsMan_replaceEventIDWithEvent(h.eventID,h.eventDict)})}var SR_willSaveListeners=[];var SR_didLoadListeners=[];var SR_ON=true;var SR_manager={};var SR_loaded=false;function SR_init(){SR_load();$(window).on("beforeunload",function(){SR_save()})}function SR_get(a){if(a in SR_manager){return SR_manager[a]}else{return null}}function SR_put(a,b){SR_manager[a]=b}function SR_load(){if(!SR_ON){return}if("localStorage" in window&&window.localStorage!==null){var b=localStorage.getItem("state-restoration");var a=localStorage.getItem("user");if(a==USER_NETID&&b){SR_manager=JSON.parse(b)}}SR_loaded=true;SR_callDidLoadListeners()}function SR_save(){if(!SR_ON){return}SR_callWillSaveListeners();if("localStorage" in window&&window.localStorage!==null){localStorage.setItem("state-restoration",JSON.stringify(SR_manager))}}function SR_addWillSaveListener(a){SR_willSaveListeners.push(a)}function SR_callWillSaveListeners(){$.each(SR_willSaveListeners,function(a){this()})}function SR_addDidLoadListener(a){if(SR_loaded){a()}else{SR_didLoadListeners.push(a)}}function SR_callDidLoadListeners(){$.each(SR_didLoadListeners,function(a){this()});SR_didLoadListeners=null}function UR_pullUnapprovedRevisions(){if(UR_hasUnapprovedRevisions()||SB_isFilled()){return}$.ajax("/get/unapproved",{async:true,dataType:"json",loadingIndicator:false,success:function(a){if(a&&a.length>0){var b=NO_showNotification("unapproved-rev","There are unapproved changes",NO_TYPES.INFO,null);b.on("noti.click",function(c){UR_showUnapprovedRevisions(a)})}}})}function UR_hasUnapprovedRevisions(){return NO_hasNotificationID("unapproved-rev")}function UR_showUnapprovedRevisions(b){var c=[];$.each(b,function(e,d){c.push({eventID:d.event_id,eventDict:d,buttons:[{value:"up",pretty:'<span class="glyphicon glyphicon-thumbs-up"></span>'},{value:"down",pretty:'<span class="glyphicon glyphicon-thumbs-down"></span>'}]})});var a=EP_init("Does this change look correct?",c);SB_setMainContent(a);SB_fill();EP_adjustPopUpSize(a);UR_updateLeft(0,b);$(a).on("ep.cancel",function(d){UR_close(this)});$(a).on("ep.select",function(d,e){$.ajax("/put/votes",{data:{votes:JSON.stringify([{is_positive:e.button=="up",revision_id:parseInt(e.eventDict.revision_id)}])},type:"POST",success:function(f){updatePoints()}});if(b.length==1){UR_close(this)}else{EP_removeItemAtIndex(a,e.index);b.splice(e.index,1)}});$(a).on("ep.slid",function(d,e){UR_updateLeft(e.index,b)})}function UR_updateLeft(a,b){if(EventsMan_hasEvent(b[a].event_id)){var c=PopUp_getMainPopUp();PopUp_setToEventID(c,b[a].event_id);$(c).draggable("disable")}else{if(PopUp_hasMain()){var c=PopUp_getMainPopUp();PopUp_close(c)}}}function UR_close(a){var b=PopUp_getMainPopUp();PopUp_close(b);SB_pop(a);SB_unfill();SB_hide();LO_showTemporaryMessage("Thanks for voting!",LO_TYPES.SUCCESS);EventsMan_verifyLocalStorage()};
>>>>>>> eecdf097dd8ed2fe44978d5f4c503c324043a350
