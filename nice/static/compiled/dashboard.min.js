function AS_showActionSheetFromElement(d,a,e,f,b){var c=$("<div>");$.each(f,function(g){var h=$("<a>").addClass("white-link-btn").addClass("prompt-btn").attr("id",g).text(this.text);if(this.important){h=h.addClass("no")}else{h=h.addClass("yes")}h.on("click",function(i){i.preventDefault();$(d).blur();b(g)});c.append(h)});$(d).popover({title:e,placement:"bottom",html:true,content:c[0],trigger:"focus",container:$(a)});$(d).focus()}var cacheManager=null;var CACHE_INIT=false;function CacheMan_init(){if(CACHE_INIT){return}CACHE_INIT=true;cacheManager=new _CacheMan();if(false&&typeof CACHEMAN_PRELOAD!="undefined"){for(var a=0;a<CACHEMAN_PRELOAD.length;a++){_CacheMan_cacheURL(CACHEMAN_PRELOAD[a],true)}}}function _CacheMan(){this.cached={};return this}function CacheMan_load(a){if(cacheManager.cached[a]==null){_CacheMan_cacheURL(a,false);return CacheMan_load(a)}return cacheManager.cached[a]}function _CacheMan_cacheURL(a,b){$.ajax(a,{async:b,dataType:"html",success:function(c){cacheManager.cached[a]=c}})}CAL_INIT=false;Cal_eventSource={events:[]};Cal_options={defaultView:"agendaWeek",slotMinutes:30,firstHour:8,minTime:8,maxTime:23,eventDurationEditable:false,eventStartEditable:false,eventBackgroundColor:"#74a2ca",eventBorderColor:"#428bca",allDayDefault:false,eventSources:[Cal_eventSource],ignoreTimezone:false,allDaySlot:false,slotEventOverlap:true};function Cal_init(){}function EP_init(b,c){var a=$(CacheMan_load("event-picker"));a.find("#ep-title").text(b);a.data("count",c.length);$.each(c,function(g,d){var f=$(CacheMan_load("event-picker-item"));if(g==0){f.addClass("active")}var e=f.find(".popup-ep")[0];var h=d.eventDict;PopUp_setTitle(e,h.event_title);PopUp_setDescription(e,h.event_description);PopUp_setLocation(e,h.event_location);PopUp_setSection(e,h.section_id);PopUp_setType(e,h.event_type);PopUp_setDate(e,h.event_start);PopUp_setStartTime(e,h.event_start);PopUp_setEndTime(e,h.event_end);$.each(d.buttons,function(i,k){var j=$("<a>").addClass("white-link-btn").addClass("theme");j.html(k.pretty);j.data("value",k.value);j.on("click",function(l){l.preventDefault();a.trigger("ep.select",{eventID:d.eventID,eventDict:d.eventDict,button:$(this).data("value")})});f.find("#ep-item-controls").append(j)});a.find("#ep-container").append(f)});a.find("#cancel_button").on("click",function(d){d.preventDefault();a.trigger("ep.cancel")});a.on("slid.bs.carousel",function(f){_EP_updateButtons(this);var e=$(ep).find(".item.active").index();var d=c[e];$(this).trigger("ep.slid",{eventID:d.eventID,eventDict:d.eventDict,index:e})});_EP_updateButtons(a[0]);return a[0]}function _EP_updateButtons(c){var b=$(c);var a=b.find(".item.active").index();b.find(".ep-control").removeClass("disabled-btn");if(a==0){b.find(".left.ep-control").addClass("disabled-btn")}if(a==b.data("count")-1){b.find(".right.ep-control").addClass("disabled-btn")}}var eventsManager=null;var EventsMan_updateListeners=[];var EventsMan_onReadyListeners=[];var EventsMan_eventIDsChangeListener=[];var EVENTS_INIT=false;var EVENTS_READY=false;function EventsMan_init(){}function _EventsMan_new(){this.events={};this.order=[];this.lastSyncedTime=0;this.addedCount=0;this.updatedIDs=new Set();this.uncommitted={};this.hiddenIDs=new Set();this.changed=false;this.isIdle=true;this.showHidden=false;return this}function EventsMan_constructOrderArray(){eventsManager.order=[];$.each(eventsManager.events,function(a,b){eventsManager.order.push({event_start:b.event_start,event_id:a})});eventsManager.order.sort(function(d,c){return parseInt(d.event_start)-parseInt(c.event_start)})}function EventsMan_showHidden(a){if(typeof a!="undefined"){eventsManager.showHidden=a;_EventsMan_callUpdateListeners()}return eventsManager.showHidden}function EventsMan_getEventByID(a){return eventsManager.events[a]}function EventsMan_hasEvent(a){return(a in eventsManager.events)||(a in eventsManager.uncommitted)}function EventsMan_getEventIDForRange(g,c){var f=0;while(f<eventsManager.order.length&&eventsManager.order[f].event_start<g){f++}var b=f;while(f<eventsManager.order.length&&eventsManager.order[f].event_start<c){f++}var a=Math.min(f,eventsManager.order.length);var e=eventsManager.order.slice(b,a);var d=[];for(var f=0;f<e.length;f++){if(EventsMan_showHidden()||!EventsMan_eventIsHidden(e[f].event_id)){d.push(e[f].event_id)}}return d}function EventsMan_getAllEventIDs(){var a=[];$.each(eventsManager.events,function(b,c){if(EventsMan_showHidden()||!EventsMan_eventIsHidden(b)){a.push(b)}});return a}function EventsMan_hasUncommitted(a){return a in eventsManager.uncommitted}function EventsMan_getUncommitted(a){return eventsManager.uncommitted[a]}function EventsMan_addEvent(){var d=String(-1*++eventsManager.addedCount);var b=123;for(var a in SECTION_MAP){b=a;break}var c={event_id:d,event_group_id:d,event_title:"Event Name",event_type:"AS",event_start:moment().unix(),event_end:moment().minute(moment().minute()+50).unix(),event_description:"Event description \n Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.",event_location:"Event location",course_id:-1,section_id:b,modified_user:USER_NETID,modified_time:moment().unix()};eventsManager.uncommitted[d]=c;return d}function EventsMan_deleteEvent(b,a){a=a||false;if(b in eventsManager.events){eventsManager.hiddenIDs.add(b);eventsManager.changed=true}if(b in eventsManager.uncommitted){eventsManager.uncommitted[b]=null;delete eventsManager.uncommitted[b]}if(b in eventsManager.updatedIDs){eventsManager.updatedIDs.remove(b)}if(!a){_EventsMan_callUpdateListeners()}}function EventsMan_deleteAllFutureEvents(d){var c=EventsMan_getEventByID(d);var b=moment.unix(c.event_start);b.year(b.year()+20);var a=EventsMan_getEventIDForRange(c.event_start,b.unix());$.each(a,function(e){var f=EventsMan_getEventByID(this);if(f.event_group_id==c.event_group_id&&f!=c){EventsMan_deleteEvent(this,true)}});EventsMan_deleteEvent(d)}function EventsMan_unhideEvent(b,a){a=a||false;if(b in eventsManager.events){eventsManager.hiddenIDs.remove(b);eventsManager.changed=true}if(!a){_EventsMan_callUpdateListeners()}}function EventsMan_unhideAllFutureEvents(d){var c=EventsMan_getEventByID(d);var b=moment.unix(c.event_start);b.year(b.year()+20);var a=EventsMan_getEventIDForRange(c.event_start,b.unix());$.each(a,function(e){var f=EventsMan_getEventByID(this);if(f.event_group_id==c.event_group_id&&f!=c){EventsMan_unhideEvent(this,true)}});EventsMan_unhideEvent(d)}function EventsMan_eventIsHidden(a){return a in eventsManager.hiddenIDs}function EventsMan_eventShouldBeShown(a){return !EventsMan_eventIsHidden(a)||EventsMan_showHidden()}function EventsMan_ready(){return EVENTS_READY}function EventsMan_commitChanges(a){eventsManager.events[a]=eventsManager.uncommitted[a];delete eventsManager.uncommitted[a];eventsManager.updatedIDs.add(a);EventsMan_constructOrderArray();_EventsMan_callUpdateListeners()}function EventsMan_cancelChanges(a){delete eventsManager.uncommitted[a];_EventsMan_callUpdateListeners()}function EventsMan_commitChangesToAllFutureEvents(g){var b=eventsManager.uncommitted[g];var c=eventsManager.events[g];var f=moment.unix(c.event_start);f.year(f.year()+20);var e=EventsMan_getEventIDForRange(c.event_start,f.unix());var a=moment.unix(b.event_start);var d=moment.unix(b.event_end);$.each(e,function(i){var k=EventsMan_getEventByID(this);if(k.event_group_id==c.event_group_id&&k!=c){k.event_title=b.event_title;k.event_description=b.event_description;k.event_location=b.event_location;k.section_id=b.section_id;k.event_type=b.event_type;k.modified_time=b.modified_time;k.modified_user=b.modified_user;var j=moment.unix(k.event_start).hour(a.hour());j.minute(a.minute());j.second(a.second());k.event_start=j.unix();var h=moment.unix(k.event_end).hour(d.hour());h.minute(d.minute());h.second(d.second());k.event_end=h.unix();eventsManager.updatedIDs.add(k.event_id)}});EventsMan_commitChanges(g)}function EventsMan_replaceUncommittedEventIDWithEvent(b,a){eventsManager.uncommitted[b]=null;delete eventsManager.uncommitted[b];eventsManager.uncommitted[a.event_id]=a;EventsMan_callEventIDsChangeListener(b,a.event_id);_EventsMan_callUpdateListeners()}function EventsMan_replaceEventIDWithEvent(b,a){eventsManager.events[b]=null;delete eventsManager.events[b];eventsManager.events[a.event_id]=a;if(EventsMan_hasUncommitted(b)){delete eventsManager.uncommitted[b]}EventsMan_callEventIDsChangeListener(b,a.event_id);_EventsMan_callUpdateListeners()}function EventsMan_pushToServer(a){}function EventsMan_pullFromServer(a){}function _EventsMan_callUpdateListeners(){$.each(EventsMan_updateListeners,function(a){this()})}function EventsMan_addUpdateListener(a){EventsMan_updateListeners.push(a)}function EventsMan_addOnReadyListener(a){if(EVENTS_READY){a();return}EventsMan_onReadyListeners.push(a)}function EventsMan_callOnReadyListeners(){$.each(EventsMan_onReadyListeners,function(a){this()});EventsMan_onReadyListeners=null}function EventsMan_addEventIDsChangeListener(a){EventsMan_eventIDsChangeListener.push(a)}function EventsMan_callEventIDsChangeListener(b,a){$.each(EventsMan_eventIDsChangeListener,function(c){this(b,a)})}function EventsMan_cloneEventDict(b){var a=JSON.parse(JSON.stringify(b));return a}var MAIN_TIMEZONE="America/New_York";var DAYS_DICT=["M","Tu","W","Th","F","Sa","S"];var TYPE_MAP_INVERSE={assignment:"AS",exam:"EX",lab:"LA",lecture:"LE","office hours":"OH",precept:"PR","review session":"RS"};var TYPE_MAP={AS:"assignment",EX:"exam",LA:"lab",LE:"lecture",OH:"office hours",PR:"precept",RS:"review session"};String.prototype.escapeHTML=function(){var a={"&":"&amp;","<":"&lt;",">":"&gt;"};return this.replace(/[&<>]/g,function(b){return a[b]||b})};Array.prototype.contains=function(b){for(var c=0;c<this.length;c++){if(this[c]==b){return true}}return false};Array.prototype.find=function(b){for(var c=0;c<this.length;c++){if(this[c]==b){return c}}return -1};Array.prototype.equals=function(b){var c;for(c=0;c<this.length;c++){if(c>=b.length){return false}else{if(this[c]!=b[c]){return false}}}return c==b.length};function LO_show(){if($("#loading").length>0){return}var a=LO_getLoadingHTML();$("body").append(a);$("#loading").addClass("in")}function LO_hide(){$("#loading").removeClass("in").on("transitionend",function(){$(this).remove()})}function LO_showError(){if($("#loading.error").length>0){return}if($("#loading").not(".error").length>0){$("#loading").not(".error").remove()}var a=LO_getLoadingHTML();a.removeClass("alert-info").addClass("alert-danger");a.find("#loading-content").text("Error connecting. Will keep trying");$("body").append(a);$("#loading").addClass("in")}function LO_getLoadingHTML(){var a=$("<div>").addClass("alert alert-dismissable alert-info");a.attr("id","loading");a.append($('<span id="loading-content">'));a.find("#loading-content").append('Loading...&nbsp;&nbsp;&nbsp;<span id="loading-icon" class="glyphicon glyphicon-refresh"></span>');return a}var pinnedIDs=null;var mainID=null;var csrftoken=$.cookie("csrftoken");var COURSE_COLOR_MAP;var SECTION_COLOR_MAP;function UI_pin(a){if(UI_isMain(a)){UI_unsetMain()}pinnedIDs.add(a)}function UI_isPinned(a){return a in pinnedIDs}function UI_unpin(a){pinnedIDs.remove(a)}function UI_isMain(a){return mainID==a}function UI_setMain(a){if(UI_isPinned(a)){UI_unpin(a)}mainID=a}function UI_unsetMain(){mainID=null}function csrfSafeMethod(a){return(/^(GET|HEAD|OPTIONS|TRACE)$/.test(a))}function sameOrigin(b){var d=document.location.host;var e=document.location.protocol;var c="//"+d;var a=e+c;return(b==a||b.slice(0,a.length+1)==a+"/")||(b==c||b.slice(0,c.length+1)==c+"/")||!(/^(\/\/|http:|https:).*/.test(b))}function toTitleCase(a){return a.replace(/\w\S*/g,function(b){return b.charAt(0).toUpperCase()+b.substr(1).toLowerCase()})}function br2nl(a){return a.replace(/(\n|\r)/g,"").replace(/<br>/g,"\n")}function nl2br(a){return a.replace(/(\n|\r)/g,"<br>")}function loadWhiteTheme(){$(".theme").removeClass("dark");$("#theme_css").attr("href","/static/cosmo/bootstrap.css")}function loadDarkTheme(){$(".theme").addClass("dark");$("#theme_css").attr("href","/static/cyborg/bootstrap.css")}var POPUP_HTML=null;var POPUP_CLASS="popup";var POPUP_URL="popup-template";var PopUp_closeListeners=[];var PopUp_editListeners=[];var PopUp_freedSpace=[];var PopUp_space=0;var POPUP_INIT=false;var POPUP_EDITDICT={"popup-loc":"event_location","popup-title":"event_title","popup-date":"event_date","popup-time-start":"event_start","popup-time-end":"event_end","popup-type":"event_type","popup-section":"section_id","popup-desc":"event_description","popup-repeat-end":"recurrence_end","popup-repeat-interval":"recurrence_interval"};var PopUp_Main_optFirstDrag=function(a){};var POPUP_MAIN_FIRSTDRAG=function(a){if(PopUp_isMain(a)){a.id="";PopUp_Main_optFirstDrag(a);UI_pin(PopUp_getID(a));UI_unsetMain();var b=a.getBoundingClientRect();$(a).css({height:b.height+"px",width:b.width+"px"});$(a).appendTo("body");$(a).css({top:b.top,left:b.left});PopUp_makeResizable(a);SB_hide()}};function PopUp_insertPopUp(b){var d;if(POPUP_HTML){d=POPUP_HTML}else{d=CacheMan_load(POPUP_URL)}if(b){SB_push(d)}else{$("body").append(d)}var c=$("#popup-main123");var a=function(){POPUP_MAIN_FIRSTDRAG(c);if(c.space){PopUp_freedSpace.push(c.space)}};c.draggable({handle:".panel > .panel-heading",containment:"#content_bounds",scroll:false,appendTo:"body",beforeStart:function(f,g){a()},zIndex:2000});c=c[0];c.id="popup-main";if(!b){var e;if(PopUp_freedSpace.length==0){e=++PopUp_space}else{e=PopUp_freedSpace.sort(function(g,f){return f-g}).pop()}c.id="";PopUp_makeResizable(c);leftPos=parseInt($(c).css("left"));topPos=parseInt($(c).css("top"));$(c).css("left",(leftPos+20*e)+"px").css("top",(topPos+20*e)+"px");c.space=e}c.onmousedown=function(){PopUp_giveFocus(this)};maxHeight=window.innerHeight-$(".navbar").height()-100;$(c).css("max-height",maxHeight+"px");_PopUp_setBodyHeight(c);PopUp_initialize(c);setTimeout(function(){PopUp_initialize_deferred(c)},300);return c}function PopUp_initialize(a){}function PopUp_initialize_deferred(a){}function PopUp_close(a){if(UI_isMain(PopUp_getID(a))){UI_unsetMain();SB_pop(a)}else{UI_unpin(PopUp_getID(a));$(a).remove()}SB_hideIfEmpty()}function PopUp_getMainPopUp(){var a=$("#popup-main");if(a.length>0){a=$("#popup-main")[0]}else{a=PopUp_insertPopUp(true)}return a}function PopUp_getPopUpByID(a){if($("."+POPUP_CLASS).find("#"+a).length>0){return $("."+POPUP_CLASS).find("#"+a).parent()[0]}else{return null}}function PopUp_getID(a){if(!a){return null}if(!("id" in $(a).find(".panel")[0])){return null}return $(a).find(".panel")[0].id}function PopUp_setID(a,c){var b=$(a).find(".panel")[0].id;$(a).find(".panel")[0].id=c;if(a.id=="popup-main"){UI_setMain(c)}else{UI_unpin(b);UI_pin(c)}}function _PopUp_setBodyHeight(b){var c=$(b).find(".panel-heading").css("height");var a=$(b).css("height");$(b).find(".panel-body").css("height",(parseInt(a)-parseInt(c))+"px")}function PopUp_giveFocus(b){if(!b){return}PopUp_loseFocus($("."+POPUP_CLASS).not(b));$(b).css("z-index","200");var a=$(b).find(".panel").data("my-color");$(b).find(".panel").addClass("panel-primary").removeClass("panel-default").css("border-color",a);$(b).find("#popup-title").parent().parent().css("background-color",a).css("border-color",a);if(UI_isMain(PopUp_getID(b))){SB_show()}}function PopUp_loseFocus(a){a.each(function(c){var b=$(this).find(".panel").data("default-border");var d=$(this).find(".panel").data("default-header");$(this).css("z-index","100").find(".panel").addClass("panel-default").removeClass("panel-primary").css("border-color",b);$(this).find("#popup-title").parent().parent().css("background-color",d).css("border-color",b)})}function PopUp_giveFocusToID(a){popUp=$("."+POPUP_CLASS).find("#"+a).parent();PopUp_giveFocus(popUp)}function PopUp_hasFocus(a){return $(a).find(".panel").hasClass("panel-primary")}function PopUp_updateSize(a){$(a).find(".panel").css({width:$(a).css("width"),height:$(a).css("height")});_PopUp_setBodyHeight(a)}function PopUp_isMain(a){return a.id=="popup-main"}function PopUp_makeMain(a){a.id="popup-main";var c=PopUp_getID(a);if(UI_isPinned(c)){UI_unpin(c)}UI_setMain(c);try{$(a).find(".panel").resizable("destroy")}catch(b){}}function PopUp_hasMain(a){return $("#popup-main").length>0}function PopUp_makeResizable(a){$(a).find(".panel").resizable({stop:function(c,b){$(this).parent().css("height",$(this).css("height"));$(this).parent().css("width",$(this).css("width"));_PopUp_setBodyHeight(this)}})}function PopUp_addCloseListener(a){PopUp_closeListeners.push(a)}function PopUp_addEditListener(a){PopUp_editListeners.push(a)}function PopUp_callCloseListeners(a){$(PopUp_closeListeners).each(function(b){this(a)})}function PopUp_callEditListeners(c,b,a){$(PopUp_editListeners).each(function(d){this(c,b,a)})}function _PopUp_getPopUp(b){var a=b;while(!$(a).hasClass("popup")){a=$(a).parent()[0]}return a}function PopUp_map(a){$("."+POPUP_CLASS).not("#popup-main").each(function(b){a(this,false)});$("#popup-main").each(function(b){a(this,true)})}function SC_initWithChoices(b,c){$container=$("<div>").addClass("segmented-control").append($("<h5>"));$container.find("h5").text(b);var a=$("<div>").addClass("btn-group");$.each(c,function(d){var e=$("<button>").addClass("btn").addClass("btn-sm").text(this.pretty).data("value",this.value).on("click",function(f){f.preventDefault();SC_select(this)});a.append(e);if(this.selected||d==0){SC_select(e)}});$container.append(a);return $container[0]}function SC_setToChoices(a,b){$(a).find("button").each(function(d){for(var e=0;e<b.length;e++){var c=b[e];if(c.value==$(this).data("value")){if(c.selected){SC_select(this,true)}break}}})}function SC_removeAllFromContainer(a){$(a).find(".segmented-control").remove()}function SC_select(b,a){a=a||false;SC_unhighlight($(b).parent().find(".btn-primary"));SC_highlight(b);if(a){return}var c={};$(b).parent().find(".btn").each(function(d){c[$(this).data("value")]=$(this).hasClass("btn-primary")});$(b).trigger("select",c)}function SC_highlight(a){$(a).addClass("btn-primary")}function SC_unhighlight(a){$(a).removeClass("btn-primary")}function SC_isHighlighted(a){return $(a).hasClass("btn-primary")}function SCM_initWithChoices(a,c){var b=SC_initWithChoices(a,c);$(b).find("button").each(function(e){$(this).off("click");$(this).on("click",function(g){g.preventDefault();if(SC_isHighlighted(this)){SCM_deselect(this)}else{SCM_select(this)}});for(var f=0;f<c.length;f++){var d=c[f];if(d.value==$(this).data("value")){if(d.selected){SCM_select(this)}break}}});return b}function SCM_select(a){SC_highlight(a);var b={};$(a).parent().find(".btn").each(function(c){b[$(this).data("value")]=$(this).hasClass("btn-primary")});$(a).trigger("select",b)}function SCM_deselect(a){SC_unhighlight(a);var b={};$(a).parent().find(".btn").each(function(c){b[$(this).data("value")]=$(this).hasClass("btn-primary")});$(a).trigger("select",b)}function SCM_setToChoices(a,b){$(a).find("button").each(function(d){SCM_deselect(this);for(var e=0;e<b.length;e++){var c=b[e];if(c.value==$(this).data("value")){if(c.selected){SCM_select(this)}break}}})}function SCP_initOnElement(b,a,c,f){if($(b).data("scp")){var e=$(b).data("scp");SC_setToChoices(e,f);return e}var d=SC_initWithChoices(null,f);$(d).find(".btn-group").addClass("btn-group-vertical").removeClass("btn-group");$(b).popover({title:c,placement:"left",html:true,content:d,trigger:"focus",container:$(a)});$(b).data("scp",d);return d}var Set=function(){};Set.prototype.size=0;Set.prototype.add=function(a){this[a]=true;this.size++};Set.prototype.remove=function(a){delete this[a];this.size--};Set.prototype.fromArray=function(c){var a=new Set();for(var b=0;b<c.length;b++){a.add(c[b])}return a};Set.prototype.toArray=function(){var a=[];for(var b in this){if(typeof this[b]!="function"&&b!="size"){a.push(b)}}a.sort();return a};Set.prototype.contains=function(b){for(var c in b){if(!(c in this)){return false}}return true};Set.prototype.equals=function(b){return this.contains(b)&&b.contains(this)};var SB_willCloseListeners=[];function SB_init(){$("#sidebar").droppable({drop:function(c,d){if(PopUp_hasMain()){var a=PopUp_getMainPopUp();PopUp_callCloseListeners(PopUp_getID(a));$(a).remove()}var b=d.draggable[0];$(b).detach().appendTo("#sb-left-container").css({width:"100%",height:"350px",left:"auto",top:"auto"});$(b).addClass("sb-left-content");$(b).addClass("in");PopUp_updateSize(b);PopUp_makeMain(b)},hoverClass:"hover-active"});$("#sidebar-target").droppable({over:function(a,b){SB_show()},out:function(a,b){if(SB_isEmpty()){SB_hide()}}})}function SB_isEmpty(){return $("#sidebar").find(".in").length==0}function SB_show(){$("#sidebar").addClass("in");$("#sb-handle").find(".glyphicon").addClass("glyphicon-chevron-right").removeClass("glyphicon-chevron-left")}function SB_hide(){SB_callWillCloseListeners();SB_unfill();$("#sidebar").removeClass("in");$("#sb-handle").find(".glyphicon").removeClass("glyphicon-chevron-right").addClass("glyphicon-chevron-left")}function SB_hideIfEmpty(){if(SB_isEmpty()){SB_hide()}}function SB_isShown(){return $("#sidebar").hasClass("in")}function SB_push(a){a=$(a).addClass("sb-left-content")[0];$("#sb-left-container").append(a);if(!SB_isShown()){SB_show()}setTimeout("$('#sb-left-container').find('.sb-left-content').addClass('in')",10)}function SB_pop(a){$(a).removeClass("in").on("transitionend",function(){$(a).remove()});SB_hideIfEmpty()}function SB_setMainContent(a){a=$(a).addClass("sb-full-content")[0];$("#sb-full-container").append(a);setTimeout("$('#sb-full-container').find('.sb-full-content').addClass('in')",10)}function SB_fill(){$("#sidebar").addClass("full");disableAllInteractions()}function SB_unfill(){$("#sidebar").removeClass("full");enableAllInteractions()}function SB_toggle(){if(SB_isShown()){SB_hide()}else{SB_show()}}function SB_addWillCloseListener(a){SB_willCloseListeners.push(a)}function SB_callWillCloseListeners(){$.each(SB_willCloseListeners,function(a){this()})}AGENDA_INIT=false;var AGENDA_HTML=null;function Agenda_init(){if(AGENDA_INIT){return}AGENDA_INIT=true;AGENDA_HTML=$("#agenda-template").html();$("#agenda-template").remove();EventsMan_addUpdateListener(function(){Agenda_reload()});$("#"+SE_id).on("close",function(a){Agenda_reload()});$(".tab-pane").each(function(a){if(this.id=="agenda"){$(this).bind("webkitTransitionEnd transitionend otransitionend oTransitionEnd",function(b){if($(this).hasClass("in")){Agenda_reload()}})}});PopUp_addCloseListener(function(a){Agenda_unhighlight($(".tab-content").find(".agenda-item.panel#"+a))})}function Agenda_reload(){var c=$("#agenda");var d=false;c[0].innerHTML=null;var b=moment();var a=moment().date(b.date()-1).hour(0).minute(0).second(0);var f=moment().date(b.date()).hour(0).minute(0).second(0);var e=EventsMan_getEventIDForRange(a.unix(),f.unix());e=Agenda_filterEvents(e);if(e.length>0){d|=true;Agenda_insertHeader("Yesterday");Agenda_loadEvents(e)}a=f;f=moment().date(b.date()+1).hour(0).minute(0).second(0);e=EventsMan_getEventIDForRange(a.unix(),f.unix());e=Agenda_filterEvents(e);if(e.length>0){d|=true;Agenda_insertHeader("Today");Agenda_loadEvents(e)}a=f;f=moment().date(b.date()+7).hour(0).minute(0).second(0);e=EventsMan_getEventIDForRange(a.unix(),f.unix());e=Agenda_filterEvents(e);if(e.length>0){d|=true;Agenda_insertHeader("This Week");Agenda_loadEvents(e)}a=f;f=moment().month(b.month()+1);f=f.date(0);e=EventsMan_getEventIDForRange(a.unix(),f.unix());e=Agenda_filterEvents(e);if(e.length>0){d|=true;Agenda_insertHeader("This month");Agenda_loadEvents(e)}if(!d){Agenda_insertHeader("Congrats! You have nothing on your agenda!")}}function Agenda_filterEvents(b){var a=[];$.each(b,function(c){var d=EventsMan_getEventByID(this);if(!d){return}if(AGENDA_FILTER.contains(d.event_type)){a.push(this)}});return a}function Agenda_loadEvents(b){var a=$("#agenda");$.each(b,function(e){var f=EventsMan_getEventByID(this);if(!f){return}a.append($(AGENDA_HTML));var d=a.find("#agenda123")[0];d.id=this;$(d).find(".panel-body").find("h4").text(f.event_title);$(d).find("#agenda-section").text(SECTION_MAP[f.section_id]);var g=moment.unix(f.event_start);var c=g.tz(MAIN_TIMEZONE).calendar();$(d).find("#agenda-time").text(c);_Agenda_setColors(d,f);if(UI_isPinned(d.id)){Agenda_highlight(d)}if(UI_isMain(d.id)){Agenda_highlight(d)}if(EventsMan_eventIsHidden(this)){}else{}});if(THEME=="w"){$(".theme").removeClass("dark")}else{$(".theme").addClass("dark")}}function _Agenda_setColors(b,d){var e="course-color-"+d.course_id;var a=SECTION_COLOR_MAP[d.section_id]["color"];$(b).find("#agenda-section").addClass(e).css("color",a);$(b).find("#agenda-title").addClass(e).css("color",a);$(b).parent().find(".agenda-tag").addClass(e).css("background-color",a);$(b).data("new-color",a);var c=$(b).css("border-color");$(b).data("default-color",c)}function Agenda_insertHeader(c){var a=$("#agenda");var b=$('<div class="agenda-header row">');$('<div class="col-xs-5">').append('<h3 id="agenda-header-text"></h3>').appendTo(b);a.append(b);b.find("#agenda-header-text").text(c)}function selectAgenda(c){var a=$(c).find(".panel")[0];if(Agenda_isHighlighted(a)){var d=a.id;PopUp_giveFocusToID(d);return}if(SHIFT_PRESSED){Agenda_highlight(a);b=PopUp_insertPopUp(false);PopUp_setToEventID(b,a.id);PopUp_giveFocus(b);return}Agenda_unhighlight($(".agenda-item.panel-primary").filter(function(){return !UI_isPinned(this.id)}));Agenda_highlight(a);var b=PopUp_getMainPopUp();PopUp_setToEventID(b,a.id);PopUp_giveFocus(b)}function Agenda_highlight(b){if(Agenda_isHighlighted(b)){return}var a=$(b).data("new-color");$(b).addClass("panel-primary").removeClass("panel-default").css({"border-color":a})}function Agenda_unhighlight(a){var b=$(a).data("default-color");$(a).addClass("panel-default").removeClass("panel-primary").css({"border-color":b})}function Agenda_isHighlighted(a){return $(a).hasClass("panel-primary")}var CAL_LOADING=false;function Cal_init(){if(CAL_INIT){return}var a=window.innerHeight-$(".navbar").height()-50;EventsMan_addUpdateListener(function(){if(Cal_active()){Cal_reload()}});$("#"+SE_id).on("close",function(b){Cal_reload()});Cal_options.height=a;Cal_options.eventClick=function(e,c,b){if(e.highlighted==true){PopUp_giveFocusToID(e.id);return}if(SHIFT_PRESSED){Cal_highlightEvent(e,true);var d=PopUp_insertPopUp(false);PopUp_setToEventID(d,e.id);PopUp_giveFocus(d);return}$($("#calendarui").fullCalendar("clientEvents",function(f){return !UI_isPinned(f.id)})).each(function(f){Cal_unhighlightEvent(this,false)});Cal_highlightEvent(e,true);var d=PopUp_getMainPopUp();PopUp_setToEventID(d,e.id);PopUp_giveFocus(d)};Cal_options.windowResize=function(c){var b=window.innerHeight-$(".navbar").height()-50;$("#calendarui").fullCalendar("option","height",b)};$("#calendarui").fullCalendar(Cal_options);CAL_INIT=true;$(".tab-pane").each(function(b){if(this.id=="calendar"){$(this).bind("webkitTransitionEnd transitionend otransitionend oTransitionEnd",function(c){if($(this).hasClass("in")){Cal_render();Cal_reload()}})}});PopUp_addCloseListener(function(b){$($("#calendarui").fullCalendar("clientEvents",b)).each(function(c){Cal_unhighlightEvent(this,true)})})}function Cal_active(){return $("#calendar").hasClass("active")}function Cal_reload(){if(CAL_LOADING){return}CAL_LOADING=true;var a=EventsMan_getAllEventIDs();Cal_eventSource.events=[];setTimeout(function(){try{$.each(a,function(d){eventDict=EventsMan_getEventByID(this);if(!eventDict){return}if(!CAL_FILTER.contains(eventDict.event_type)){return}var c=UI_isPinned(this)||UI_isMain(this);var e=EventsMan_eventIsHidden(this);color=SECTION_COLOR_MAP[eventDict.section_id]["color"];Cal_eventSource.events.push({id:eventDict.event_id,title:eventDict.event_title,start:moment.unix(eventDict.event_start).tz(MAIN_TIMEZONE).toISOString(),end:moment.unix(eventDict.event_end).tz(MAIN_TIMEZONE).toISOString(),highlighted:c,backgroundColor:c?colorLuminance(color,0):colorLuminance(color,0.2),borderColor:colorLuminance(color,0)})});$("#calendarui").fullCalendar("refetchEvents");CAL_LOADING=false}catch(b){CAL_LOADING=false}},10)}function Cal_render(){$("#calendarui").fullCalendar("render")}function Cal_highlightEvent(b,a){if(!b.highlighted){b.backgroundColor=colorLuminance(b.backgroundColor,-0.2)}b.highlighted=true;if(a){$("#calendarui").fullCalendar("updateEvent",b)}}function Cal_unhighlightEvent(b,a){if(b.highlighted){b.backgroundColor=colorLuminance(b.backgroundColor,0.2)}b.highlighted=false;if(a){$("#calendarui").fullCalendar("updateEvent",b)}}function colorLuminance(e,a){e=String(e).replace(/[^0-9a-f]/gi,"");if(e.length<6){e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]}a=a||0;var b="#",f,d;for(d=0;d<3;d++){f=parseInt(e.substr(d*2,2),16);f=Math.round(Math.min(Math.max(0,f+(f*a)),255)).toString(16);b+=("00"+f).substr(f.length)}return b}var timeoutIDs=[];var EVENTSMAN_COUNT=0;function EventsMan_init(){if(EVENTS_INIT){return}EVENTS_INIT=true;eventsManager=new _EventsMan_new();if(typeof EVENTSMAN_PRELOAD!="undefined"){EventsMan_processDownloadedEvents(JSON.parse(EVENTSMAN_PRELOAD));EVENTS_READY=true;EventsMan_callOnReadyListeners();_EventsMan_callUpdateListeners()}else{EventsMan_pullFromServer(function(){EVENTS_READY=true;EventsMan_callOnReadyListeners()},true)}PopUp_addEditListener(function(a,f,h){if(f=="event_type"){h=TYPE_MAP_INVERSE[h.toLowerCase()];if(a in eventsManager.events&&eventsManager.events[a][f]==h){return}if(!(a in eventsManager.uncommitted)){eventsManager.uncommitted[a]=EventsMan_cloneEventDict(eventsManager.events[a])}eventsManager.uncommitted[a][f]=h}else{if(f=="section_id"){h=SECTION_MAP_INVERSE[h.toLowerCase()];if(a in eventsManager.events&&eventsManager.events[a][f]==h){return}if(!(a in eventsManager.uncommitted)){eventsManager.uncommitted[a]=EventsMan_cloneEventDict(eventsManager.events[a])}eventsManager.uncommitted[a][f]=h}else{if(f=="event_date"){if(!(a in eventsManager.uncommitted)){eventsManager.uncommitted[a]=EventsMan_cloneEventDict(eventsManager.events[a])}var e=eventsManager.uncommitted[a];var b=moment.unix(e.event_start);var d=moment.unix(e.event_end);var i=moment(h);if(a in eventsManager.events&&i.date()==b.date()&&i.month()==b.month()&&i.year()==b.year()){return}b.year(i.year());b.month(i.month());b.date(i.date());d.year(i.year());d.month(i.month());d.date(i.date());e.event_start=b.unix();e.event_end=d.unix()}else{if(f=="event_start"||f=="event_end"){if(!(a in eventsManager.uncommitted)){eventsManager.uncommitted[a]=EventsMan_cloneEventDict(eventsManager.events[a])}h="April 25, 2014 "+h;var e=eventsManager.uncommitted[a];var c=moment.unix(e[f]);var g=moment(h);if(a in eventsManager.events&&c.minute()==g.minute()&&c.hour()==g.hour()){return}c.hour(g.hour());c.minute(g.minute());e[f]=c.unix()}else{if(f=="event_recurrence"){if(h){if(a in eventsManager.events&&"recurrence_days" in eventsManager.events[a]&&eventsManager.events[a].recurrence_days.equals(h)){return}if(!(a in eventsManager.uncommitted)){eventsManager.uncommitted[a]=EventsMan_cloneEventDict(eventsManager.events[a])}var e=eventsManager.uncommitted[a];h.sort();e.recurrence_days=h;e.recurrence_interval=1;e.recurrence_end=parseInt(CUR_SEM.end_date)}else{if(a in eventsManager.events&&!("recurrence_days" in eventsManager.events[a])){return}if(!(a in eventsManager.uncommitted)){eventsManager.uncommitted[a]=EventsMan_cloneEventDict(eventsManager.events[a])}var e=eventsManager.uncommitted[a];delete e.recurrence_days;delete e.recurrence_end;delete e.recurrence_interval}}else{if(a in eventsManager.events&&eventsManager.events[a][f]==h){return}if(!(a in eventsManager.uncommitted)){eventsManager.uncommitted[a]=EventsMan_cloneEventDict(eventsManager.events[a])}eventsManager.uncommitted[a][f]=h}}}}}eventsManager.uncommitted[a].modified_time=moment().unix();if(!(a in eventsManager.events)){SE_checkSimilarEvents(eventsManager.uncommitted[a])}_EventsMan_callUpdateListeners()});$(window).on("beforeunload",function(a){if(Object.getOwnPropertyNames(eventsManager.uncommitted).length>0){a.preventDefault();return"Your changes have not been saved. Are you sure you want to leave?"}EventsMan_pushToServer(false)});window.setInterval(function(){EVENTSMAN_COUNT=(EVENTSMAN_COUNT+1)%30;if(!eventsManager.active&&EVENTSMAN_COUNT!=0){return}EventsMan_pushToServer(true);EventsMan_pullFromServer()},10*1000);$(window).on("mousemove click",function(){$.each(timeoutIDs,function(a){window.clearTimeout(this)});timeoutIDs=[];eventsManager.active=true;timeoutIDs.push(window.setTimeout(function(){eventsManager.active=false},30*1000))})}function EventsMan_pushToServer(b){if(!eventsManager.isIdle){return}eventsManager.isIdle=false;var a=[];$.each(eventsManager.updatedIDs.toArray(),function(c){a.push(eventsManager.events[this])});if(a.length>0||eventsManager.changed){LO_show();$.ajax("put",{dataType:"json",type:"POST",data:{events:JSON.stringify(a),hidden:JSON.stringify(eventsManager.hiddenIDs.toArray())},success:function(d){var e=d.changed_ids;$.each(e,function(h,g){var f=g[0];var j=g[1];if(h in eventsManager.events){var i=eventsManager.events[h];delete eventsManager.events[h];i.event_id=f;i.event_group_id=j;eventsManager.events[f]=i}if(h in eventsManager.uncommitted){var i=eventsManager.uncommitted[h];delete eventsManager.uncommitted[h];i.event_id=f;i.event_group_id=j;eventsManager.uncommitted[f]=i}EventsMan_callEventIDsChangeListener(h,f)});EventsMan_constructOrderArray();var c=d.deleted_ids;$.each(c,function(f){if(this in eventsManager.events){delete eventsManager.events[this]}if(this in eventsManager.uncommitted){delete eventsManager.uncommitted[this]}});eventsManager.isIdle=true;LO_hide();eventsManager.updatedIDs=new Set();eventsManager.changed=false;EventsMan_pullFromServer()},async:b,error:function(c){eventsManager.isIdle=true;LO_showError()}})}else{eventsManager.isIdle=true}}function EventsMan_pullFromServer(a,b){if(!eventsManager.isIdle){return}if(eventsManager.updatedIDs.size>0||eventsManager.changed){return}b=typeof b!="undefined"?b:false;if(b){LO_show()}eventsManager.isIdle=false;$.ajax("get/"+eventsManager.lastSyncedTime,{dataType:"json",success:function(c){var d=EventsMan_processDownloadedEvents(c);eventsManager.isIdle=true;LO_hide();if(a!=null){a()}if(d){_EventsMan_callUpdateListeners()}},error:function(c){eventsManager.isIdle=true;LO_showError()}})}function EventsMan_processDownloadedEvents(e){var f=false;var c=e.events;for(var d=0;d<c.length;d++){var a=c[d];if(a.event_id in eventsManager.uncommitted){}if(a.event_id in eventsManager.updatedIDs){}else{eventsManager.events[a.event_id]=a}f=true}var b=Set.prototype.fromArray(e.hidden_events);if(!b.equals(eventsManager.hiddenIDs)&&!eventsManager.changed){eventsManager.hiddenIDs=b;f=true}EventsMan_constructOrderArray();eventsManager.addedCount=0;eventsManager.lastSyncedTime=moment().unix();return f}function EventsMan_clickAddEvent(){var a=PopUp_getMainPopUp();if(PopUp_getID(a)){PopUp_callCloseListeners(PopUp_getID(a))}var b=EventsMan_addEvent();PopUp_setToEventID(a,b);PopUp_markAsUnsaved(a);PopUp_giveFocus(a)}function EventsMan_clickSync(){EventsMan_pushToServer();SR_save()}var KEY_UP=38;var KEY_DOWN=40;var KEY_LEFT=37;var KEY_RIGHT=39;var KEY_SQ_BRACE_R=221;var KEY_SQ_BRACE_L=219;var KEY_SHIFT=16;var SHIFT_PRESSED=false;$(document).keydown(function(b){var a=b.keyCode||b.which;switch(a){case KEY_UP:break;case KEY_DOWN:break;case KEY_LEFT:break;case KEY_RIGHT:break;case KEY_SQ_BRACE_R:$("#calendartab").tab("show");break;case KEY_SQ_BRACE_L:$("#agendatab").tab("show");break;case KEY_SHIFT:SHIFT_PRESSED=true;break}});$(document).keyup(function(){SHIFT_PRESSED=false});$(init);var NAV_ID=["agendatab","calendartab"];var TAB_ID=["agenda","calendar"];var SECTION_MAP;var SECTION_MAP_INVERSE;function init(){pinnedIDs=new Set();moment.tz.add({zones:{"America/New_York":["-4:56:2 - LMT 1883_10_18_12_3_58 -4:56:2","-5 US E%sT 1920 -5","-5 NYC E%sT 1942 -5","-5 US E%sT 1946 -5","-5 NYC E%sT 1967 -5","-5 US E%sT"]},rules:{US:["1918 1919 2 0 8 2 0 1 D","1918 1919 9 0 8 2 0 0 S","1942 1942 1 9 7 2 0 1 W","1945 1945 7 14 7 23 1 1 P","1945 1945 8 30 7 2 0 0 S","1967 2006 9 0 8 2 0 0 S","1967 1973 3 0 8 2 0 1 D","1974 1974 0 6 7 2 0 1 D","1975 1975 1 23 7 2 0 1 D","1976 1986 3 0 8 2 0 1 D","1987 2006 3 1 0 2 0 1 D","2007 9999 2 8 0 2 0 1 D","2007 9999 10 1 0 2 0 0 S"],NYC:["1920 1920 2 0 8 2 0 1 D","1920 1920 9 0 8 2 0 0 S","1921 1966 3 0 8 2 0 1 D","1921 1954 8 0 8 2 0 0 S","1955 1966 9 0 8 2 0 0 S"]},links:{}});$.ajaxSetup({beforeSend:function(b,a){if(!csrfSafeMethod(a.type)&&sameOrigin(a.url)){b.setRequestHeader("X-CSRFToken",csrftoken)}}});CacheMan_init();SECTION_MAP=JSON.parse(CacheMan_load("/all-sections"));SECTION_MAP_INVERSE={};$.each(SECTION_MAP,function(a,b){SECTION_MAP_INVERSE[b.toLowerCase()]=a});SB_init();SR_init();EventsMan_init();PopUp_init();NO_init();Agenda_init();Cal_init();SE_init();SR_addWillSaveListener(function(){Nav_save();UI_save()});SR_addDidLoadListener(function(){Nav_load();UI_load()});EventsMan_addEventIDsChangeListener(function(b,a){if(UI_isMain(b)){UI_setMain(a)}else{if(UI_isPinned(b)){UI_unpin(b);UI_pin(a)}}});if(THEME=="w"){loadWhiteTheme()}else{loadDarkTheme()}SECTION_COLOR_MAP=JSON.parse(CacheMan_load("/get/section-colors"));$(".withtooltip").tooltip({})}function Nav_save(){var a=$("#maintab").find(".active").find("a")[0].id;SR_put("nav_page",NAV_ID.indexOf(a))}function Nav_load(){return;var a=SR_get("nav_page");if(a==null){return}$("#maintab #"+NAV_ID[a]).tab("show")}function UI_save(){SR_put("pinned_IDs",JSON.stringify(pinnedIDs));SR_put("main_ID",mainID)}function UI_load(){if(SR_get("pinned_IDs")!=null){var a=JSON.parse(SR_get("pinned_IDs"));$.each(a,function(b,c){if(PopUp_getPopUpByID(b)!=null){UI_pin(b)}})}if(SR_get("main_ID")!=null){if(SR_get("main_ID")!="null"){if(PopUp_getPopUpByID(SR_get("main_ID"))!=null){UI_setMain(SR_get("main_ID"))}}}}function disableAllInteractions(){var a=$('<div id="disabler"></div>');$(a).prependTo(".tab-content").css({height:"100%",width:"100%",opacity:0,position:"absolute",left:0,top:0,"z-index":900,cursor:"not-allowed"})}function enableAllInteractions(){$("#disabler").remove()}var NO_TYPES={WARNING:"alert-warning",INFO:"alert-info"};function NO_init(){PopUp_addCloseListener(function(a){NO_removeNotificationID(a)})}function NO_showNotification(e,d,a,c){var b;if(NO_hasNotificationID(e)){b=$("#"+e+".alert")}else{b=$("<div>").addClass("alert").addClass("alert-dismissible");b.append('<button id="close_button" type="button" class="close" aria-hidden="true">&times;</button>');$('<span id="noti-content">').appendTo(b);b.attr("id",e);SB_push(b)}b.addClass(a);$text=$("<a>").addClass("alert-link").text(d).on("click",function(f){f.preventDefault();b.trigger("noti.click");SB_pop(b)});b.find("#close_button").on("click",function(f){f.preventDefault();NO_removeNotificationID(b.attr("id"))});b.find("#noti-content").append($text);if(c){$.each(c,function(f,g){b.data(f,g)})}return b}function NO_hasNotificationID(a){return $("#"+a+".alert").length>0}function NO_removeNotificationID(a){if(!NO_hasNotificationID(a)){return}SB_pop($("#"+a+".alert.in")[0]);SB_hideIfEmpty()}POPUP_CLASS="popup-event";function PopUp_init(){if(POPUP_INIT){return}POPUP_INIT=true;POPUP_HTML=$("#popup-template").html();$("#popup-template").remove();var a=$.ui.draggable.prototype._mouseStart;$.ui.draggable.prototype._mouseStart=function(c,d,b){this._trigger("beforeStart",c,this._uiHash());a.apply(this,[c,d,b])};topPos=parseInt($(".navbar").css("height"))+parseInt($(".navbar").css("margin-top"));height=window.innerHeight-topPos+300;$("#content_bounds").css("top",topPos+"px").css("height",height).css("left","-20%").css("width","140%");$(window).on("resize",function(b){topPos=parseInt($(".navbar").css("height"))+parseInt($(".navbar").css("margin-top"));height=window.innerHeight-topPos+300;$("#content_bounds").css("top",topPos+"px").css("height",height).css("left","-20%").css("width","140%")});EventsMan_addOnReadyListener(function(){PopUp_load()});SR_addWillSaveListener(function(){PopUp_save()});EventsMan_addEventIDsChangeListener(function(d,b){var c=PopUp_getPopUpByID(b);if(c){PopUp_close(c)}var c=PopUp_getPopUpByID(d);PopUp_setToEventID(c,b)});EventsMan_addUpdateListener(function(){PopUp_map(function(c,b){if(EventsMan_hasEvent(PopUp_getID(c))&&EventsMan_eventShouldBeShown(PopUp_getID(c))){PopUp_setToEventID(c,PopUp_getID(c))}else{PopUp_close(c)}})})}function PopUp_initialize_deferred(a){if($(a).find(".withdatepicker")[0].type=="text"){$(a).find(".withdatepicker").datetimepicker({format:"MM d, yyyy",autoclose:true,minView:2,maxView:3})}else{$(a).find(".withdatepicker").removeClass("withdatepicker")}if($(a).find(".withtimepicker")[0].type=="text"){$(a).find(".withtimepicker").datetimepicker({format:"H:ii P",formatViewType:"time",autoclose:true,minView:0,maxView:1,startView:0,linkField:"withdatepicker",linkFormat:"yyyy-mm-dd",showMeridian:true,minuteStep:10})}else{$(a).find(".withtimepicker").removeClass("withtimepicker")}}function PopUp_initialize(b){var c=[];$.each(DAYS_DICT,function(d){c.push({value:d,pretty:this,selected:false})});var a=SCM_initWithChoices("",c);$(b).find("#popup-repeat-pattern").append(a)}function PopUp_setToEventID(c,a){PopUp_setID(c,a);var i;$(c).find(".unsaved").removeClass("unsaved");if(EventsMan_hasUncommitted(a)){i=EventsMan_getUncommitted(a);PopUp_markAsUnsaved(c);var k=EventsMan_getEventByID(a);if(k){if(k.event_title!=i.event_title){$(c).find("#popup-title").addClass("unsaved")}if(k.event_location!=i.event_location){$(c).find("#popup-loc").addClass("unsaved")}if(k.event_description!=i.event_description){$(c).find("#popup-desc").addClass("unsaved")}if(k.event_type!=i.event_type){$(c).find("#popup-type").addClass("unsaved")}if(k.section_id!=i.section_id){$(c).find("#popup-section").addClass("unsaved")}var b=moment.unix(i.event_start);var d=moment.unix(k.event_start);if(b.year()!=d.year()||b.month()!=d.month()||b.date()!=d.date()){$(c).find("#popup-date").addClass("unsaved")}if(b.hour()!=d.hour()||b.minute()!=d.minute()){$(c).find("#popup-time-start").addClass("unsaved")}var e=moment.unix(i.event_end);var l=moment.unix(k.event_end);if(e.hour()!=l.hour()||e.minute()!=l.minute()){$(c).find("#popup-time-end").addClass("unsaved")}}}else{i=EventsMan_getEventByID(a);PopUp_markAsSaved(c)}if(!i){console.log("errorneous event id");PopUp_close(c);return}PopUp_setTitle(c,i.event_title);PopUp_setDescription(c,i.event_description);PopUp_setLocation(c,i.event_location);PopUp_setSection(c,i.section_id);PopUp_setType(c,i.event_type);PopUp_setDate(c,i.event_start);PopUp_setStartTime(c,i.event_start);PopUp_setEndTime(c,i.event_end);PopUp_setColor(c,SECTION_COLOR_MAP[i.section_id]["color"]);$(c).find("#popup-repeat")[0].checked=("recurrence_days" in i);$(c).find("#popup-repeat").off("change");$(c).find("#popup-repeat-pattern").off("select");if("recurrence_days" in i){var g=i.recurrence_days;var m=[];$.each(DAYS_DICT,function(n){m.push({value:n,pretty:this,selected:g.contains(n)})});$(c).find(".popup-repeat-item").removeClass("hide");var j=$(c).find("#popup-repeat-pattern").children()[0];SCM_setToChoices(j,m)}else{var m=[];$.each(DAYS_DICT,function(n){m.push({value:n,pretty:this,selected:false})});$(c).find(".popup-repeat-item").addClass("hide");var j=$(c).find("#popup-repeat-pattern").children()[0];SCM_setToChoices(j,m)}$(c).find("#popup-repeat").on("change",function(n){if(this.checked){if(!("recurrence_days" in i)){PopUp_markAsUnsaved(c)}$(c).find(".popup-repeat-item").removeClass("hide");PopUp_callEditListeners(PopUp_getID(c),"event_recurrence",[])}else{if("recurrence_days" in i){PopUp_markAsUnsaved(c)}$(c).find(".popup-repeat-item").addClass("hide");PopUp_callEditListeners(PopUp_getID(c),"event_recurrence",null)}});$(c).find("#popup-repeat-pattern").on("select",function(n,p){var o=[];$.each(p,function(r,q){if(q){o.push(parseInt(r))}});o.sort();if(!("recurrence_days" in i)){PopUp_markAsUnsaved(c)}else{if(!o.equals(i.recurrence_days)){PopUp_markAsUnsaved(c)}}PopUp_callEditListeners(PopUp_getID(c),"event_recurrence",o)});if(EventsMan_eventIsHidden(a)){$(c).find("#unhide_button").removeClass("hide");$(c).find("#hide_button").addClass("hide")}else{$(c).find("#unhide_button").addClass("hide");$(c).find("#hide_button").removeClass("hide")}var m=[];$.each(TYPE_MAP,function(n,o){m.push({value:n,pretty:o,selected:i.event_type==n})});var h=SCP_initOnElement($(c).find(".withtypepicker")[0],c,null,m);$(h).on("select",function(o,p){var n;$.each(p,function(q,r){if(r){n=q;return false}});$(c).find(".withtypepicker").val(toTitleCase(TYPE_MAP[n]));$(c).find(".withtypepicker").trigger("value_set")});var m=[];$.each(SECTION_MAP,function(n,o){m.push({value:n,pretty:o,selected:i.section_id==n})});var f=SCP_initOnElement($(c).find(".withsectionpicker")[0],c,null,m);$(f).on("select",function(o,p){var n;$.each(p,function(q,r){if(r){n=q;return false}});$(c).find(".withsectionpicker").val(SECTION_MAP[n]);$(c).find(".withsectionpicker").trigger("value_set")});$(c).find(".withcustompicker").on("hidden.bs.popover",function(n){$(this).trigger("value_set")})}function PopUp_setTitle(a,b){a.querySelector(".popup-title").innerHTML=b}function PopUp_setDescription(a,b){$(a).find("#popup-desc").html(nl2br(b))}function PopUp_setLocation(a,b){$(a).find("#popup-loc").text(b)}function PopUp_setSection(a,b){$(a).find("#popup-section").text(SECTION_MAP[b])}function PopUp_setType(a,c){var b=toTitleCase(TYPE_MAP[c]);$(a).find("#popup-type").text(b)}function PopUp_setDate(b,c){var a=moment.unix(c).tz(MAIN_TIMEZONE);$(b).find("#popup-date").text(a.format("MMMM D, YYYY"))}function PopUp_setStartTime(a,c){var b=moment.unix(c).tz(MAIN_TIMEZONE);$(a).find("#popup-time-start").text(b.format("h:mm A"))}function PopUp_setEndTime(a,c){var b=moment.unix(c).tz(MAIN_TIMEZONE);$(a).find("#popup-time-end").text(b.format("h:mm A"))}function PopUp_setColor(c,b){$(c).find(".panel").data("my-color",b);var a="#DDDDDD";var d="#F5F5F5";$(c).find(".panel").data("default-border",a);$(c).find(".panel").data("default-header",d);if(PopUp_hasFocus(c)){$(c).find("#popup-title").parent().parent().css("background-color",b).css("border-color",b);$(c).find(".panel").css("border-color",b)}else{$(c).find("#popup-title").parent().parent().css("background-color",d).css("border-color",a);$(c).find(".panel").css("border-color",a)}}function PopUp_save(){var b=[];PopUp_map(function(e,c){var d={};var f=[];d.id=PopUp_getID(e);f.push($(e).css("left"));f.push($(e).css("top"));f.push($(e).css("width"));f.push($(e).css("height"));d.frame=f;d.isMain=c;d.hasFocus=PopUp_hasFocus(e);b.push(d)});var a=JSON.stringify(b);SR_put("popup",a)}function PopUp_load(){if(SR_get("popup")==null){return}var a=JSON.parse(SR_get("popup"));$(a).each(function(b){popUp=PopUp_insertPopUp(this.isMain);if(!this.isMain){$(popUp).css("left",this.frame[0]);$(popUp).css("top",this.frame[1]);$(popUp).css("width",this.frame[2]);$(popUp).css("height",this.frame[3]);_PopUp_setBodyHeight(popUp)}PopUp_setToEventID(popUp,this.id);if(this.hasFocus){PopUp_giveFocus(popUp)}})}function PopUp_markAsUnsaved(a){$(a).find("#save_button").removeClass("hide");$(a).find("#undo_button").removeClass("hide")}function PopUp_markAsSaved(a){$(a).find("#save_button").addClass("hide");$(a).find("#undo_button").addClass("hide")}function PopUp_markIDAsNotEditing(a){PopUp_markAsNotEditing(PopUp_getPopUpByID(a))}function PopUp_markAsNotEditing(a){$(a).data("is_editing",false)}function PopUp_markAsEditing(a){$(a).data("is_editing",true)}function PopUp_isEditing(a){return $(a).data("is_editing")}function PopUp_makeIDDraggable(b){var a=PopUp_getPopUpByID(b);$(a).draggable("enable")}function _PopUp_showFormForElement(c){var b=_PopUp_getPopUp(c);$(c).addClass("hide");var a=_PopUp_Form_getFormIDForElement(c);var d=$(b).find("#"+a).removeClass("hide")[0]}function _PopUp_hideFormForElement(c){var b=_PopUp_getPopUp(c);$(c).addClass("hide");var a=_PopUp_Form_getElementIDForForm(c);$(b).find("#"+a).removeClass("hide")}function _PopUp_Form_getValue(a){if($(a).find("input").length>0){return $(a).find("input").val()}else{if($(a).find("textarea").length>0){return $(a).find("textarea").val()}}}function _PopUp_Form_setValue(b,d){if($(b).find("input").length>0){if($(b).find("input")[0].type=="date"){var a=moment(d).format("YYYY-MM-DD");$(b).find("input").val(a)}else{if($(b).find("input")[0].type=="time"){var c=moment("April 25, 2014 "+d).format("HH:mm:ss");$(b).find("input").val(c)}else{$(b).find("input").val(d)}}}else{if($(b).find("textarea").length>0){var e=br2nl(d);$(b).find("textarea").val(e)}}}function _PopUp_Form_giveFocus(a){if($(a).find("input").length>0){$(a).find("input")[0].focus()}else{if($(a).find("textarea").length>0){$(a).find("textarea")[0].focus()}}}function _PopUp_Form_getElementIDForForm(a){return a.id.split("-").slice(0,-1).join("-")}function _PopUp_Form_getFormIDForElement(a){return a.id+"-form"}function _PopUp_Form_addOnBlurListener(a,b){if($(a).find(".withdatepicker").length>0){$(a).find(".withdatepicker").datetimepicker().on("hide",b)}else{if($(a).find(".withtimepicker").length>0){$(a).find(".withtimepicker").datetimepicker().on("hide",b)}else{if($(a).find(".withcustompicker").length>0){$(a).find(".withcustompicker").on("value_set",b)}else{if($(a).find("input").length>0){$(a).find("input").on("blur",b)}else{if($(a).find("textarea").length>0){$(a).find("textarea").on("blur",b)}}}}}}function PopUp_clickedElement(d){var c=_PopUp_getPopUp(d);if(PopUp_isEditing(c)){return}PopUp_markAsEditing(c);var b=_PopUp_Form_getFormIDForElement(d);var e=$(c).find("#"+b)[0];if($(e).find("textarea").length>0){height=parseInt($(d).css("height"))+20;$(e).find("textarea").css("height",height+"px")}_PopUp_showFormForElement(d);_PopUp_Form_setValue(e,d.innerHTML);_PopUp_Form_giveFocus(e);if(!$(e).hasClass("input-group")&&e.notFirstSelected!=true){e.notFirstSelected=true;_PopUp_Form_addOnBlurListener(e,function(){PopUp_clickedSaveElement(e)})}var a=_PopUp_Form_getElementIDForForm(e);if(a=="popup-title"){$(c).find(".popup-ctrl").addClass("hidden")}$(e).find("input").off("keyup").on("keyup",function(f){var g=f.keyCode||f.which;if(g==13){PopUp_clickedSaveElement(e)}});$(e).find(".withtimepicker").off("keyup").off("keydown").on("keydown",function(f){f.preventDefault()});$(e).find(".withdatepicker").off("keyup").off("keydown").on("keydown",function(f){f.preventDefault()});$(e).find(".withcustompicker").off("keyup").off("keydown").on("keydown",function(f){f.preventDefault()})}function PopUp_clickedSaveElement(c){if(!/\S/.test(_PopUp_Form_getValue(c))){_PopUp_Form_giveFocus(c);return}var b=_PopUp_getPopUp(c);PopUp_markAsNotEditing(b);_PopUp_hideFormForElement(c);var a=_PopUp_Form_getElementIDForForm(c);if(a=="popup-title"){$(b).find(".popup-ctrl").removeClass("hidden");if(UI_isMain(PopUp_getID(b))){$(b).find(".poup-ctrl-right").addClass("hidden")}}var e=$(b).find("#"+a)[0];var d=_PopUp_Form_getValue(c).escapeHTML();if($(c).find("input").length>0&&$(c).find("input")[0].type=="date"){d=moment(d).tz(MAIN_TIMEZONE).format("MMMM D, YYYY")}else{if($(c).find("input").length>0&&$(c).find("input")[0].type=="time"){d=moment("April 25, 2014 "+d).tz(MAIN_TIMEZONE).format("h:mm A")}}if($(e).html()==nl2br(d)){return}$(e).html(nl2br(d));PopUp_markAsUnsaved(b);PopUp_callEditListeners(PopUp_getID(b),POPUP_EDITDICT[a],_PopUp_Form_getValue(c))}function PopUp_clickedClose(a){var b=a;while(!$(b).hasClass("popup")){b=$(b).parent()[0]}if(PopUp_isEditing(b)){return}if(EventsMan_hasUncommitted(PopUp_getID(b))){AS_showActionSheetFromElement($(b).find("#close_button")[0],b,"Save changes?",[{important:false,text:"Save"},{important:true,text:"Don't save"}],function(c){if(c==0){PopUp_clickedSavePopUp(b,true)}else{PopUp_clickedUndo(b);PopUp_clickedClose(b)}});return}if(PopUp_getID(b)){PopUp_callCloseListeners(PopUp_getID(b))}PopUp_close(b)}function PopUp_clickedDelete(a){var b=_PopUp_getPopUp(a);if(PopUp_isEditing(b)){return}var c=PopUp_getID(b);var d=EventsMan_getEventByID(c);if(d&&"recurrence_days" in d){AS_showActionSheetFromElement(a,b,null,[{important:false,text:"Only this event"},{important:true,text:"All future events"}],function(e){if(e==0){EventsMan_deleteEvent(c);if(!EventsMan_eventShouldBeShown(c)){PopUp_close(b)}}else{EventsMan_deleteAllFutureEvents(c);if(!EventsMan_eventShouldBeShown(c)){PopUp_close(b)}}});return}EventsMan_deleteEvent(c);if(!EventsMan_eventShouldBeShown(c)){PopUp_close(b)}}function PopUp_clickedUnhide(a){var b=_PopUp_getPopUp(a);if(PopUp_isEditing(b)){return}var c=PopUp_getID(b);var d=EventsMan_getEventByID(c);if("recurrence_days" in d){AS_showActionSheetFromElement(a,b,null,[{important:false,text:"Only this event"},{important:true,text:"All future events"}],function(e){if(e==0){EventsMan_unhideEvent(c)}else{EventsMan_unhideAllFutureEvents(c)}});return}EventsMan_unhideEvent(c)}function PopUp_clickedSavePopUp(b,d){var a=_PopUp_getPopUp(b);if(PopUp_isEditing(a)){return}d=d||false;var f=PopUp_getID(a);if(SE_hasSimilarEvents(f)){AS_showActionSheetFromElement($(a).find("#save_button")[0],a,"There seems to be a similar event already on the calendar",[{important:false,text:"Show similar events"},{important:true,text:"Save anyways"}],function(g){if(g==0){NO_showSimilarEvents(PopUp_getID(a))}else{NO_removeSimilarEventsNotification(PopUp_getID(a));PopUp_clickedSavePopUp(a)}});return}var e=EventsMan_getEventByID(f);var c=EventsMan_getUncommitted(f);if(e&&"recurrence_days" in e&&"recurrence_days" in c){if(e.recurrence_days.equals(c.recurrence_days)){AS_showActionSheetFromElement($(a).find("#save_button")[0],a,"This event is part of a recurring event.",[{important:false,text:"Only this event"},{important:true,text:"All future events"}],function(g){PopUp_markAsSaved(a);$(a).find(".unsaved").removeClass("unsaved");if(g==0){EventsMan_commitChanges(f)}else{EventsMan_commitChangesToAllFutureEvents(f)}if(d){PopUp_clickedClose(a)}});return}}PopUp_markAsSaved(a);$(a).find(".unsaved").removeClass("unsaved");EventsMan_commitChanges(f);if(d){PopUp_clickedClose(a)}}function PopUp_clickedUndo(b){var a=_PopUp_getPopUp(b);if(PopUp_isEditing(a)){return}var c=PopUp_getID(a);$(a).find("#save_button").addClass("hide");$(a).find("#undo_button").addClass("hide");$(a).find(".unsaved").removeClass("unsaved");EventsMan_cancelChanges(c)}var SE_id="settingsModal";function SE_init(){$("#"+SE_id).on("show.bs.modal",function(){var d=SE_addTypeSegmentedControlWithFilter("Agenda",AGENDA_FILTER);$(this).find("#agenda_options").append(d);var b=SE_addTypeSegmentedControlWithFilter("Calendar",CAL_FILTER);$(this).find("#calendar_options").append(b);var c=SC_initWithChoices("Theme",[{value:"w",pretty:"White",selected:THEME=="w"},{value:"b",pretty:"Black",selected:THEME=="b"}]);$(c).on("select",function(f,g){var e;$.each(g,function(h,i){if(i){e=h;return false}});THEME=e;if(e=="w"){loadWhiteTheme()}else{loadDarkTheme()}});$(this).find("#theme_options").append(c);var a=SC_initWithChoices("Show hidden events",[{value:1,pretty:"Yes",selected:EventsMan_showHidden()},{value:0,pretty:"No",selected:!EventsMan_showHidden()}]);$(a).on("select",function(e,f){$.each(f,function(g,h){if(h){EventsMan_showHidden(Boolean(parseInt(g)))}})});$(this).find("#hidden_options").append(a)});$("#"+SE_id).on("hide.bs.modal",function(){$(this).trigger("close");$.ajax("/put/ui-pref",{dataType:"json",type:"POST",data:{agenda_pref:JSON.stringify(AGENDA_FILTER),calendar_pref:JSON.stringify(CAL_FILTER),ui_pref:JSON.stringify({theme:THEME})}})});$("#"+SE_id).on("hidden.bs.modal",function(){SC_removeAllFromContainer(this)})}function SE_addTypeSegmentedControlWithFilter(c,b){var d=[];$.each(TYPE_MAP,function(e,f){d.push({value:e,pretty:f,selected:b.contains(e)})});var a=SCM_initWithChoices(c,d);$(a).on("select",function(e,f){b.splice(0,b.length);$.each(f,function(h,g){if(g){b.push(h)}})});return a}function SE_checkSimilarEvents(a){$.post("/get/similar-events",{event_dict:JSON.stringify(a)},function(b){if(b.length>0){SE_showSimilarEventsNotification(a.event_id,b)}},"json")}function SE_showSimilarEventsNotification(a,c){var b=NO_showNotification(a,"A similar event already exists",NO_TYPES.WARNING,null);b.on("noti.click",function(d){SE_showSimilarEvents(a,c)})}function SE_hasSimilarEvents(a){return NO_hasNotificationID(a)}function SE_showSimilarEvents(d,e){var f=[];$.each(e,function(g,h){f.push({eventID:d,eventDict:h,buttons:[{value:"c",pretty:"Choose"}]})});var b=EP_init("Is this the same as your event?",f);SB_setMainContent(b);SB_fill();var c=PopUp_getPopUpByID(d);PopUp_markAsEditing(c);if(PopUp_hasMain()&&!PopUp_isMain(c)){var a=PopUp_getMainPopUp();PopUp_callCloseListeners(PopUp_getID(a));$(a).remove()}SB_push(c);PopUp_updateSize(c);PopUp_makeMain(c);$(c).draggable("disable");$(b).on("ep.cancel ep.select",function(g){PopUp_markAsNotEditing(c);$(c).draggable("enable");SB_pop(this);SB_unfill()});$(b).on("ep.select",function(g,h){EventsMan_replaceEventIDWithEvent(h.eventID,h.eventDict)})}var SR_willSaveListeners=[];var SR_didLoadListeners=[];var SR_ON=true;var SR_manager={};var SR_loaded=false;function SR_init(){SR_load();$(window).on("beforeunload",function(){SR_save()})}function SR_get(a){if(a in SR_manager){return SR_manager[a]}else{return null}}function SR_put(a,b){SR_manager[a]=b}function SR_load(){if(!SR_ON){return}$.get("get/state-restoration",null,function(b,c,a){if(b!=""){SR_manager=b}SR_loaded=true;SR_callDidLoadListeners()},"json")}function SR_save(){if(!SR_ON){return}SR_callWillSaveListeners();$.ajax("put/state-restoration",{dataType:"json",type:"POST",data:{state_restoration:JSON.stringify(SR_manager)},async:false})}function SR_addWillSaveListener(a){SR_willSaveListeners.push(a)}function SR_callWillSaveListeners(){$.each(SR_willSaveListeners,function(a){this()})}function SR_addDidLoadListener(a){if(SR_loaded){a()}else{SR_didLoadListeners.push(a)}}function SR_callDidLoadListeners(){$.each(SR_didLoadListeners,function(a){this()});SR_didLoadListeners=null}function UR_pullUnapprovedRevisions(){$.ajax("/get/unapproved",{async:true,dataType:"json",success:function(a){if(a&&a.length>0){var b=NO_showNotification("unapproved-rev","There are unapproved changes",NO_TYPES.INFO,null);b.on("noti.click",function(c){UR_showUnapprovedRevisions(a)})}}})}function UR_showUnapprovedRevisions(b){var c=[];$.each(b,function(e,d){c.push({eventID:d.event_id,eventDict:d,buttons:[{value:"up",pretty:'<span class="glyphicon glyphicon-thumbs-up"></span>'},{value:"down",pretty:'<span class="glyphicon glyphicon-thumbs-down"></span>'}]})});var a=EP_init("Does this change look correct?",c);SB_setMainContent(a);SB_fill();UR_updateLeft(0,b);$(a).on("ep.cancel ep.select",function(d){var e=PopUp_getMainPopUp();PopUp_close(e);SB_pop(this);SB_unfill();SB_hide()});$(a).on("ep.select",function(d,e){if(e.button=="up"){}else{}});$(a).on("ep.slid",function(d,e){UR_updateLeft(e.index,b)})}function UR_updateLeft(a,b){var c=PopUp_getMainPopUp();PopUp_setToEventID(c,b[a].event_id);$(c).draggable("disable")};